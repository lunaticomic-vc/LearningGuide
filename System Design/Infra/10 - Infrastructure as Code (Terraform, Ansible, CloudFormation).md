# 10 - Infrastructure as Code (Terraform, Ansible, CloudFormation)

## 1. Activate Prior Knowledge

- Как бихте описали процеса на настройка на инфраструктура за AI система или уеб приложение без автоматизация?
- Какви проблеми могат да възникнат, когато ръчно управлявате сървъри, мрежи и услуги в облака?
- Можете ли да си представите как автоматизацията на инфраструктурата би подобрила надеждността и скоростта на разработка?

## 2. Overview

Infrastructure as Code (IaC) е подход, при който инфраструктурата се управлява и конфигурира чрез машинно-четим код, а не чрез ръчни процеси. Това позволява на екипите да създават, променят и възпроизвеждат инфраструктурата по автоматизиран, проследим и мащабируем начин. IaC е ключов компонент в съвременните DevOps и Cloud практики, особено при разработката и внедряването на сложни AI системи и облачни приложения.

IaC инструменти като Terraform, Ansible и CloudFormation позволяват на инженерите да описват инфраструктурата като декларативен или императивен код. Това улеснява версионирането, тестването и автоматизацията на инфраструктурните промени, подобно на начина, по който управляваме изходния код на софтуер.

В контекста на AI и софтуерното инженерство, IaC ускорява внедряването на среди за обучение, тестване и продукция, намалява човешките грешки и осигурява повторяемост. Това е особено важно при мащабни или динамично променящи се среди, където ръчната намеса би била бавна и податлива на грешки.

## 3. Key Concepts

- **Infrastructure as Code (IaC)** – Автоматизирано управление на инфраструктура чрез код, което позволява бързо, надеждно и повторяемо изграждане на среди.
- **Terraform** – Декларативен IaC инструмент с поддръжка на множество облачни доставчици; мислете за него като универсален език за инфраструктура.
- **Ansible** – Императивен инструмент за конфигуриране и управление на сървъри; подобно на готварска книга с рецепти за автоматизация.
- **CloudFormation** – Собствен IaC инструмент на AWS; позволява описание на AWS ресурси чрез шаблони.
- **Декларативен подход** – Описвате крайното състояние на инфраструктурата, а инструментът се грижи за стъпките.
- **Императивен подход** – Описвате всяка стъпка за постигане на желаното състояние.
- **Idempotency (Идемпотентност)** – Гаранция, че многократното изпълнение на един и същ код води до едно и също крайно състояние.
- **State File (Файл със състояние)** – Файл, който съхранява текущото състояние на инфраструктурата (напр. в Terraform).

## 4. Step-by-step Learning Path

1. **Разберете основите на IaC**
   - Фокус: Какво е IaC и защо се използва.
   - Задача: Прочетете кратка статия за IaC и направете списък с предимствата му.
   - Въпроси: Какви са основните ползи от IaC? Как IaC се различава от ръчното управление?

2. **Запознайте се с Terraform**
   - Фокус: Декларативен синтаксис и управление на state.
   - Задача: Напишете прост Terraform скрипт, който създава един виртуален сървър (EC2 instance).
   - Въпроси: Какво е state файлът в Terraform? Как се описва ресурс в Terraform?

3. **Изучете Ansible**
   - Фокус: Императивен синтаксис и playbook-и.
   - Задача: Създайте Ansible playbook, който инсталира nginx на отдалечен сървър.
   - Въпроси: Каква е разликата между playbook и role в Ansible? Как Ansible осъществява връзка със сървърите?

4. **Работете с CloudFormation**
   - Фокус: AWS специфичен декларативен подход.
   - Задача: Създайте CloudFormation шаблон за стартиране на S3 bucket.
   - Въпроси: Какво е шаблон в CloudFormation? Как се управляват зависимости между ресурси?

5. **Сравнете инструментите**
   - Фокус: Силни и слаби страни на всеки инструмент.
   - Задача: Направете таблица с плюсове и минуси на Terraform, Ansible и CloudFormation.
   - Въпроси: Кога бихте избрали един инструмент пред друг? Какви са ограниченията на всеки?

## 5. Examples

### Пример 1: Създаване на виртуален сървър с Terraform

```hcl
provider "aws" {
  region = "eu-central-1"
}

resource "aws_instance" "example" {
  ami           = "ami-0abcdef1234567890"
  instance_type = "t2.micro"
}
```

### Пример 2: Инсталиране на nginx с Ansible

```yaml
- hosts: webservers
  become: yes
  tasks:
    - name: Install nginx
      apt:
        name: nginx
        state: present
```

### Пример 3: Създаване на S3 bucket с CloudFormation

```yaml
Resources:
  MyS3Bucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: my-example-bucket
```

## 6. Common Pitfalls

- **Загуба или повреда на state файла** – Винаги съхранявайте state файловете сигурно (например в S3 с versioning).
- **Ръчно променяне на инфраструктурата** – Избягвайте ръчни промени извън IaC, тъй като това води до несъответствия.
- **Липса на идемпотентност** – Уверете се, че скриптовете са идемпотентни, за да избегнете неочаквани промени при повторно изпълнение.
- **Недостатъчно тестване на шаблони и playbook-и** – Винаги тествайте на изолирана среда преди продукция.
- **Твърде сложни или монолитни шаблони** – Разделяйте инфраструктурата на модули за по-лесна поддръжка.

## 7. Short Retrieval Quiz

1. Какво е основното предимство на Infrastructure as Code?
2. Каква е разликата между декларативен и императивен подход?
3. За какво служи state файлът в Terraform?
4. Какво е playbook в Ansible?
5. Как се описва ресурс в CloudFormation?
6. Какви са рисковете при ръчно променяне на инфраструктурата?
7. Какво означава идемпотентност в контекста на IaC?

## 8. Quick Recap

- Infrastructure as Code автоматизира управлението на инфраструктура чрез код.
- Terraform, Ansible и CloudFormation са водещи IaC инструменти с различни подходи.
- Декларативният подход описва крайното състояние, а императивният – стъпките до него.
- Idempotency гарантира, че многократното изпълнение води до едно и също състояние.
- State файловете са критични за проследяване на инфраструктурни промени.
- IaC подобрява скоростта, надеждността и повторяемостта на инфраструктурните процеси.
- Избягвайте ръчни промени и винаги тествайте IaC конфигурациите.

## 9. Spaced Review Plan

| Време      | Преговори/Задачи                                            |
|------------|-------------------------------------------------------------|
| 1 ден      | Прегледайте ключовите концепции и основните примери.         |
| 3 дни      | Напишете кратък IaC скрипт с избран инструмент.              |
| 1 седмица  | Сравнете подходите на Terraform, Ansible и CloudFormation.   |
| 1 месец    | Приложете IaC в малък проект или симулирайте внедряване.     |