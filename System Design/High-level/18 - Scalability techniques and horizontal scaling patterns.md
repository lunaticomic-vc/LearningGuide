# 18 - Scalability techniques and horizontal scaling patterns

## 1. Activate Prior Knowledge

- Какво означава една система да бъде "мащабируема"? Можете ли да дадете пример от реален проект или услуга, която сте използвали?
- Какви са разликите между вертикално и хоризонтално мащабиране? Как бихте избрали подходящия подход за дадено приложение?
- Какви предизвикателства срещате при увеличаване на броя на сървърите или обработващите единици в една AI система или уеб услуга?

## 2. Overview

Scalability е способността на една система да обработва нарастващ обем от работа или да бъде лесно разширявана, за да посрещне увеличено търсене. В контекста на съвременните AI системи и уеб приложения, нуждата от мащабиране често възниква поради увеличаващ се брой потребители, заявки или обем от данни.

Хоризонталното мащабиране (horizontal scaling) означава добавяне на повече машини (nodes) към системата, вместо да се увеличава капацитетът на една единствена машина (вертикално мащабиране). Този подход позволява по-голяма устойчивост, гъвкавост и често е по-евтин при облачни инфраструктури.

Използването на правилни техники и шаблони за хоризонтално мащабиране е критично за изграждането на надеждни, високодостъпни и ефективни AI системи и уеб услуги. Това включва разбиране на балансиране на натоварването, разпределено съхранение на данни и синхронизация между множество инстанции.

## 3. Key Concepts

- Scalability – Способността на системата да се разширява и да обработва повече заявки без загуба на производителност. Мислете за това като за добавяне на повече касиери в супермаркет при опашка.
- Horizontal Scaling – Добавяне на повече сървъри или инстанции към системата, вместо да се увеличава мощността на една машина. Подобно на отваряне на нови клонове на банка.
- Load Balancer – Компонент, който разпределя входящия трафик равномерно между множество сървъри, за да се избегне претоварване.
- Stateless vs. Stateful Services – Stateless услугите не пазят информация за предишни заявки, което ги прави по-лесни за хоризонтално мащабиране.
- Sharding – Разделяне на данните на по-малки, независими части (shards), които могат да се обработват паралелно на различни сървъри.
- Consistency – Гаранция, че всички копия на данните са актуални и синхронизирани, което става по-сложно при хоризонтално мащабиране.
- Auto-scaling – Автоматично добавяне или премахване на ресурси според натоварването.

## 4. Step-by-step Learning Path

1. **Understand the Basics of Scalability**
   - Фокус: Дефиниции и разлики между вертикално и хоризонтално мащабиране.
   - Практическа задача: Направете кратка таблица с плюсове и минуси на двата подхода.
   - Retrieval: Какво е scalability? Кога бихте избрали хоризонтално пред вертикално мащабиране?

2. **Explore Load Balancing**
   - Фокус: Как работят load balancer-ите и защо са ключови.
   - Практическа задача: Конфигурирайте прост Nginx load balancer за две backend услуги.
   - Retrieval: Каква е ролята на load balancer-а? Какви типове load balancing познавате?

3. **Stateless vs. Stateful Services**
   - Фокус: Разлика между stateless и stateful архитектури.
   - Практическа задача: Напишете функция, която обработва HTTP заявки без да пази състояние.
   - Retrieval: Защо stateless услугите са по-лесни за мащабиране?

4. **Sharding and Data Partitioning**
   - Фокус: Как се разделят данните за паралелна обработка.
   - Практическа задача: Разделете списък с 1000 елемента на 4 shards и ги обработете паралелно (може с Python).
   - Retrieval: Какво е sharding? Какви са предимствата и недостатъците му?

5. **Implement Auto-scaling**
   - Фокус: Как се настройва автоматично мащабиране в облачни платформи.
   - Практическа задача: Настройте auto-scaling група в AWS или Google Cloud за проста уеб услуга.
   - Retrieval: Какви метрики се използват за auto-scaling? Какви са рисковете при неправилна конфигурация?

## 5. Examples

### Пример 1: Load Balancing с Nginx

```nginx
http {
    upstream backend {
        server backend1.example.com;
        server backend2.example.com;
    }
    server {
        listen 80;
        location / {
            proxy_pass http://backend;
        }
    }
}
```
*Този конфигурира Nginx да разпределя заявките между два backend сървъра.*

### Пример 2: Stateless API Service (Python Flask)

```python
from flask import Flask, request, jsonify

app = Flask(__name__)

@app.route('/predict', methods=['POST'])
def predict():
    data = request.json
    # Няма съхранение на състояние между заявките
    result = model_inference(data)
    return jsonify({'result': result})
```
*Този API не пази състояние между заявките, което улеснява хоризонталното мащабиране.*

### Пример 3: Sharding на данни

```python
data = list(range(1000))
shards = [data[i::4] for i in range(4)]
# shards[0], shards[1], shards[2], shards[3] съдържат различни части от данните
```
*Така данните се разделят на 4 части за паралелна обработка.*

## 6. Common Pitfalls

- **Пренебрегване на Consistency**: Не всички системи могат да гарантират пълна консистентност при хоризонтално мащабиране. Използвайте подходящи механизми за синхронизация.
- **Stateful Services**: Ако услугата пази състояние локално, хоризонталното мащабиране става трудно. Използвайте външни хранилища за състоянието.
- **Single Point of Failure**: Ако load balancer-ът не е репликиран, той може да стане bottleneck или точка на отказ.
- **Неправилно конфигуриран Auto-scaling**: Липса на правилни метрики или закъснения в скалирането могат да доведат до недостиг или излишък на ресурси.
- **Недостатъчно наблюдение (monitoring)**: Без мониторинг не може да се открият проблеми с производителността или капацитета.

## 7. Short Retrieval Quiz

1. Каква е основната разлика между вертикално и хоризонтално мащабиране?
2. Какво е stateless услуга и защо е по-лесна за хоризонтално мащабиране?
3. Каква е ролята на load balancer-а в разпределените системи?
4. Какво представлява sharding и кога се използва?
5. Какви рискове крие неправилно конфигуриран auto-scaling?
6. Защо consistency е по-сложна при хоризонтално мащабиране?
7. Какви са предимствата на хоризонталното мащабиране в облачна среда?

## 8. Quick Recap

- Scalability е способността на системата да се разширява при нужда.
- Хоризонталното мащабиране добавя нови сървъри, вместо да увеличава мощността на съществуващите.
- Load balancer-ите са ключови за равномерно разпределение на трафика.
- Stateless услугите са по-лесни за мащабиране и управление.
- Sharding позволява паралелна обработка на големи обеми данни.
- Auto-scaling автоматизира добавянето и премахването на ресурси според натоварването.
- Важно е да се следи за consistency, monitoring и избягване на single points of failure.

## 9. Spaced Review Plan

| Review Time | Prompt                                                                |
|-------------|----------------------------------------------------------------------|
| 1 day       | Обяснете разликата между вертикално и хоризонтално мащабиране.       |
| 3 days      | Какви са основните предизвикателства при хоризонтално мащабиране?    |
| 1 week      | Дайте пример за sharding и load balancing в реална система.          |
| 1 month     | Как бихте внедрили auto-scaling и какви метрики бихте следили?       |