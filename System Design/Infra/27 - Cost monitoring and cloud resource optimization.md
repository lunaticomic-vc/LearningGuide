# 27 - Cost monitoring and cloud resource optimization

## 1. Activate Prior Knowledge

- Какви са основните разходи, които възникват при използване на облачни услуги в един AI проект или софтуерна система?
- Срещали ли сте ситуации, в които облачните ресурси са били използвани неефективно? Какви бяха последствията?
- Как бихте определили „оптимизация“ в контекста на разходи и ресурси в облака?

---

## 2. Overview

В съвременните AI системи и софтуерно инженерство, облачните услуги предоставят мащабируемост, гъвкавост и бърз достъп до изчислителни ресурси. Въпреки това, без внимателно наблюдение и оптимизация, разходите могат бързо да излязат извън контрол, особено при динамични натоварвания или експериментиране с големи модели.

Целта на мониторинга на разходите и оптимизацията на облачните ресурси е да се гарантира, че всяка похарчена сума носи максимална стойност. Това включва проследяване на използването, анализ на тенденции, откриване на неефективности и прилагане на стратегии за намаляване на ненужните разходи.

Този процес е критичен за устойчивото развитие на AI продукти и услуги, тъй като позволява по-добро бюджетиране, по-висока ефективност и конкурентоспособност. Включва както технически, така и организационни решения, които изискват сътрудничество между инженери, DevOps и мениджъри.

---

## 3. Key Concepts

- Cost Monitoring – Проследяване и анализиране на разходите за облачни услуги в реално време или периодично. Мислете за това като за банково извлечение, което ви показва къде отиват парите ви.
- Resource Optimization – Процесът на настройване и управление на облачните ресурси така, че да се постигне максимална производителност при минимални разходи. Подобно на настройване на двигател за по-нисък разход на гориво.
- Cost Allocation Tags – Етикети, които се добавят към облачни ресурси, за да се проследяват разходите по екипи, проекти или среди.
- Rightsizing – Анализ и корекция на размера на ресурсите (напр. VM, storage), така че да не се плаща за неизползван капацитет.
- Auto-scaling – Автоматично увеличаване или намаляване на ресурсите според натоварването, което предотвратява плащането за ненужен капацитет.
- Reserved Instances/Savings Plans – Дългосрочни договори за използване на ресурси, които намаляват цената спрямо on-demand модела.
- Cost Anomaly Detection – Откриване на неочаквани или необичайни разходи чрез автоматизирани инструменти.

---

## 4. Step-by-step Learning Path

1. **Разберете облачната си сметка**
   - Фокус: Прегледайте структурата на фактурата от избран облачен доставчик (AWS, Azure, GCP).
   - Задача: Изтеглете примерна фактура и идентифицирайте основните разходни категории.
   - Въпроси: Какви са основните компоненти на разходите? Кои услуги са най-скъпи?

2. **Внедрете cost allocation tags**
   - Фокус: Научете как да етикирате ресурси за по-добро проследяване на разходите.
   - Задача: Добавете тагове към поне три различни ресурса във вашия облачен акаунт.
   - Въпроси: Как таговете помагат при анализа на разходите? Какви тагове бихте използвали за AI проект?

3. **Настройте cost monitoring dashboards**
   - Фокус: Използвайте вградени инструменти (напр. AWS Cost Explorer) за визуализация на разходите.
   - Задача: Създайте dashboard, който показва разходите по проект и по време.
   - Въпроси: Какви тенденции забелязвате? Има ли неочаквани пикове?

4. **Анализирайте и оптимизирайте ресурсите**
   - Фокус: Идентифицирайте неефективно използвани ресурси (напр. VM с ниско натоварване).
   - Задача: Намалете размера или изключете поне един неизползван ресурс.
   - Въпроси: Какви спестявания реализирахте? Какви рискове има при rightsizing?

5. **Внедрете автоматизация и аларми**
   - Фокус: Настройте автоматични аларми за аномалии в разходите.
   - Задача: Конфигурирайте аларма, която ви уведомява при 20% увеличение на разходите спрямо предходния месец.
   - Въпроси: Какви действия бихте предприели при аларма? Как да избегнете фалшиви сигнали?

---

## 5. Examples

### Пример 1: Оптимизация на AI training cluster

Екип използва GPU-инстанции за обучение на модели. След анализ с cost explorer, се установява, че 30% от инстанциите са били неактивни през нощта. Решението: внедряване на auto-scaling групи, които автоматично изключват неизползваните ресурси.

### Пример 2: Използване на cost allocation tags

```yaml
Resources:
  - Name: "ai-model-training"
    Tags:
      Project: "NLP-Research"
      Owner: "Ivan Petrov"
      Environment: "Development"
```
Това позволява на екипа да проследява разходите по проекти и да идентифицира най-скъпите експерименти.

### Пример 3: Аларма за аномалии

```python
# Пример с AWS CloudWatch
import boto3

client = boto3.client('cloudwatch')
client.put_metric_alarm(
    AlarmName='HighMonthlyCost',
    MetricName='EstimatedCharges',
    Namespace='AWS/Billing',
    Statistic='Maximum',
    Threshold=1000,
    ComparisonOperator='GreaterThanThreshold',
    Period=86400,
    EvaluationPeriods=1,
    ActionsEnabled=True,
    AlarmActions=['arn:aws:sns:...']
)
```
Това ще изпрати известие, ако разходите надвишат определен праг.

---

## 6. Common Pitfalls

- **Липса на тагове** – Без тагове разходите са трудни за анализ и алокация. Винаги дефинирайте тагове при създаване на ресурси.
- **Пренебрегване на неактивни ресурси** – Често се забравят VM, storage или IP адреси, които не се използват, но се таксуват.
- **Недостатъчно автоматизация** – Ръчното следене на разходи е неефективно и води до пропуски. Използвайте автоматични аларми и отчети.
- **Прекалено агресивен rightsizing** – Намаляването на ресурси без анализ може да доведе до деградация на производителността.
- **Игнориране на дългосрочни планове** – On-demand ресурсите са по-скъпи; използвайте reserved instances или savings plans, когато е възможно.

---

## 7. Short Retrieval Quiz

1. Какво представлява cost allocation tag и защо е важен?
2. Каква е основната цел на rightsizing?
3. Какви са ползите от auto-scaling в облака?
4. Как можете да откриете аномалии в облачните разходи?
5. Какви рискове крие прекалено агресивната оптимизация на ресурси?
6. Какви инструменти за мониторинг на разходи предлага вашият облачен доставчик?
7. Какво бихте направили, ако забележите неочакван пик в разходите?

---

## 8. Quick Recap

- Мониторингът на разходите е критичен за контрол и оптимизация на бюджета в облака.
- Таговете позволяват детайлен анализ и алокация на разходите по проекти и екипи.
- Оптимизацията на ресурси включва rightsizing, auto-scaling и изключване на неизползвани услуги.
- Автоматизацията на аларми и отчети намалява риска от пропуски и неочаквани разходи.
- Дългосрочните планове (reserved instances, savings plans) намаляват цената при предвидимо натоварване.
- Избягвайте прекалено агресивна оптимизация, за да не компрометирате производителността.
- Редовният анализ и преглед на разходите е ключов за устойчивото развитие на AI системи.

---

## 9. Spaced Review Plan

| Време      | Преговорен въпрос/задача                                     |
|------------|--------------------------------------------------------------|
| 1 ден      | Избройте 3 начина за оптимизация на облачни разходи.         |
| 3 дни      | Обяснете как таговете помагат при анализа на разходите.      |
| 1 седмица  | Дайте пример за rightsizing и какви са потенциалните рискове.|
| 1 месец    | Опишете процеса на автоматизация на мониторинга на разходи.  |