# Distributed_hash_tables

## 1. Activate Prior Knowledge
- Какво представлява хеш функцията и как тя се използва за бързо търсене на данни в софтуерни системи?
- Как бихте организирали съхранението и достъпа до голямо количество разпределени данни в мрежа от компютри?
- Какви предизвикателства срещате при изграждането на мащабируеми и отказоустойчиви системи за съхранение на данни?

## 2. Overview
Distributed Hash Tables (DHT) са разпределени системи за съхранение и търсене на данни, които използват хеш функции за разпределяне на ключове и стойности между множество възли (nodes) в мрежа. Те осигуряват децентрализиран начин за намиране на информация без нужда от централен сървър, което ги прави особено подходящи за мащабируеми и отказоустойчиви приложения.

В контекста на софтуерното инженерство и AI системите, DHT позволяват ефективно разпределение на данни и ресурси, като намаляват латентността и увеличават устойчивостта на системата при откази. Те са основа за peer-to-peer мрежи, разпределени файлови системи и някои видове блокчейн технологии.

Разбирането на DHT е ключово за проектиране на системи, които трябва да се справят с динамична среда, където възлите могат да се присъединяват и напускат мрежата често, без да се губи достъпът до данните.

## 3. Key Concepts
- **Node (Възел)** – отделен компютър или процес, който участва в DHT мрежата и съхранява част от данните. Аналогия: като член на библиотечен клуб, всеки държи част от книгите.
- **Key (Ключ)** – уникален идентификатор, използван за намиране на конкретна стойност в DHT. Може да се сравни с ISBN номер на книга.
- **Hash Function (Хеш функция)** – алгоритъм, който превръща ключа в числова стойност, определяща къде в мрежата ще се съхранява данните. Мислете за нея като за машина, която превръща имена в адреси.
- **Chord, Kademlia, Pastry** – популярни протоколи за реализиране на DHT, всеки с различен подход за маршрутизиране и управление на възлите.
- **Routing Table (Маршрутизираща таблица)** – структура, която всеки възел поддържа, за да знае към кои други възли да препраща заявки.
- **Consistent Hashing (Консистентно хеширане)** – техника, която минимизира преразпределението на ключове при добавяне или премахване на възли.
- **Fault Tolerance (Отказоустойчивост)** – способността на DHT да продължи да работи правилно, дори когато някои възли са недостъпни.

## 4. Step-by-step Learning Path
1. **Запознайте се с основите на хеш функциите и тяхната роля в разпределени системи.**  
   *Практическа задача:* Имплементирайте проста хеш функция, която приема низ и връща числова стойност.  
   *Въпроси за припомняне:* Какво е свойството на добра хеш функция? Защо е важно равномерното разпределение?

2. **Разучете концепцията за консистентно хеширане и защо е ключово за DHT.**  
   *Практическа задача:* Симулирайте добавяне и премахване на възли в консистентно хеширане и наблюдавайте преразпределението на ключове.  
   *Въпроси за припомняне:* Как консистентното хеширане намалява преразпределението? Какво се случва при напускане на възел?

3. **Изучете основните протоколи за DHT (Chord, Kademlia).**  
   *Практическа задача:* Прочетете и обяснете на колега как работи маршрутизирането в Chord.  
   *Въпроси за припомняне:* Как се намира ключ в Chord? Какъв е максималният брой стъпки за търсене?

4. **Имплементирайте прост DHT възел с базови операции: добавяне, търсене и премахване на ключове.**  
   *Практическа задача:* Напишете код, който съхранява ключ-стойност двойки и ги търси чрез DHT логика.  
   *Въпроси за припомняне:* Как се синхронизират данните при добавяне на нов възел?

5. **Тествайте отказоустойчивостта и мащабируемостта на вашата DHT система.**  
   *Практическа задача:* Симулирайте отказ на възли и наблюдавайте как системата се адаптира.  
   *Въпроси за припомняне:* Как системата се справя с липсващи възли? Как се възстановяват данните?

## 5. Examples
### Пример 1: Основна хеш функция на Python
```python
def simple_hash(key, size):
    return sum(ord(c) for c in key) % size

# Използване:
size = 10
print(simple_hash("example_key", size))  # Резултат: индекс в диапазона [0, size-1]
```

### Пример 2: Симплифициран Chord възел (псевдокод)
```python
class Node:
    def __init__(self, id, size):
        self.id = id
        self.size = size
        self.data = {}
        self.successor = None

    def find_successor(self, key_id):
        if self.id < key_id <= self.successor.id:
            return self.successor
        else:
            # Препращане към следващ възел (опростено)
            return self.successor.find_successor(key_id)

    def store(self, key, value):
        key_id = simple_hash(key, self.size)
        node = self.find_successor(key_id)
        node.data[key] = value
```

### Пример 3: Kademlia RPC пример (Python, използва asyncio)
```python
# Примерен RPC call за търсене на ключ
async def find_node(node, target_id):
    response = await node.rpc_call('FIND_NODE', target_id)
    return response['nodes']
```

## 6. Common Pitfalls
- **Неправилно разпределение на ключове:** Използване на лоша хеш функция води до натоварване на някои възли и празни други. Използвайте консистентно хеширане и проверявайте равномерността.
- **Липса на актуализация на маршрутизиращите таблици:** Ако възлите не обновяват информацията си за другите възли, търсенето може да се провали. Внедрете периодична синхронизация.
- **Недостатъчна отказоустойчивост:** Не се предвижда репликация на данните, което води до загуба при отпадане на възел. Използвайте репликация и механизми за възстановяване.
- **Пренебрегване на динамиката на мрежата:** Не се обработват правилно случаи на често присъединяване и напускане на възли, което води до несъответствия.
- **Сложност на маршрутизацията:** Прекалено сложна или неефективна маршрутизация увеличава латентността. Изберете подходящ протокол според нуждите.

## 7. Short Retrieval Quiz
1. Какво е основната функция на Distributed Hash Table?  
2. Какво представлява консистентното хеширане и защо е важно?  
3. Какво е ролята на маршрутизиращата таблица в DHT?  
4. Как DHT системите осигуряват отказоустойчивост?  
5. Кои са двата популярни протокола за DHT?  
6. Какво се случва при напускане на възел в DHT мрежа?  
7. Как хеш функцията влияе на разпределението на данните?

## 8. Quick Recap
- DHT е децентрализирана структура за съхранение и търсене на данни, използваща хеширане.  
- Консистентното хеширане минимизира преразпределението при промени в мрежата.  
- Възлите поддържат маршрутизиращи таблици за ефективно намиране на ключове.  
- Протоколи като Chord и Kademlia дефинират правила за маршрутизиране и управление.  
- Отказоустойчивостта се постига чрез репликация и адаптация към динамични промени.  
- Практическата имплементация изисква внимание към хеш функции, синхронизация и мащабируемост.  
- Разбирането на DHT е ключово за изграждане на мащабируеми разпределени системи.

## 9. Spaced Review Plan

| Време       | Промпт за преговор                                         |
|-------------|------------------------------------------------------------|
| 1 ден       | Обяснете с прости думи какво е DHT и как работи.           |
| 3 дни       | Опишете ролята на консистентното хеширане и маршрутизиращите таблици. |
| 1 седмица   | Сравнете протоколите Chord и Kademlia по отношение на маршрутизацията. |
| 1 месец     | Прегледайте типичните грешки при имплементация и как да ги избегнете. |