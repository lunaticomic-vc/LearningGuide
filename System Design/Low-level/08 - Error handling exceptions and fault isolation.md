# 08 - Error handling exceptions and fault isolation

## 1. Activate Prior Knowledge

- Какво се случва, когато дадена програма срещне неочаквана ситуация или грешка по време на изпълнение?
- Можете ли да си спомните случай, когато неправилното обработване на грешки е довело до срив или неправилна работа на софтуерна система?
- Как мислите, че обработката на изключения и изолирането на грешки могат да подобрят надеждността на системите с изкуствен интелект?

## 2. Overview

Обработката на грешки, изключения и изолирането на дефекти са ключови аспекти на съвременното софтуерно инженерство, особено при изграждането на сложни и критични системи, като тези с изкуствен интелект. Те позволяват на системите да реагират адекватно на неочаквани ситуации, да се възстановяват от грешки и да продължават да функционират без сериозни последствия.

В по-широк контекст, тези техники са част от стратегията за изграждане на надеждни, устойчиви и лесни за поддръжка софтуерни решения. Без подходяща обработка на изключения и изолация на дефекти, една малка грешка може да доведе до срив на цялата система или до загуба на данни.

В системите с изкуствен интелект, където често се работи с несигурни данни и сложни взаимодействия, правилното управление на грешките е особено важно за поддържане на доверие и сигурност.

## 3. Key Concepts

- Exception (Изключение) – Механизъм, чрез който програмата сигнализира за възникнала неочаквана ситуация или грешка по време на изпълнение. Може да се сравни с аларма, която прекъсва нормалния ход на събитията.
- Error Handling (Обработка на грешки) – Процесът на откриване, улавяне и реакция на грешки или изключения, така че програмата да се възстанови или да приключи контролирано.
- Fault Isolation (Изолиране на дефекти) – Практика за ограничаване на въздействието на грешките само до засегнатите компоненти, така че останалата част от системата да продължи да работи нормално. Подобно на предпазител в електрическа верига.
- Try-Catch Block – Структура в много програмни езици, която позволява улавяне и обработка на изключения.
- Fail-safe (Безопасен при отказ) – Дизайн, при който системата преминава в безопасно състояние при възникване на грешка.
- Logging (Логване) – Записване на информация за грешки и изключения с цел диагностика и анализ.

## 4. Step-by-step Learning Path

1. **Разберете видовете грешки и изключения**
   - Фокус: Разграничете синтактични, логически и runtime грешки.
   - Задача: Напишете малка програма, която умишлено предизвиква различни типове грешки.
   - Въпроси: Каква е разликата между синтактична и runtime грешка? Какво е изключение?

2. **Използвайте try-catch блокове**
   - Фокус: Научете се да улавяте и обработвате изключения.
   - Задача: Добавете try-catch блок към предишната програма, за да обработите runtime грешка.
   - Въпроси: Какво се случва, ако не използвате try-catch? Какво може да се постави в catch блока?

3. **Изолирайте дефекти чрез модулен дизайн**
   - Фокус: Организирайте кода така, че грешките да не се разпространяват извън модула.
   - Задача: Създайте функция, която обработва собствените си грешки и връща контролирана стойност.
   - Въпроси: Как модулният дизайн помага при изолирането на грешки? Какво би станало, ако всички грешки се „прехвърлят“ нагоре?

4. **Логвайте и анализирайте грешки**
   - Фокус: Научете се да записвате информация за грешки за по-лесна диагностика.
   - Задача: Добавете логване на изключения във вашата програма.
   - Въпроси: Защо е важно да се логват грешки? Каква информация трябва да се записва?

5. **Тествайте fail-safe механизми**
   - Фокус: Осигурете безопасно поведение при възникване на грешка.
   - Задача: Имплементирайте fallback поведение, ако дадена операция се провали.
   - Въпроси: Какво е fail-safe? Как може да се гарантира, че системата остава в безопасно състояние?

## 5. Examples

### Пример 1: Обработка на изключение при деление на нула (Python)
```python
try:
    result = 10 / 0
except ZeroDivisionError as e:
    print("Грешка: Деление на нула!")
```

### Пример 2: Изолиране на дефект в модул (Java)
```java
public int parseIntSafe(String input) {
    try {
        return Integer.parseInt(input);
    } catch (NumberFormatException e) {
        // Логване на грешката
        System.err.println("Invalid number: " + input);
        return 0; // Връщане на контролирана стойност
    }
}
```

### Пример 3: Логване на грешки (Python)
```python
import logging

logging.basicConfig(filename='errors.log', level=logging.ERROR)

try:
    open('missing_file.txt')
except Exception as e:
    logging.error("Грешка при отваряне на файл: %s", e)
```

## 6. Common Pitfalls

- **Пренебрегване на изключенията** – Оставянето на празни catch блокове или игнориране на грешки може да скрие сериозни проблеми.
- **Прекомерно използване на общи изключения** – Ловенето на всички изключения с `catch (Exception e)` може да затрудни диагностицирането и да скрие специфични грешки.
- **Липса на логване** – Ако не се записват грешки, откриването на причините за проблеми става почти невъзможно.
- **Неизолиран дефект** – Ако една грешка се разпространи извън модула, може да срине цялата система.
- **Прекалено сложна обработка** – Сложните или вложени try-catch блокове затрудняват поддръжката и четимостта на кода.

## 7. Short Retrieval Quiz

1. Какво представлява изключението (exception) в програмирането?
2. Каква е целта на try-catch блоковете?
3. Какво означава изолиране на дефекти (fault isolation)?
4. Защо е важно да се логват грешки?
5. Какво е fail-safe поведение?
6. Каква е разликата между синтактична и runtime грешка?
7. Как може да се избегне разпространението на грешки в цялата система?

## 8. Quick Recap

- Изключенията сигнализират за неочаквани ситуации по време на изпълнение.
- Обработката на грешки позволява на програмите да се възстановяват или да приключват контролирано.
- Изолирането на дефекти ограничава въздействието на грешките само до засегнатите компоненти.
- Try-catch блоковете са основен инструмент за улавяне и обработка на изключения.
- Логването на грешки е критично за диагностика и поддръжка.
- Fail-safe механизмите гарантират безопасно поведение при грешки.
- Добрият дизайн на обработка на грешки повишава надеждността и устойчивостта на системите.

## 9. Spaced Review Plan

| Review Time | Prompt                                                      |
|-------------|-------------------------------------------------------------|
| 1 day       | Обяснете разликата между обработка на грешки и изолиране на дефекти. Дайте пример. |
| 3 days      | Опишете как бихте логнали и анализирали изключение във ваш проект.                |
| 1 week      | Какви са най-честите грешки при работа с try-catch блокове и как да ги избегнете? |
| 1 month     | Представете сценарий, в който fail-safe дизайнът е критичен за системата.         |