# CNNs

## 1. Activate Prior Knowledge
- Какво знаете за невронните мрежи и тяхната роля в изкуствения интелект?
- Как бихте описали разликата между традиционни напълно свързани невронни мрежи и тези, които обработват изображения?
- Какви предизвикателства срещате при анализа на визуални данни и какво би могло да улесни този процес?

## 2. Overview
Convolutional Neural Networks (CNNs) са специализиран тип дълбоки невронни мрежи, оптимизирани за обработка на данни с мрежова структура, като изображения. Те автоматично извличат и учат пространствени характеристики, което ги прави изключително ефективни за задачи като разпознаване на обекти, класификация и сегментация.

В по-широкия контекст на AI системите, CNNs са основен компонент в компютърното зрение и играят ключова роля в приложения от автономни автомобили до медицинска диагностика. Тяхната архитектура е вдъхновена от биологичните визуални системи, което им позволява да улавят локални зависимости и да намалят броя на параметрите спрямо класическите невронни мрежи.

CNNs имат значение не само за точността на моделите, но и за ефективността на обучението и изчислителните ресурси, което ги прави предпочитан избор в индустрията и изследванията.

## 3. Key Concepts
- **Convolution (Свиване)** – Операция, при която малък филтър (ядро) се плъзга върху входните данни, извличайки локални характеристики. Може да се представи като „прозорец“, който сканира изображението.
- **Filter / Kernel (Филтър / Ядро)** – Малка матрица с параметри, която се учи да разпознава специфични модели като ръбове или текстури.
- **Feature Map (Карта на характеристиките)** – Резултатът от прилагането на филтъра върху входа, показващ къде са открити определени характеристики.
- **Pooling (Подизвадка)** – Процес на намаляване на размерите на feature map, като се запазват най-важните характеристики, например чрез max pooling.
- **Stride (Стъпка)** – Колко позиции се премества филтърът при всяко прилагане, влияещ на размерите на изхода.
- **Padding (Допълване)** – Добавяне на допълнителни пиксели около входа, за да се контролира размерът на изхода и да се запазят граничните характеристики.
- **Fully Connected Layer (Напълно свързан слой)** – Класически слой, който свързва всички неврони от предишния слой, използван в края на CNN за класификация.
- **Receptive Field (Рецептивно поле)** – Областта от входа, която влияе върху един неврон в по-горен слой, аналогично на зрителното поле в биологията.

## 4. Step-by-step Learning Path
1. **Запознайте се с основите на свиването и филтрите**  
   - Задача: Напишете функция за прилагане на 3x3 филтър върху малка матрица с ръчно дефинирани стойности.  
   - Въпроси: Какво се случва, когато филтърът се плъзга с различни стъпки? Какво означава padding?

2. **Разберете ролята на pooling слоевете**  
   - Задача: Имплементирайте max pooling върху feature map с размер 4x4.  
   - Въпроси: Как pooling влияе на размерите на данните? Защо е полезен?

3. **Изучете архитектурата на стандартен CNN**  
   - Задача: Анализирайте примерна архитектура (например LeNet-5) и опишете функцията на всеки слой.  
   - Въпроси: Как свиването и pooling се комбинират? Защо има напълно свързани слоеве в края?

4. **Обучение на прост CNN върху реален набор от данни**  
   - Задача: Използвайте TensorFlow или PyTorch, за да обучите CNN върху MNIST или CIFAR-10.  
   - Въпроси: Какви са ефектите от различни размери на филтрите и броя на слоевете?

5. **Оптимизация и регуляризация**  
   - Задача: Добавете dropout и batch normalization в модела и сравнете резултатите.  
   - Въпроси: Как тези техники влияят на обучението и пренастройката?

## 5. Examples
### Пример 1: Проста свивка върху изображение
```python
import numpy as np

image = np.array([[1, 2, 3],
                  [4, 5, 6],
                  [7, 8, 9]])

kernel = np.array([[1, 0],
                   [0, -1]])

def convolve2d(image, kernel):
    output_shape = (image.shape[0] - kernel.shape[0] + 1,
                    image.shape[1] - kernel.shape[1] + 1)
    output = np.zeros(output_shape)
    for i in range(output_shape[0]):
        for j in range(output_shape[1]):
            region = image[i:i+kernel.shape[0], j:j+kernel.shape[1]]
            output[i, j] = np.sum(region * kernel)
    return output

print(convolve2d(image, kernel))
```

### Пример 2: Обучение на CNN с PyTorch върху MNIST
```python
import torch
import torch.nn as nn
import torch.optim as optim
from torchvision import datasets, transforms

class SimpleCNN(nn.Module):
    def __init__(self):
        super().__init__()
        self.conv1 = nn.Conv2d(1, 10, kernel_size=5)
        self.pool = nn.MaxPool2d(2)
        self.fc1 = nn.Linear(10*12*12, 50)
        self.fc2 = nn.Linear(50, 10)

    def forward(self, x):
        x = self.pool(torch.relu(self.conv1(x)))
        x = x.view(-1, 10*12*12)
        x = torch.relu(self.fc1(x))
        x = self.fc2(x)
        return x

# Тук следва код за обучение и тестване на модела
```

## 6. Common Pitfalls
- **Неправилно разбиране на padding и stride** – Може да доведе до неочаквани размери на изхода, което пречи на свързването на слоевете. Винаги проверявайте размерите след всеки слой.
- **Прекалено големи филтри в началото** – Това може да загуби локалната информация и да увеличи броя на параметрите ненужно.
- **Недостатъчно данни или липса на регуляризация** – Води до пренастройка (overfitting), особено при дълбоки CNN.
- **Игнориране на нормализацията на входните данни** – Влошава обучението и забавя конвергенцията.
- **Липса на визуализация на feature maps** – Без да се разбере какво учи мрежата, е трудно да се оптимизира архитектурата.

## 7. Short Retrieval Quiz
1. Какво представлява операцията convolution в CNN?
2. Защо използваме pooling слоеве?
3. Какво е receptive field и защо е важно?
4. Как padding влияе на размерите на изхода?
5. Каква е ролята на напълно свързаните слоеве в CNN?
6. Какви са основните предимства на CNN пред класическите невронни мрежи при обработка на изображения?
7. Какво може да причини пренастройка в CNN и как да я избегнем?

## 8. Quick Recap
- CNNs са специализирани невронни мрежи, оптимизирани за обработка на данни с пространствена структура.
- Основните операции са convolution, pooling, padding и използването на филтри за извличане на характеристики.
- CNN архитектурата комбинира локално свързани слоеве с напълно свързани слоеве за класификация.
- Правилната настройка на параметри като stride и padding е критична за успешното обучение.
- Регуляризация и нормализация са ключови за избягване на пренастройка.
- Практическото обучение върху реални данни е най-добрият начин да се разбере и усвои концепцията.

## 9. Spaced Review Plan

| Време след първоначално учене | Прегледна задача / въпрос                              |
|-------------------------------|-------------------------------------------------------|
| 1 ден                         | Обяснете с прости думи как работи convolution.        |
| 3 дни                         | Опишете ролята на pooling и padding в CNN.            |
| 1 седмица                    | Направете кратък преглед на архитектурата на CNN.     |
| 1 месец                      | Създайте малък CNN модел и обяснете избора на параметри. |