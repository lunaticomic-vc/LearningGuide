# External_memory_algorithms

## 1. Activate Prior Knowledge

- Какво представлява външната памет и как се различава от вътрешната памет (RAM) в компютърните системи?
- Защо алгоритмите, които работят с големи обеми данни, не могат да разчитат изцяло на вътрешната памет?
- Какви предизвикателства могат да възникнат при обработката на данни, които не могат да се поберат в RAM, особено в контекста на големи AI модели или системи за обработка на данни?

## 2. Overview

Външната памет (external memory) се отнася до устройства за съхранение, които са по-бавни, но с много по-голям капацитет от вътрешната памет (RAM), като твърди дискове (HDD), SSD или мрежови хранилища. Алгоритмите за външна памет са специално проектирани да минимизират броя на операциите за четене и запис към тези устройства, тъй като те са основният тесен бутилка в системи с големи данни.

Тези алгоритми са критични в съвременните AI системи и софтуерни инженерни проекти, където обемите на данни често надвишават капацитета на RAM. Например, при обучение на големи модели или обработка на огромни бази данни, ефективността на външната памет може да определи цялостната производителност.

Външната памет не е просто „по-бавна памет“ – тя изисква различен подход към алгоритмичния дизайн, който се фокусира върху блокови операции, оптимизация на достъпа и минимизиране на случайните четения и записи. Разбирането на тези алгоритми е ключово за разработчици, които искат да изграждат мащабируеми и ефективни системи.

## 3. Key Concepts

- **External Memory (Външна памет)** – Устройства за съхранение с голям капацитет, но по-бавен достъп от RAM. Можем да си я представим като голям склад, който е по-отдалечен, отколкото работното бюро (RAM).
- **I/O Operations (Входно-изходни операции)** – Операциите за четене и запис към външната памет, които са основният фактор за производителността на алгоритмите за външна памет.
- **Block Transfer (Блоково прехвърляне)** – Данните се четат и записват на блокове, а не по отделни елементи, за да се намали броят на I/O операциите.
- **I/O Complexity (I/O сложност)** – Мярка за броя на блоковите операции, необходими за изпълнение на алгоритъма, подобно на времевата сложност, но за външна памет.
- **Buffering (Буфериране)** – Използване на RAM като междинен кеш за намаляване на броя на достъпите до външната памет.
- **External Sorting (Външно сортиране)** – Техника за сортиране на данни, които не могат да се поберат в RAM, чрез разделяне на данните на части, сортиране на всяка част и след това сливане.
- **Streaming Model (Модел на поточно обработване)** – Обработка на данни, които пристигат последователно и не могат да се съхраняват изцяло в паметта.

## 4. Step-by-step Learning Path

1. **Разберете разликата между вътрешна и външна памет**
   - Фокус: Концептуална разлика и причините за използване на външна памет.
   - Задача: Напишете кратко резюме за предимствата и ограниченията на външната памет.
   - Въпроси: Защо достъпът до външна памет е по-бавен? Как това влияе на алгоритмите?

2. **Изучете блоковия модел на достъп**
   - Фокус: Как данните се четат и записват на блокове.
   - Задача: Симулирайте четене и запис на данни на блокове в Python (напр. четене на файл на части).
   - Въпроси: Как блоковото прехвърляне намалява броя на I/O операциите?

3. **Проучете външно сортиране (External Merge Sort)**
   - Фокус: Основен алгоритъм за сортиране на големи данни.
   - Задача: Имплементирайте опростена версия на външно сортиране върху голям файл.
   - Въпроси: Какво е разделяне на runs? Как става сливането?

4. **Разгледайте буферирането и кеширането**
   - Фокус: Използване на RAM за оптимизиране на достъпа.
   - Задача: Добавете буфер към вашата имплементация на външно сортиране.
   - Въпроси: Как буферирането намалява броя на I/O операциите?

5. **Изучете други външни алгоритми (напр. външно сливане, външно търсене)**
   - Фокус: Разнообразие от алгоритми за външна памет.
   - Задача: Анализирайте алгоритъм за външно търсене (B-Tree) и обяснете защо е подходящ за външна памет.
   - Въпроси: Как B-Tree минимизира I/O операциите?

## 5. Examples

### Пример 1: Външно сортиране (External Merge Sort)

```python
def external_merge_sort(file_path, chunk_size):
    import heapq
    runs = []
    with open(file_path, 'r') as f:
        while True:
            lines = f.readlines(chunk_size)
            if not lines:
                break
            lines.sort()
            run_file = f'run_{len(runs)}.txt'
            with open(run_file, 'w') as run_f:
                run_f.writelines(lines)
            runs.append(run_file)

    # Сливане на runs
    files = [open(run, 'r') for run in runs]
    heap = []
    for i, file in enumerate(files):
        line = file.readline()
        if line:
            heapq.heappush(heap, (line, i))

    with open('sorted_output.txt', 'w') as out:
        while heap:
            smallest, idx = heapq.heappop(heap)
            out.write(smallest)
            next_line = files[idx].readline()
            if next_line:
                heapq.heappush(heap, (next_line, idx))

    for file in files:
        file.close()
```

### Пример 2: Буфериране на четене от файл

```python
def buffered_read(file_path, buffer_size=1024):
    with open(file_path, 'r') as f:
        while True:
            data = f.read(buffer_size)
            if not data:
                break
            process(data)  # обработка на данните
```

### Пример 3: Използване на B-Tree за външно търсене (концептуално)

- B-Tree е дървовидна структура, оптимизирана за минимизиране на I/O операции, като съхранява множество ключове в един възел (блок), което намалява дълбочината и броя на достъпите до диска.

## 6. Common Pitfalls

- **Игнориране на блоковия достъп** – Опит за четене или запис на отделни елементи вместо блокове води до огромен брой I/O операции.
- **Недостатъчно буфериране** – Малки или липсващи буфери увеличават броя на достъпите до диска и забавят алгоритъма.
- **Прекалено големи буфери** – Могат да изчерпят RAM и да доведат до swap, което влошава производителността.
- **Липса на анализ на I/O сложността** – Използване на алгоритми, които са ефективни в RAM, но не и при външна памет.
- **Неправилно управление на временни файлове** – При външно сортиране и други алгоритми, временните файлове трябва да се управляват внимателно, за да не се запълни дисковото пространство.

## 7. Short Retrieval Quiz

1. Какво представлява I/O операцията във външната памет?
2. Защо блоковото прехвърляне е по-ефективно от четенето на отделни елементи?
3. Какво е основната идея зад външното сортиране?
4. Как буферирането влияе на производителността на външните алгоритми?
5. Защо B-Tree е подходяща структура за външна памет?
6. Каква е основната разлика между вътрешна и външна памет?
7. Какво може да се случи, ако буферът е твърде голям?

## 8. Quick Recap

- Външната памет е по-бавна, но с голям капацитет, изисква специални алгоритми.
- Основната цел е да се минимизира броят на I/O операциите чрез блоково прехвърляне.
- Външното сортиране е класически пример за алгоритъм, оптимизиран за външна памет.
- Буферирането използва RAM за кеширане и намаляване на достъпите до диска.
- Структури като B-Tree са проектирани да минимизират I/O операции при търсене.
- Грешките при дизайн на външни алгоритми често са свързани с неправилно управление на блокове и буфери.
- Разбирането на I/O сложността е ключово за оптимизацията на алгоритмите за външна памет.

## 9. Spaced Review Plan

| Време след учене | Промпт за преглед                                    |
|------------------|-----------------------------------------------------|
| 1 ден            | Обяснете защо външната памет изисква специални алгоритми. |
| 3 дни            | Опишете как работи външното сортиране и ролята на блоковете. |
| 1 седмица        | Дайте пример за буфериране и обяснете как подобрява производителността. |
| 1 месец          | Сравнете I/O сложността с времевата сложност и защо е важна. |