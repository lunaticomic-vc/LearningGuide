# 12 - Data serialization and communication protocols

## 1. Activate Prior Knowledge

- Как се обменят данни между различни компоненти на една AI система или между различни услуги в софтуерна архитектура?
- Срещали ли сте формати като JSON, XML или Protocol Buffers при работа с данни? Какви са били предимствата и недостатъците им?
- Защо е важно данните да бъдат представени по стандартизиран начин при комуникация между различни езици или платформи?

## 2. Overview

Data serialization и комуникационните протоколи са основни градивни елементи в съвременните софтуерни системи, особено когато става дума за разпределени приложения, микросървиси или AI системи. Serialization представлява процесът на преобразуване на сложни структури от данни (например обекти) във формат, който може да се съхранява или предава по мрежа, а след това да се възстанови обратно в оригиналната си форма.

Комуникационните протоколи определят правилата и формата, по които се обменят сериализираните данни между различни системи или компоненти. Те осигуряват съвместимост, сигурност и ефективност при обмена на информация.

В контекста на AI и съвременния софтуерен инженеринг, правилният избор на serialization формат и комуникационен протокол може да окаже значително влияние върху производителността, мащабируемостта и надеждността на системата. Разбирането на тези концепции е ключово за изграждане на устойчиви и ефективни решения.

## 3. Key Concepts

- **Serialization** – Процесът на преобразуване на структура от данни или обект във формат, подходящ за съхранение или предаване (например в низ или байтов масив). Мислете за това като "опаковане" на данните в кутия за транспортиране.
- **Deserialization** – Обратният процес: възстановяване на оригиналната структура от сериализирания формат. Все едно разопаковате кутията и подреждате съдържанието.
- **Data format** – Спецификация за това как са структурирани сериализираните данни (напр. JSON, XML, Protocol Buffers, Avro).
- **Communication protocol** – Набор от правила за изпращане и получаване на данни между системи (напр. HTTP, gRPC, MQTT).
- **Interoperability** – Способността на различни системи или компоненти да обменят данни помежду си, независимо от езика или платформата.
- **Schema** – Описание на структурата на данните, което често се използва при формати като Avro или Protocol Buffers за валидиране и съвместимост.

## 4. Step-by-step Learning Path

1. **Запознайте се с основите на serialization**
   - Фокус: Какво представлява serialization и защо е необходима.
   - Практическа задача: Сериализирайте прост Python обект (напр. речник) във формат JSON и го запишете във файл.
   - Retrieval questions: Какво е serialization? Кога се използва?

2. **Изследвайте различни формати за serialization**
   - Фокус: Разлики между текстови (JSON, XML) и бинарни (Protocol Buffers, Avro) формати.
   - Практическа задача: Сравнете размера на един и същи обект, сериализиран в JSON и в Protocol Buffers.
   - Retrieval questions: Какви са предимствата на бинарните формати? Кога бихте избрали JSON?

3. **Работа с комуникационни протоколи**
   - Фокус: Как протоколите като HTTP и gRPC използват serialization за обмен на данни.
   - Практическа задача: Изпратете сериализирани данни чрез HTTP POST заявка между два локални скрипта.
   - Retrieval questions: Каква е ролята на протокола при обмен на данни? Как serialization се вписва в този процес?

4. **Създаване на schema и валидиране на данни**
   - Фокус: Как схемите помагат за съвместимост и валидиране.
   - Практическа задача: Дефинирайте schema за Protocol Buffers и сериализирайте/десериализирайте примерен обект.
   - Retrieval questions: Какво е schema? Защо е важно при еволюция на данните?

5. **Интеграция в реална система**
   - Фокус: Как serialization и протоколите се използват в микросървисна архитектура или AI pipeline.
   - Практическа задача: Реализирайте прост клиент-сървър обмен с gRPC и Protocol Buffers.
   - Retrieval questions: Как serialization влияе на производителността? Какви са рисковете при несъвместими формати?

## 5. Examples

### Пример 1: Сериализация с JSON в Python

```python
import json

data = {"name": "Ivan", "score": 95}
with open("data.json", "w") as f:
    json.dump(data, f)
```

### Пример 2: Сериализация с Protocol Buffers (Python)

```proto
// file: person.proto
syntax = "proto3";
message Person {
  string name = 1;
  int32 score = 2;
}
```
```python
import person_pb2

person = person_pb2.Person(name="Ivan", score=95)
with open("person.bin", "wb") as f:
    f.write(person.SerializeToString())
```

### Пример 3: Изпращане на сериализирани данни по HTTP

```python
import requests
import json

data = {"message": "Hello, world!"}
requests.post("http://localhost:8000/endpoint", json=data)
```

## 6. Common Pitfalls

- **Несъвместимост между версии на schema** – При промяна на структурата на данните без съответна миграция или обратна съвместимост, може да се получат грешки при десериализация.
- **Използване на неподходящ формат** – Избор на текстов формат (напр. JSON) за големи или чувствителни към производителност данни вместо бинарен (напр. Protocol Buffers).
- **Липса на валидация** – Приемане на данни без проверка по schema може да доведе до неочаквани грешки или проблеми със сигурността.
- **Пренебрегване на сигурността** – Десериализация на данни от недоверени източници може да доведе до атаки (напр. code injection).

## 7. Short Retrieval Quiz

1. Какво представлява serialization и защо се използва?
2. Кои са основните разлики между JSON и Protocol Buffers?
3. Каква е ролята на schema при сериализацията?
4. Какво е interoperability и защо е важно?
5. Как комуникационните протоколи използват serialization?
6. Какви са рисковете при десериализация на данни от недоверени източници?
7. Дайте пример за реален случай, в който бихте използвали бинарен формат за serialization.

## 8. Quick Recap

- Serialization преобразува данни във формат, подходящ за съхранение или предаване.
- Deserialization възстановява оригиналната структура от сериализирания формат.
- Изборът на формат (JSON, Protocol Buffers и др.) влияе на производителността и съвместимостта.
- Комуникационните протоколи определят как се обменят сериализирани данни между системи.
- Schema осигурява структура, валидация и съвместимост при еволюция на данните.
- Интероперабилността е ключова за успешен обмен на данни между различни платформи.
- Сигурността и валидацията са критични при работа със сериализирани данни.

## 9. Spaced Review Plan

| Time      | Review Prompt                                                      |
|-----------|--------------------------------------------------------------------|
| 1 day     | Обяснете разликата между serialization и deserialization с пример. |
| 3 days    | Сравнете JSON и Protocol Buffers: кога бихте използвали всеки?     |
| 1 week    | Опишете процеса на интеграция на serialization в микросървис.      |
| 1 month   | Дискутирайте често срещани грешки и как да ги избегнете.           |