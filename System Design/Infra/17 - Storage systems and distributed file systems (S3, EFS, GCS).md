# 17 - Storage systems and distributed file systems (S3, EFS, GCS)

## 1. Activate Prior Knowledge

- Какви са основните разлики между локално съхранение (напр. SSD/HDD) и облачно съхранение?
- Кога и защо бихте използвали споделена файлова система в разпределена среда, например при мащабируеми AI приложения?
- Какви предизвикателства възникват при достъп до големи обеми данни от множество машини едновременно?

## 2. Overview

Системите за съхранение и разпределените файлови системи са гръбнакът на съвременните облачни и AI решения. Те позволяват на множество сървъри и услуги да четат и записват данни едновременно, без да се притесняват за физическото местоположение или управлението на хардуера.

Облачните доставчици като AWS и Google Cloud предлагат различни видове услуги за съхранение: обектно (S3, GCS), файлово (EFS), и блоково. Всяка от тях има специфични предимства и ограничения, които влияят на избора им в зависимост от нуждите на приложението.

В контекста на AI и софтуерното инженерство, правилният избор на система за съхранение е критичен за производителността, сигурността и разходите. Например, големи AI модели често изискват бърз и паралелен достъп до огромни датасети, което налага използването на разпределени файлови системи.

Разбирането на тези системи ви позволява да изграждате по-ефективни, мащабируеми и надеждни приложения, които могат да обработват големи обеми данни в облака.

## 3. Key Concepts

- Обектно съхранение (Object Storage) – Съхранява данни като обекти с метаданни и уникален идентификатор; подходящо за големи, неизменяеми файлове (напр. S3, GCS).
- Файлова система (File System) – Организира данни в йерархия от директории и файлове; познат модел от локалните дискове (напр. EFS).
- Разпределена файлова система (Distributed File System) – Позволява достъп до файлове от множество машини едновременно, сякаш са на един диск; аналогия: споделена папка в мрежа, но в много по-голям мащаб.
- S3 (Amazon Simple Storage Service) – Обектно съхранение на AWS, подходящо за архиви, бекъпи, статични уеб ресурси.
- EFS (Elastic File System) – Разпределена файлова система на AWS, позволяваща паралелен достъп от много EC2 инстанции.
- GCS (Google Cloud Storage) – Обектно съхранение на Google Cloud, подобно на S3.
- Достъпност (Availability) – Вероятността данните да са достъпни по всяко време.
- Устойчивост (Durability) – Вероятността данните да не бъдат загубени или повредени.
- Латентност (Latency) – Времето за достъп до данните; критично при AI тренировки.
- Капацитет (Scalability) – Способността на системата да се разширява без загуба на производителност.

## 4. Step-by-step Learning Path

1. **Разграничете видовете съхранение**  
   - Фокус: Разберете разликите между обектно, файлово и блоково съхранение.  
   - Задача: Направете таблица с плюсове и минуси на S3, EFS и GCS.  
   - Въпроси: Кога бихте избрали обектно пред файлово съхранение? Какви са типичните случаи на употреба?

2. **Създайте и използвайте S3/GCS bucket**  
   - Фокус: Практикувайте качване, изтегляне и управление на обекти.  
   - Задача: Качете файл в S3 или GCS с помощта на CLI или SDK.  
   - Въпроси: Как се идентифицира обект в S3? Как се контролира достъпът до bucket?

3. **Монтирайте и използвайте EFS**  
   - Фокус: Разберете как се монтира EFS към EC2 инстанция и как се споделят файлове.  
   - Задача: Създайте EFS, монтирайте го на две EC2 инстанции и създайте файл, достъпен и от двете.  
   - Въпроси: Какви са предимствата на EFS пред локален диск? Как се осигурява сигурност при EFS?

4. **Интегрирайте съхранение в AI pipeline**  
   - Фокус: Използвайте S3/GCS за съхранение на датасети и модели.  
   - Задача: Заредете датасет директно от S3/GCS в AI training скрипт (напр. с boto3 или google-cloud-storage).  
   - Въпроси: Какви са предимствата на директния достъп до данни в облака? Как се оптимизира разходът?

5. **Мониторинг и оптимизация**  
   - Фокус: Следете разходи, латентност и използване на ресурси.  
   - Задача: Активирайте logging и анализирайте достъпа до S3/EFS/GCS.  
   - Въпроси: Как се откриват неефективни заявки? Какви са начините за оптимизация?

## 5. Examples

### Пример 1: Качване на файл в S3 с Python (boto3)
```python
import boto3
s3 = boto3.client('s3')
s3.upload_file('localfile.txt', 'my-bucket', 'data/localfile.txt')
```

### Пример 2: Монтиране на EFS към EC2 (Linux)
```bash
sudo yum install -y amazon-efs-utils
sudo mkdir /mnt/efs
sudo mount -t efs fs-12345678:/ /mnt/efs
```

### Пример 3: Зареждане на данни от GCS в Python
```python
from google.cloud import storage
client = storage.Client()
bucket = client.get_bucket('my-bucket')
blob = bucket.blob('data/myfile.csv')
content = blob.download_as_text()
```

## 6. Common Pitfalls

- **Грешен избор на тип съхранение** – Използване на S3 за работни файлове с чести малки промени води до ниска производителност; използвайте EFS за такива случаи.
- **Недостатъчно контролирани права за достъп** – Липсата на правилни политики може да изложи данните на риск; винаги настройвайте IAM роли и bucket policies.
- **Пренебрегване на разходите** – Честото четене/запис или съхранение на много малки файлове може да увеличи разходите; анализирайте billing отчетите редовно.
- **Липса на мониторинг** – Без logging и мониторинг е трудно да се открият проблеми с производителността или сигурността.

## 7. Short Retrieval Quiz

1. Каква е основната разлика между S3 и EFS?
2. Защо обектното съхранение е предпочитано за архиви и бекъпи?
3. Как се осигурява паралелен достъп до файлове в EFS?
4. Какви са рисковете при неправилно конфигуриран публичен bucket?
5. Какви са предимствата на използването на GCS за AI тренировки?
6. Как се идентифицира обект в S3?
7. Кога бихте използвали разпределена файлова система вместо локален диск?

## 8. Quick Recap

- Обектното съхранение (S3, GCS) е подходящо за големи, неизменяеми файлове и архиви.
- Файловите системи (EFS) позволяват паралелен достъп и споделяне на файлове между множество машини.
- Изборът на система за съхранение влияе директно върху производителността, сигурността и разходите.
- S3 и GCS използват уникални ключове за достъп до обекти, а EFS се монтира като стандартна файлова система.
- Правилната конфигурация на достъпа и мониторингът са критични за сигурността и ефективността.
- Интеграцията на облачно съхранение в AI pipeline ускорява обработката на големи датасети.
- Анализът на разходите и оптимизацията са важни за устойчиви облачни решения.

## 9. Spaced Review Plan

| Review Time | Prompt                                               |
|-------------|-----------------------------------------------------|
| 1 day       | Обяснете разликата между S3, EFS и GCS с примери.   |
| 3 days      | Кога бихте използвали EFS вместо S3? Защо?          |
| 1 week      | Как се интегрира S3/GCS в AI training pipeline?     |
| 1 month     | Опишете типични грешки при работа с облачно съхранение и как да ги избегнете. |