# 16 - Network topology and VPC|subnet configuration

## 1. Activate Prior Knowledge

- Какво представлява мрежовата топология и как тя влияе върху комуникацията между различни компоненти на една AI система?
- Кога и защо бихте използвали виртуална частна мрежа (VPC) при разработката или внедряването на софтуерни решения в облака?
- Какви са основните разлики между публични и частни подмрежи и как това се отразява на сигурността на вашите приложения?

## 2. Overview

Мрежовата топология описва начина, по който различните устройства и ресурси са свързани и комуникират в една мрежа. В контекста на облачните услуги, като AWS, Google Cloud или Azure, виртуалните частни мрежи (VPC) позволяват на организациите да дефинират собствена, изолирана мрежова среда, в която могат да разполагат и управляват ресурси като сървъри, бази данни и AI услуги.

Конфигурирането на VPC и подмрежи (subnets) е ключово за осигуряване на сигурност, контрол на трафика и оптимална производителност. Чрез внимателно планиране на топологията и разпределението на подмрежите, инженерите могат да ограничат достъпа до чувствителни ресурси, да минимизират латентността и да улеснят мащабирането на системите.

Тази тема е особено важна за AI системи, където често се налага интеграция между различни услуги, обработка на големи обеми данни и гарантиране на висока степен на сигурност. Разбирането на мрежовата топология и конфигурацията на VPC/subnet е фундаментално умение за всеки софтуерен инженер, работещ с облачни платформи.

## 3. Key Concepts

- Network Topology – Начинът, по който устройствата и ресурсите са свързани в една мрежа. Може да се мисли като "пътна карта" на комуникацията.
- VPC (Virtual Private Cloud) – Изолирана виртуална мрежа в облака, в която можете да дефинирате собствени IP адреси, подмрежи и правила за достъп.
- Subnet – Подразделение на VPC, което групира ресурси по мрежови или функционални критерии. Аналогично на "квартал" в един град.
- CIDR (Classless Inter-Domain Routing) – Формат за обозначаване на IP адресни пространства и мрежови маски (напр. 10.0.0.0/24).
- Route Table – Таблица, която определя пътищата, по които трафикът се насочва в мрежата.
- Internet Gateway – Компонент, който позволява на ресурсите във VPC да комуникират с интернет.
- NAT Gateway – Позволява на ресурси в частни подмрежи да достъпват интернет, без да са директно достъпни отвън.
- Security Group – Виртуална защитна стена, която контролира входящия и изходящия трафик към ресурсите.

## 4. Step-by-step Learning Path

1. **Разберете основите на мрежовата топология**
   - Фокус: Видове топологии (звезда, мрежа, дърво) и тяхното приложение.
   - Практическа задача: Начертайте схема на проста мрежа за AI система с три компонента.
   - Въпроси: Каква е разликата между топология "звезда" и "мрежа"? Как това влияе на устойчивостта?

2. **Създайте VPC в облачна платформа**
   - Фокус: Основни стъпки за създаване на VPC, избор на CIDR блок.
   - Практическа задача: Създайте VPC с CIDR блок 10.0.0.0/16.
   - Въпроси: Какво означава /16 в CIDR? Колко IP адреса включва?

3. **Конфигурирайте подмрежи (subnets)**
   - Фокус: Разделяне на VPC на публични и частни подмрежи.
   - Практическа задача: Създайте две подмрежи – една публична (10.0.1.0/24) и една частна (10.0.2.0/24).
   - Въпроси: Как се определя дали подмрежата е публична или частна? Какви ресурси бихте поставили във всяка?

4. **Настройте маршрутизиране и интернет достъп**
   - Фокус: Добавяне на Internet Gateway и настройка на route tables.
   - Практическа задача: Свържете публичната подмрежа с Internet Gateway, а частната – с NAT Gateway.
   - Въпроси: Каква е ролята на NAT Gateway? Как се осигурява сигурност на частната подмрежа?

5. **Приложете политики за сигурност**
   - Фокус: Създаване и прилагане на security groups и network ACLs.
   - Практическа задача: Ограничете достъпа до сървър в частната подмрежа само от определен IP адрес.
   - Въпроси: Как security group се различава от network ACL? Кога бихте използвали едното пред другото?

## 5. Examples

### Пример 1: Създаване на VPC с две подмрежи в AWS (Terraform)

```hcl
resource "aws_vpc" "main" {
  cidr_block = "10.0.0.0/16"
}

resource "aws_subnet" "public" {
  vpc_id     = aws_vpc.main.id
  cidr_block = "10.0.1.0/24"
  map_public_ip_on_launch = true
}

resource "aws_subnet" "private" {
  vpc_id     = aws_vpc.main.id
  cidr_block = "10.0.2.0/24"
}
```

### Пример 2: Маршрутизиране на трафик към интернет

```hcl
resource "aws_internet_gateway" "gw" {
  vpc_id = aws_vpc.main.id
}

resource "aws_route_table" "public" {
  vpc_id = aws_vpc.main.id

  route {
    cidr_block = "0.0.0.0/0"
    gateway_id = aws_internet_gateway.gw.id
  }
}

resource "aws_route_table_association" "public" {
  subnet_id      = aws_subnet.public.id
  route_table_id = aws_route_table.public.id
}
```

### Пример 3: Ограничаване на достъпа чрез security group

```hcl
resource "aws_security_group" "private_sg" {
  vpc_id = aws_vpc.main.id

  ingress {
    from_port   = 22
    to_port     = 22
    protocol    = "tcp"
    cidr_blocks = ["203.0.113.0/24"]
  }
}
```

## 6. Common Pitfalls

- **Използване на твърде широк CIDR блок** – Това може да доведе до изчерпване на IP адреси или конфликт с други мрежи. Винаги планирайте внимателно адресното пространство.
- **Поставяне на чувствителни ресурси в публични подмрежи** – Това увеличава риска от неоторизиран достъп. Използвайте частни подмрежи за бази данни и бекенд услуги.
- **Липса на правилно маршрутизиране** – Ако route tables не са коректно конфигурирани, ресурсите няма да могат да комуникират с интернет или помежду си.
- **Прекалено отворени security groups** – Оставянето на отворени портове за всички IP адреси е честа грешка. Ограничете достъпа само до необходимите адреси и портове.

## 7. Short Retrieval Quiz

1. Какво представлява VPC и защо е важно да се използва?
2. Каква е разликата между публична и частна подмрежа?
3. За какво служи Internet Gateway?
4. Как NAT Gateway помага на частните подмрежи?
5. Какво означава CIDR нотацията 10.0.0.0/24?
6. Как security group се различава от network ACL?
7. Какви са рисковете при поставяне на база данни в публична подмрежа?

## 8. Quick Recap

- Мрежовата топология определя начина на свързване и комуникация между ресурсите.
- VPC осигурява изолирана мрежова среда в облака.
- Подмрежите разделят ресурсите по функционалност и ниво на достъп.
- CIDR блоковете определят адресното пространство на мрежата.
- Internet Gateway и NAT Gateway управляват достъпа до интернет.
- Security groups и network ACLs контролират сигурността на трафика.
- Правилната конфигурация на топологията и подмрежите е критична за сигурността и производителността на системата.

## 9. Spaced Review Plan

| Review Time | Prompt                                         |
|-------------|------------------------------------------------|
| 1 day       | Обяснете разликата между публична и частна подмрежа. |
| 3 days      | Начертайте схема на VPC с две подмрежи и опишете маршрутизацията. |
| 1 week      | Дайте пример за security group и обяснете кога бихте я използвали. |
| 1 month     | Опишете стъпките за създаване на сигурна и мащабируема VPC топология. |