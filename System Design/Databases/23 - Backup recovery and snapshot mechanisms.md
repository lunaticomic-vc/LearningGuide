# 23 - Backup recovery and snapshot mechanisms

## 1. Activate Prior Knowledge

- Какви методи за защита на данни познавате и използвали ли сте някога резервно копиране (backup) в реална система?
- Какви са потенциалните последствия, ако важна информация в AI система или софтуерен проект бъде загубена или повредена?
- Можете ли да си представите ситуация, в която трябва бързо да възстановите работещо състояние на система след срив?

## 2. Overview

Backup recovery и snapshot механизмите са ключови техники за защита на данни и осигуряване на устойчивост на софтуерни системи, включително такива, които използват изкуствен интелект. Те позволяват възстановяване на информация след загуба, повреда или злонамерена атака, като минимизират времето за престой и риска от необратими щети.

Backup представлява създаване на копие на данните или системното състояние, което може да бъде използвано за възстановяване при нужда. Snapshot е моментна снимка на състоянието на система или база данни, която позволява връщане назад във времето до точно определен момент.

Тези механизми са критични за бизнеси и организации, които разчитат на непрекъсната работа на ИТ инфраструктурата си, особено при работа с чувствителни или големи обеми данни. В контекста на AI системи, те осигуряват възможност за възстановяване на модели, тренировъчни данни и конфигурации.

## 3. Key Concepts

- **Backup** – Резервно копие на данни или системно състояние, което се съхранява отделно от оригинала. Може да бъде пълно, диференциално или инкрементално.
- **Recovery** – Процесът на възстановяване на данни или система от резервно копие или snapshot след загуба или повреда.
- **Snapshot** – Моментна снимка на състоянието на система, файлова система или база данни. Може да се мисли като „замразяване на времето“ за бързо връщане назад.
- **Restore Point** – Конкретен момент, до който може да се върне системата при нужда от възстановяване.
- **Retention Policy** – Политика, определяща колко дълго и къде се съхраняват резервните копия и snapshot-ите.
- **Disaster Recovery** – План и процеси за възстановяване на системи след мащабен срив или катастрофа.
- **Consistency** – Гаранция, че резервното копие или snapshot съдържа валидно и използваемо състояние на данните.

## 4. Step-by-step Learning Path

1. **Разберете разликата между backup и snapshot**
   - Фокус: Дефиниции, предимства и недостатъци.
   - Задача: Направете таблица, сравняваща backup и snapshot по критерии като скорост, обем, възстановяване.
   - Въпроси: Как snapshot се различава от традиционния backup? Кога бихте предпочели едното пред другото?

2. **Изучете видовете backup**
   - Фокус: Пълно, инкрементално, диференциално резервно копие.
   - Задача: Опишете сценарий, в който бихте използвали всеки вид.
   - Въпроси: Какво е инкрементален backup? Какви са предимствата на диференциалния backup?

3. **Практикувайте създаване на snapshot**
   - Фокус: Snapshot на файлова система или база данни (например с LVM или PostgreSQL).
   - Задача: Създайте snapshot на тестова база данни или директория.
   - Въпроси: Какви са стъпките за създаване на snapshot? Какво се случва при възстановяване от snapshot?

4. **Настройте автоматизирани backup-и**
   - Фокус: Скриптове, инструменти (rsync, cron, cloud backup).
   - Задача: Настройте автоматичен дневен backup на директория.
   - Въпроси: Как да проверите дали backup-ът е успешен? Какви са рисковете при автоматизацията?

5. **Тествайте процеса на възстановяване (recovery)**
   - Фокус: Проверка на backup и snapshot чрез възстановяване.
   - Задача: Възстановете данни от създаден по-рано backup или snapshot.
   - Въпроси: Какви грешки могат да възникнат при recovery? Как да се уверите, че възстановената система е консистентна?

## 5. Examples

### Пример 1: Backup на база данни с `pg_dump`
```bash
pg_dump -U postgres mydatabase > backup.sql
# Възстановяване:
psql -U postgres -d mydatabase < backup.sql
```

### Пример 2: Snapshot на файлова система с LVM
```bash
lvcreate --size 1G --snapshot --name my_snap /dev/vg0/my_volume
# Възстановяване:
lvconvert --merge /dev/vg0/my_snap
```

### Пример 3: Автоматизиран backup със скрипт и cron
```bash
# backup.sh
tar czf /backups/home_$(date +%F).tar.gz /home/user
# В crontab:
0 2 * * * /path/to/backup.sh
```

## 6. Common Pitfalls

- **Липса на тестове за възстановяване:** Много екипи правят backup-и, но не тестват recovery процеса – винаги валидирайте, че можете да възстановите!
- **Неправилно конфигурирани retention политики:** Прекалено кратко или дълго съхранение води до загуба на данни или излишни разходи.
- **Backup-и на същия диск/локация:** Ако оригиналът и backup-ът са на едно място, рискът от пълна загуба е голям.
- **Липса на консистентност:** Backup-и, направени по време на активни транзакции, може да са невалидни – използвайте механизми за консистентност.

## 7. Short Retrieval Quiz

1. Каква е основната разлика между backup и snapshot?
2. Какви са предимствата на инкременталния backup?
3. Защо е важно да се тестват recovery процесите?
4. Какво представлява retention policy?
5. Как snapshot помага при възстановяване след срив?
6. Какви рискове има при съхранение на backup-и на същия физически носител?
7. Какво означава консистентен backup?

## 8. Quick Recap

- Backup и snapshot са основни механизми за защита на данни и възстановяване на системи.
- Backup-ите могат да бъдат пълни, инкрементални или диференциални.
- Snapshot-ите позволяват бързо връщане към определен момент във времето.
- Recovery процесите трябва редовно да се тестват за надеждност.
- Retention policy определя колко дълго се пазят резервните копия.
- Консистентността на backup-ите е критична за успешното възстановяване.
- Съхранявайте backup-и на отделни и сигурни локации.

## 9. Spaced Review Plan

| Време     | Преговори/Въпроси                                              |
|-----------|---------------------------------------------------------------|
| 1 ден     | Каква е разликата между backup и snapshot?                    |
| 3 дни     | Кои са основните видове backup и кога се използват?           |
| 1 седмица | Как се създава и възстановява snapshot?                       |
| 1 месец   | Какви са добрите практики за backup recovery в реални системи?|
