# 07 - Data flow between modules and dependency handling

## 1. Activate Prior Knowledge

- Какво означава един модул да бъде „независим“ в рамките на по-голяма софтуерна система?
- Можете ли да си спомните ситуация, в която промяна в един компонент е довела до неочаквани грешки в други части на системата?
- Как според вас се осъществява обменът на данни между различни модули в една AI система?

## 2. Overview

В сложните софтуерни системи, особено при разработката на изкуствен интелект, модулите често трябва да обменят данни помежду си. Този обмен, наречен „data flow“, е от съществено значение за правилното функциониране на цялата система. Ако данните не се предават коректно или модулите зависят твърде силно един от друг, това може да доведе до трудности при поддръжката, разширяването или откриването на грешки.

Dependency handling (управление на зависимости) се отнася до начина, по който се организират и контролират връзките между модулите. Целта е да се минимизира т.нар. „coupling“ (свързаност) и да се увеличи „cohesion“ (сплотеност) на всеки модул, което прави системата по-гъвкава и устойчива на промени.

В AI системите, където често има множество специализирани компоненти (напр. обработка на данни, моделиране, визуализация), доброто управление на data flow и dependencies е ключово за ефективността и надеждността. Разбирането на тези принципи ви позволява да изграждате по-лесно разширяеми и поддържани решения.

## 3. Key Concepts

- **Module** – Самостоятелна част от софтуер, която изпълнява конкретна функция. Може да се сравни с отделна машина във фабрика.
- **Data flow** – Начинът, по който данните се предават между модулите. Представете си го като движение на стоки по транспортна лента между отделни цехове.
- **Dependency** – Връзка, при която един модул разчита на друг за данни или функционалност. Подобно на това как един отдел в компанията зависи от друг за определени ресурси.
- **Loose coupling** – Модулите са слабо свързани и могат да се променят независимо. Това е като да имате отделни екипи, които комуникират чрез ясни правила.
- **Tight coupling** – Модулите са силно зависими един от друг, което затруднява промени. Представете си двама работници, които могат да работят само заедно.
- **Interface (API)** – Дефинира как модулите комуникират помежду си. Аналогично на договор или протокол между две фирми.
- **Dependency Injection** – Техника, при която зависимостите се предоставят отвън, а не се създават вътре в модула. Това е като да получавате суровини от външен доставчик, вместо да ги произвеждате сами.

## 4. Step-by-step Learning Path

1. **Разберете ролята на модулите**
   - Фокус: Какво е модул и защо разделяме системата на модули?
   - Задача: Опишете с няколко изречения примерна система, разделена на поне три модула.
   - Въпроси: Какви са предимствата на модулния дизайн? Какво би се случило, ако всичко беше в един модул?

2. **Изследвайте data flow между модулите**
   - Фокус: Как се предават данни между модулите?
   - Задача: Начертайте схема (на хартия или дигитално) на потока от данни между модулите във вашия пример.
   - Въпроси: Какви видове данни се обменят? Как се гарантира, че данните са във верен формат?

3. **Идентифицирайте и управлявайте зависимости**
   - Фокус: Какви са зависимостите между модулите и как да ги управляваме?
   - Задача: Определете кои модули във вашата схема зависят един от друг и опишете тези зависимости.
   - Въпроси: Какво би се случило, ако един от зависимите модули се промени? Как може да се намали зависимостта?

4. **Използвайте интерфейси и dependency injection**
   - Фокус: Как интерфейсите и dependency injection помагат за по-добро управление на зависимостите?
   - Задача: Напишете прост интерфейс (на избран език) между два модула и имплементирайте dependency injection.
   - Въпроси: Какво печелите, ако използвате dependency injection? Как интерфейсите улесняват подмяната на модули?

5. **Тествайте и рефакторирайте**
   - Фокус: Как да откривате и премахвате излишни зависимости?
   - Задача: Прегледайте кода/схемата си и премахнете поне една ненужна зависимост.
   - Въпроси: Какво се промени след рефакторирането? Как това ще помогне при бъдещи промени?

## 5. Examples

### Пример 1: Data flow в AI pipeline

```python
# Модул за зареждане на данни
def load_data():
    return [1, 2, 3, 4]

# Модул за обработка на данни
def preprocess(data):
    return [x * 2 for x in data]

# Модул за анализ
def analyze(data):
    print(f"Средно аритметично: {sum(data)/len(data)}")

# Data flow между модулите
raw = load_data()
processed = preprocess(raw)
analyze(processed)
```

### Пример 2: Dependency Injection в Python

```python
class Database:
    def fetch(self):
        return "данни"

class Service:
    def __init__(self, db):
        self.db = db

    def process(self):
        data = self.db.fetch()
        print(f"Обработвам: {data}")

# Инжектиране на зависимостта
db = Database()
service = Service(db)
service.process()
```

### Пример 3: Интерфейс между модули

```python
# Интерфейс
class DataProvider:
    def get_data(self):
        raise NotImplementedError

# Имплементация
class FileDataProvider(DataProvider):
    def get_data(self):
        return "Данни от файл"

def process_data(provider: DataProvider):
    data = provider.get_data()
    print(f"Обработка: {data}")

provider = FileDataProvider()
process_data(provider)
```

## 6. Common Pitfalls

- **Твърде силна свързаност (tight coupling):** Модулите са прекалено зависими един от друг. Използвайте интерфейси и dependency injection, за да намалите тази зависимост.
- **Липса на ясни интерфейси:** Ако не дефинирате ясно как модулите комуникират, лесно възникват грешки при промени. Винаги използвайте добре документирани интерфейси.
- **Прекомерно споделяне на данни:** Ако модулите обменят твърде много информация, става трудно да се проследят грешки. Ограничете обмена само до необходимото.
- **Необмислено управление на зависимости:** Ако зависимостите не се управляват систематично, системата става трудна за поддръжка. Използвайте dependency injection и dependency management инструменти.

## 7. Short Retrieval Quiz

1. Какво е „data flow“ между модули?
2. Защо е важно да се намалява свързаността (coupling) между модулите?
3. Какво представлява dependency injection?
4. Как интерфейсите помагат при обмена на данни между модули?
5. Какви са рисковете при tight coupling?
6. Дайте пример за ситуация, в която dependency handling е критично важно.
7. Как бихте намалили зависимостите между два модула?

## 8. Quick Recap

- Data flow описва как данните се предават между модулите в една система.
- Управлението на зависимости (dependency handling) прави системите по-гъвкави и лесни за поддръжка.
- Loose coupling позволява модулите да се развиват независимо.
- Интерфейсите дефинират ясни правила за комуникация между модулите.
- Dependency injection намалява твърдата свързаност и улеснява тестването.
- Прекомерната зависимост между модулите води до трудности при промени и откриване на грешки.
- Добрата архитектура на data flow и dependencies е критична за успешни AI и софтуерни проекти.

## 9. Spaced Review Plan

| Време      | Преговори/Въпроси                                   |
|------------|-----------------------------------------------------|
| 1 ден      | Обяснете с примери какво е data flow и dependency.  |
| 3 дни      | Начертайте схема на data flow в позната ви система. |
| 1 седмица  | Опишете как бихте внедрили dependency injection.    |
| 1 месец    | Анализирайте реален проект за проблеми със зависимости и предложете подобрения. |