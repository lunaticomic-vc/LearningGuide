# 15 - Redundancy failover and disaster recovery planning

## 1. Activate Prior Knowledge

- Какво се случва, ако основният сървър на една AI система спре да работи поради хардуерен проблем? Какви последствия би имало това за потребителите?
- Можете ли да си спомните случай, когато дадена услуга е била недостъпна поради срив? Какви мерки биха могли да предотвратят или минимизират подобни прекъсвания?
- Как мислите, че големи компании като Google или Amazon осигуряват непрекъсната работа на своите услуги, дори при възникване на сериозни инциденти?

## 2. Overview

Redundancy, failover и disaster recovery са критични аспекти от проектирането на надеждни информационни системи, особено в контекста на AI и софтуерно инженерство. Тези подходи гарантират, че системите могат да продължат да функционират или бързо да се възстановят след неочаквани сривове, хардуерни повреди или природни бедствия.

Redundancy означава изграждане на резервни компоненти или системи, които могат да поемат работата при отказ на основните. Failover е процесът на автоматично превключване към резервен ресурс при повреда. Disaster recovery планирането включва стратегии и процедури за възстановяване на нормалната работа след мащабни инциденти.

Тези практики са особено важни за AI системи, които често работят с критични данни и изискват висока наличност. Без адекватно планиране, дори краткотрайни прекъсвания могат да доведат до загуба на данни, приходи и доверие от страна на клиентите.

## 3. Key Concepts

- **Redundancy** – Изграждане на резервни хардуерни или софтуерни компоненти, които могат да заместят основните при повреда. Мислете за това като за резервна гума в автомобила.
- **Failover** – Автоматичен процес на превключване към резервен компонент или система при отказ на основния. Като смяна на писта при затворен участък на магистрала.
- **Disaster Recovery (DR)** – Планове и процедури за възстановяване на системата след сериозни инциденти, като природни бедствия или масови сривове.
- **High Availability (HA)** – Дизайн на системи с цел минимизиране на времето на прекъсване и осигуряване на постоянна услуга.
- **Backup** – Създаване на копия на данни, които могат да бъдат възстановени при загуба или повреда.
- **Recovery Point Objective (RPO)** – Максималното количество данни, което може да бъде загубено при инцидент, измерено във времеви интервали.
- **Recovery Time Objective (RTO)** – Максималното време, необходимо за възстановяване на системата след срив.

## 4. Step-by-step Learning Path

1. **Разберете нуждата от надеждност**
   - Фокус: Анализирайте последствията от системен срив.
   - Задача: Опишете сценарий, при който AI услуга става недостъпна за 1 час.
   - Въпроси: Какви щети може да причини това? Кои потребители са най-засегнати?

2. **Изучете видовете redundancy**
   - Фокус: Разграничете хардуерна, софтуерна и мрежова излишност.
   - Задача: Нарисувайте схема на система с поне два слоя redundancy.
   - Въпроси: Къде redundancy е най-важна? Какво се случва при липса на резервни компоненти?

3. **Разберете failover механизмите**
   - Фокус: Как се осъществява автоматичното превключване.
   - Задача: Конфигурирайте прост load balancer с два backend сървъра (може и виртуално).
   - Въпроси: Как load balancer разбира, че даден сървър е недостъпен? Какво става с текущите заявки?

4. **Планирайте disaster recovery**
   - Фокус: Как се създава DR план и какви са ключовите му елементи.
   - Задача: Изгответе кратък DR план за малка уеб услуга.
   - Въпроси: Какви са основните стъпки при възстановяване? Как се определят RPO и RTO?

5. **Тествайте и валидирайте**
   - Фокус: Значението на регулярното тестване на DR и failover плановете.
   - Задача: Организирайте симулация на срив и опишете резултатите.
   - Въпроси: Какво научихте от теста? Какво бихте подобрили?

## 5. Examples

### Пример 1: Active-Passive Database Cluster

В PostgreSQL може да се настрои master-slave репликация. Ако master сървърът спре, системата автоматично превключва към slave.

```bash
# Примерна команда за промяна на ролята:
pg_ctl promote -D /var/lib/postgresql/data
```

### Пример 2: Load Balancer с автоматичен failover

Nginx може да се използва като load balancer с резервни upstream сървъри:

```nginx
upstream backend {
    server backend1.example.com;
    server backend2.example.com backup;
}
```

### Пример 3: Disaster Recovery план за AI услуга

- Ежедневно архивиране на моделите и данните в облака.
- Документирана процедура за възстановяване на инфраструктурата от бекъп.
- Тестове на DR плана всеки месец.

## 6. Common Pitfalls

- **Недостатъчно тестване на DR плановете** – Плановете често остават само на хартия; редовното тестване е задължително.
- **Пренебрегване на dependency-та** – Забравяне за външни услуги, които също трябва да имат redundancy.
- **Липса на актуални бекъпи** – Архивите трябва да са редовни и проверени за възстановимост.
- **Сложност без нужда** – Прекомерната излишност може да доведе до по-сложна поддръжка и повече точки на отказ.
- **Неясни роли и отговорности** – При инцидент е важно всеки да знае какво да прави.

## 7. Short Retrieval Quiz

1. Каква е разликата между redundancy и failover?
2. Какво означават RPO и RTO?
3. Защо е важно да се тестват disaster recovery плановете?
4. Дайте пример за хардуерна и за софтуерна излишност.
5. Как load balancer подпомага високата наличност?
6. Какво може да се случи, ако dependency услуга няма redundancy?
7. Какви са основните стъпки при възстановяване след срив?

## 8. Quick Recap

- Redundancy означава резервни компоненти за по-висока надеждност.
- Failover е автоматично превключване при отказ.
- Disaster recovery включва планове за възстановяване след мащабни инциденти.
- RPO и RTO определят границите на допустима загуба и време за възстановяване.
- Регулярното тестване на плановете е критично.
- Всяка система трябва да има ясно дефинирани процедури за DR.
- Прекомерната сложност може да навреди на надеждността.

## 9. Spaced Review Plan

| Време      | Преговори/Задачи                                      |
|------------|-------------------------------------------------------|
| 1 ден      | Прегледайте основните понятия и примери               |
| 3 дни      | Решете отново quiz въпросите и прегледайте DR план    |
| 1 седмица  | Създайте нов сценарий за failover и го анализирайте   |
| 1 месец    | Организирайте симулация на срив и оценете реакцията   |