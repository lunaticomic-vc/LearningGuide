# 09 - Entity relationship diagrams and key constraints

## 1. Activate Prior Knowledge

- Как бихте моделирали структурата на база данни за система за препоръки в изкуствения интелект?
- Какви са основните разлики между релационни и нерелационни бази данни в контекста на моделиране на данни?
- Можете ли да си спомните пример, при който неправилно дефинирани ключове са довели до дублиране или загуба на данни?

## 2. Overview

Entity Relationship Diagrams (ERD) са визуални инструменти за моделиране на структурата на данните в информационни системи. Те показват основните обекти (entities), връзките между тях (relationships) и важните ограничения (constraints), които управляват начина, по който данните се съхраняват и свързват. ERD са фундаментални при проектирането на релационни бази данни, тъй като позволяват ясно дефиниране на бизнес логиката и предотвратяват бъдещи грешки при имплементацията.

В контекста на софтуерното инженерство и системите с изкуствен интелект, ERD подпомагат изграждането на надеждни, мащабируеми и ефективни бази данни, които могат да обслужват сложни заявки и анализи. Ключовите ограничения (key constraints), като първични и външни ключове, гарантират целостта на данните и уникалността на записите.

Правилното използване на ERD и ключови ограничения улеснява комуникацията между екипи, намалява риска от дублиране на информация и осигурява солидна основа за бъдещо разширяване на системата.

## 3. Key Concepts

- Entity (Същност) – Обект или концепция от реалния свят, която се моделира в базата данни (например: Потребител, Продукт). Мислете за entity като "съществително" в изречение.
- Attribute (Атрибут) – Характеристика или свойство на дадена същност (например: име, дата на раждане). Атрибутите са като "прилагателни", описващи същността.
- Relationship (Връзка) – Ассоциация между две или повече същности (например: Потребител прави Поръчка).
- Primary Key (Първичен ключ) – Уникален идентификатор за всеки запис в таблица. Представете си го като ЕГН за всеки човек.
- Foreign Key (Външен ключ) – Атрибут, който сочи към първичен ключ в друга таблица, за да създаде връзка между таблиците.
- Cardinality (Кардиналност) – Определя броя на участващите записи във връзката (например: един към много, много към много).
- Key Constraint (Ключово ограничение) – Правило, което гарантира уникалност или валидност на данните чрез ключове.

## 4. Step-by-step Learning Path

1. **Запознайте се с основните елементи на ERD**
   - Фокус: Разпознайте същности, атрибути и връзки.
   - Задача: Начертайте ERD за малка библиотека (Книга, Автор, Читател).
   - Въпроси: Какви са същностите? Какви атрибути имат те?

2. **Разберете ключовите ограничения**
   - Фокус: Различавайте първични и външни ключове.
   - Задача: Определете първичните и външните ключове във вашата ERD.
   - Въпроси: Кой атрибут е уникален идентификатор? Как се осъществява връзката между таблиците?

3. **Моделирайте кардиналност и зависимости**
   - Фокус: Определете типа на връзките (1:1, 1:N, N:M).
   - Задача: Добавете кардиналност към вашата диаграма.
   - Въпроси: Колко книги може да има един автор? Един читател може ли да заеме повече от една книга?

4. **Проверете целостта на данните**
   - Фокус: Анализирайте как ключовите ограничения защитават данните.
   - Задача: Опитайте да въведете дублиращи се записи и наблюдавайте какви грешки възникват.
   - Въпроси: Какво се случва при опит за въвеждане на два записа с един и същ първичен ключ?

5. **Приложете ERD към реален проект**
   - Фокус: Свържете ERD с конкретен проект (например AI система за препоръки).
   - Задача: Създайте ERD за система, която препоръчва продукти на потребители.
   - Въпроси: Какви са основните същности и връзки? Какви ключови ограничения са нужни?

## 5. Examples

### Пример 1: ERD за система за онлайн магазини

```
[Customer]---(places)---[Order]---(contains)---[Product]
```

- Customer (customer_id, name, email)
- Order (order_id, order_date, customer_id)
- Product (product_id, name, price)

**Primary Key:** customer_id, order_id, product_id  
**Foreign Key:** customer_id в Order сочи към Customer; product_id в OrderProduct сочи към Product

### Пример 2: Кратък SQL код за ключови ограничения

```sql
CREATE TABLE Customer (
    customer_id INT PRIMARY KEY,
    name VARCHAR(100),
    email VARCHAR(100)
);

CREATE TABLE Order (
    order_id INT PRIMARY KEY,
    order_date DATE,
    customer_id INT,
    FOREIGN KEY (customer_id) REFERENCES Customer(customer_id)
);
```

### Пример 3: Кардиналност

- Един клиент може да направи много поръчки (1:N).
- Един продукт може да участва в много поръчки, а една поръчка може да съдържа много продукти (N:M).

## 6. Common Pitfalls

- **Пропускане на първичен ключ:** Води до невъзможност за уникално идентифициране на записи.
- **Неправилно дефинирани външни ключове:** Може да доведе до нарушаване на целостта на данните.
- **Игнориране на кардиналност:** Може да създаде неочаквани ограничения или дублиране на информация.
- **Смесване на същности и атрибути:** Води до объркване в структурата на базата данни.
- **Липса на документация:** Затруднява бъдещата поддръжка и разширение на системата.

## 7. Short Retrieval Quiz

1. Каква е ролята на първичния ключ в една таблица?
2. Какво представлява външният ключ и за какво служи?
3. Каква е разликата между 1:1, 1:N и N:M връзки?
4. Какво е същност в контекста на ERD?
5. Какво се случва, ако се опитате да въведете два записа с един и същ първичен ключ?
6. Защо кардиналността е важна при моделиране на бази данни?
7. Какви са последиците от липсата на ключови ограничения?

## 8. Quick Recap

- ERD визуализират структурата и връзките в базата данни.
- Същностите, атрибутите и връзките са основните градивни елементи.
- Първичните и външните ключове гарантират уникалност и целостта на данните.
- Кардиналността определя броя на участващите записи във връзките.
- Ключовите ограничения предотвратяват дублиране и загуба на информация.
- ERD улесняват комуникацията между екипи и подобряват дизайна на системата.
- Правилното моделиране с ERD е критично за успешни AI и софтуерни проекти.

## 9. Spaced Review Plan

| Време      | Преговори/Подсказки                                      |
|------------|---------------------------------------------------------|
| 1 ден      | Прегледайте основните елементи на ERD и ключовите типове |
| 3 дни      | Приложете ERD към нов пример и идентифицирайте ключове   |
| 1 седмица  | Решете кратък казус с грешно дефинирани ключове          |
| 1 месец    | Създайте ERD за реален проект и анализирайте ограничения |