# External_API_and_database_interaction

## 1. Activate Prior Knowledge
- Какво представлява API и какви типове API съществуват?
- Какво е ролята на базите данни в съвременните софтуерни системи?
- Как бихте свързали външен API с база данни в контекста на AI приложение?

## 2. Overview
Външните API-та (Application Programming Interfaces) са интерфейси, които позволяват на различни софтуерни системи да комуникират помежду си. Те предоставят стандартизиран начин за извличане, изпращане и обработка на данни от външни източници, което е особено важно при интеграция на външни услуги или при използване на данни от трети страни.

Базите данни са сърцето на съхранението на структурирана информация в софтуерните системи. Те позволяват ефективно съхранение, търсене и управление на големи обеми данни. В контекста на взаимодействието с външни API-та, базите данни често служат като междинен слой за кеширане, трансформация и съхранение на данните, получени от API.

В по-широката архитектура на софтуерна система, взаимодействието между външни API-та и бази данни е ключово за осигуряване на надеждност, мащабируемост и ефективност. Това взаимодействие е особено важно в AI системи, където данните от външни източници могат да бъдат използвани за обучение, валидиране или подобряване на модели.

## 3. Key Concepts
- **API (Application Programming Interface)** – интерфейс, който позволява на различни софтуерни компоненти да комуникират чрез дефинирани методи и формати. Мислете за API като за меню в ресторант: то описва какво може да поръчате и как ще получите поръчката.
- **REST API** – популярен тип API, който използва HTTP методи (GET, POST, PUT, DELETE) за взаимодействие с ресурси. Аналогия: REST API е като библиотека, където всяка книга (ресурс) има уникален адрес.
- **JSON (JavaScript Object Notation)** – лек формат за обмен на данни, който е лесен за четене и писане от хора и машини. Представете си го като структурирана таблица с данни, но в текстов вид.
- **Database (База данни)** – организирана колекция от данни, която може да се управлява и достъпва ефективно. Аналогия: база данни е като добре подредена библиотека с книги.
- **SQL (Structured Query Language)** – език за заявяване и манипулиране на релационни бази данни. Мислете за SQL като за език, с който "говорите" на базата данни.
- **ORM (Object-Relational Mapping)** – техника, която свързва обектно-ориентиран код с релационна база данни, улеснявайки работата с данни чрез обекти вместо директни SQL заявки.
- **Rate Limiting** – ограничение на броя заявки към API за определен период, за да се предотврати претоварване. Представете си го като ограничение на броя на клиентите, които могат да влязат в магазин за един час.

## 4. Step-by-step Learning Path
1. **Запознаване с основите на API и HTTP протокола**  
   - Фокус: Разберете как работи HTTP и как се използват методите GET, POST, PUT, DELETE.  
   - Задача: Използвайте `curl` или Postman, за да направите базови заявки към публичен REST API (например JSONPlaceholder).  
   - Въпроси: Какво е разликата между GET и POST? Какво означава статус код 200?

2. **Работа с JSON данни**  
   - Фокус: Научете как да парсвате и създавате JSON обекти.  
   - Задача: Напишете малка програма, която извлича JSON от API и го преобразува в обекти във вашия език за програмиране.  
   - Въпроси: Как се представят масиви и обекти в JSON? Какво е null в JSON?

3. **Интеграция с база данни**  
   - Фокус: Научете основите на SQL и как да съхранявате данни от API в база данни.  
   - Задача: Създайте таблица и запишете данни, извлечени от API, в нея.  
   - Въпроси: Как се прави INSERT заявка? Какво е primary key?

4. **Използване на ORM**  
   - Фокус: Запознайте се с ORM библиотека за избрания език (например SQLAlchemy за Python).  
   - Задача: Модифицирайте предишния проект да използва ORM вместо директни SQL заявки.  
   - Въпроси: Какво е предимството на ORM? Как се дефинира модел?

5. **Обработка на грешки и rate limiting**  
   - Фокус: Научете как да обработвате грешки при извикване на API и как да се справяте с ограничения на заявки.  
   - Задача: Имплементирайте retry механизъм с изчакване при грешка 429 (Too Many Requests).  
   - Въпроси: Какво е HTTP статус код 429? Какво е exponential backoff?

## 5. Examples

### Пример 1: Извличане на данни от REST API и запис в база данни (Python + SQLite)
```python
import requests
import sqlite3

# Извличане на данни от API
response = requests.get('https://jsonplaceholder.typicode.com/posts')
posts = response.json()

# Свързване с база данни
conn = sqlite3.connect('example.db')
cursor = conn.cursor()

# Създаване на таблица
cursor.execute('''
CREATE TABLE IF NOT EXISTS posts (
    id INTEGER PRIMARY KEY,
    title TEXT,
    body TEXT
)
''')

# Вмъкване на данни
for post in posts:
    cursor.execute('INSERT OR IGNORE INTO posts (id, title, body) VALUES (?, ?, ?)',
                   (post['id'], post['title'], post['body']))

conn.commit()
conn.close()
```

### Пример 2: Обработка на rate limiting с retry (Python)
```python
import time
import requests

def fetch_with_retry(url, retries=3):
    for i in range(retries):
        response = requests.get(url)
        if response.status_code == 429:
            wait_time = 2 ** i
            print(f"Rate limited. Waiting for {wait_time} seconds...")
            time.sleep(wait_time)
        else:
            return response.json()
    raise Exception("Max retries exceeded")

data = fetch_with_retry('https://api.example.com/data')
```

## 6. Common Pitfalls
- **Игнориране на rate limiting** – води до блокиране на достъпа до API. Решение: винаги имплементирайте retry логика и спазвайте лимитите.
- **Неправилно парсване на JSON** – често се получават грешки при промяна на структурата на данните. Решение: валидирайте и обработвайте грешките при парсване.
- **Липса на транзакции при запис в база данни** – може да доведе до непълни или корумпирани данни. Решение: използвайте транзакции и rollback при грешки.
- **Твърде чест достъп до API без кеширане** – увеличава латентността и натоварването. Решение: кеширайте резултатите, когато е възможно.
- **Съхраняване на чувствителни данни без криптиране** – риск от изтичане на информация. Решение: използвайте криптиране и сигурни методи за съхранение.

## 7. Short Retrieval Quiz
1. Какво представлява REST API?  
2. Кой HTTP метод се използва за извличане на данни?  
3. Какво е JSON и защо е важен?  
4. Какво е основната функция на ORM?  
5. Какво означава HTTP статус код 429?  
6. Защо е важно да използваме транзакции при работа с бази данни?  
7. Какво представлява rate limiting и как се справяме с него?

## 8. Quick Recap
- Външните API-та позволяват комуникация между различни софтуерни системи чрез стандартизирани интерфейси.
- Базите данни съхраняват и управляват данни, които често идват от външни API-та.
- REST API и JSON са стандартни технологии за обмен на данни.
- ORM улеснява работата с бази данни чрез обектно-ориентиран подход.
- Важно е да се справяме с rate limiting и грешки при извикване на API.
- Транзакциите в базите данни гарантират целостта на данните.
- Кеширането и правилната обработка на данни подобряват производителността и надеждността.

## 9. Spaced Review Plan

| Време след учене | Промпт за преговор                                      |
|------------------|--------------------------------------------------------|
| 1 ден            | Обяснете какво е REST API и как се използва с база данни. |
| 3 дни            | Опишете процеса на обработка на JSON данни от API и запис в база данни. |
| 1 седмица        | Какво е rate limiting и как бихте го имплементирали?   |
| 1 месец          | Прегледайте пример за интеграция на външен API с база данни и обсъдете потенциални проблеми. |