# 23 - Code modularity packaging and layering

## 1. Activate Prior Knowledge

- Как бихте разделили голям проект на по-малки, управляеми части? Можете ли да дадете пример от предишен проект?
- Какви са предимствата на това да използваме пакети (packages) и слоеве (layers) в една софтуерна система, особено при разработка на AI системи?
- Кога последно сте се сблъсквали с проблеми, породени от лоша организация на кода? Как бихте ги избегнали?

---

## 2. Overview

Модулността, пакетирането и слоевете са фундаментални принципи за изграждане на мащабируеми, поддържани и лесни за тестване софтуерни системи. Те позволяват разделяне на сложни системи на по-малки, независими части, които могат да се разработват, тестват и преизползват самостоятелно.

В контекста на AI системите и съвременния софтуерен инженеринг, модулността улеснява интеграцията на различни компоненти – например, модели за машинно обучение, обработка на данни и визуализация. Пакетирането структурира кода така, че да може лесно да се споделя и преизползва, докато слоевете въвеждат яснота в зависимостите и взаимодействията между различните части на системата.

Този подход не само подобрява качеството на кода, но и ускорява разработката, намалява риска от грешки и улеснява работата в екип. Добре организираната система е по-лесна за разширяване и поддръжка – ключово изискване при бързо развиващи се AI проекти.

---

## 3. Key Concepts

- **Module (Модул)** – Самостоятелна част от кода с ясно дефинирана функционалност. Може да се сравни с отделна стая в една сграда.
- **Package (Пакет)** – Събирателна структура, която групира свързани модули. Аналогично на етаж в сграда, където всяка стая (модул) има своя роля, но всички заедно изпълняват обща функция.
- **Layer (Слой)** – Йерархично разделение на системата, където всеки слой има специфична отговорност и комуникира само със съседните си слоеве. Може да се мисли като различни нива на организация – например, вход, обработка, изход.
- **Encapsulation (Капсулация)** – Скриване на вътрешната реализация на модул или пакет, така че външните компоненти да използват само публичния интерфейс.
- **Dependency (Зависимост)** – Връзка между модули, пакети или слоеве, при която един компонент използва функционалността на друг.
- **Cohesion (Свързаност)** – Степента, до която елементите в един модул или пакет работят заедно за постигане на една цел.
- **Coupling (Свързаност между модули)** – Колко силно са свързани различните модули или пакети; ниската свързаност е желателна.

---

## 4. Step-by-step Learning Path

1. **Разберете основите на модулността**
   - Фокус: Какво представлява модулът и защо е важен.
   - Задача: Разделете прост Python скрипт (например калкулатор) на отделни функции (модули).
   - Въпроси: Какви са предимствата на модулите? Какво се случва, ако всичко е в един файл?

2. **Изградете първи пакет**
   - Фокус: Организация на модули в пакет.
   - Задача: Създайте Python пакет с два модула (например: data_processing.py и model.py).
   - Въпроси: Каква е разликата между модул и пакет? Как се импортират модули от пакет?

3. **Въведете слоеве в архитектурата**
   - Фокус: Разделяне на логиката на слоеве (напр. data, logic, presentation).
   - Задача: Организирайте кода си така, че всеки слой да е в отделен пакет.
   - Въпроси: Какви са предимствата на слоевия подход? Как се ограничават зависимостите между слоевете?

4. **Използвайте капсулация и контрол на зависимостите**
   - Фокус: Скриване на вътрешната логика и минимизиране на зависимостите.
   - Задача: Дефинирайте публични и частни функции/класове във вашите модули.
   - Въпроси: Как капсулацията помага при поддръжка? Какво се случва при силна свързаност между модулите?

5. **Приложете на практика в малък проект**
   - Фокус: Интегриране на всички принципи в реален мини проект (например: AI pipeline).
   - Задача: Създайте проект с ясно разделени пакети и слоеве, използвайки модулност и капсулация.
   - Въпроси: Какво беше най-трудното при разделянето? Какво бихте подобрили?

---

## 5. Examples

### Пример 1: Python пакет за обработка на данни

```python
# data_processing/cleaning.py
def clean_data(df):
    # Премахване на липсващи стойности
    return df.dropna()

# data_processing/__init__.py
from .cleaning import clean_data
```

### Пример 2: Слоеста архитектура в AI проект

```
project/
│
├── data_layer/
│   └── loader.py
├── logic_layer/
│   └── trainer.py
└── presentation_layer/
    └── dashboard.py
```
- `data_layer` зарежда и обработва данни
- `logic_layer` обучава модел
- `presentation_layer` визуализира резултати

### Пример 3: Капсулация с публични и частни функции

```python
# model.py
def _preprocess(data):  # частна функция
    # вътрешна обработка
    pass

def train_model(data):  # публична функция
    processed = _preprocess(data)
    # обучение на модел
    pass
```

---

## 6. Common Pitfalls

- **Твърде големи модули (God objects)** – Създаване на модули с прекалено много отговорности. Използвайте принципа "един модул – една отговорност".
- **Неправилно структурирани пакети** – Смесване на несвързани модули в един пакет. Групирайте по функционалност.
- **Прекомерна свързаност между слоевете** – Позволяване на слоевете да прескачат йерархията. Винаги комуникирайте само със съседни слоеве.
- **Липса на капсулация** – Излагане на вътрешни детайли, което води до трудна поддръжка.
- **Кръгови зависимости** – Модули, които се реферират взаимно, създавайки затворен цикъл. Избягвайте чрез ясно дефинирани интерфейси и слоеве.

---

## 7. Short Retrieval Quiz

1. Каква е разликата между модул и пакет?
2. Какво представлява слоестата архитектура и защо е полезна?
3. Как капсулацията помага за поддръжката на кода?
4. Какви са рисковете при силна свързаност между модулите?
5. Как се избягват кръговите зависимости?
6. Дайте пример за разделяне на проект на слоеве.
7. Какво означава "един модул – една отговорност"?

---

## 8. Quick Recap

- Модулността разделя кода на малки, управляеми части.
- Пакетите групират свързани модули за по-добра организация и преизползваемост.
- Слоестата архитектура въвежда яснота и контрол върху зависимостите.
- Капсулацията скрива вътрешната логика и намалява риска от грешки.
- Ниската свързаност между модулите улеснява поддръжката и разширяемостта.
- Ясната структура ускорява разработката и подобрява работата в екип.
- Избягвайте големи модули, кръгови зависимости и смесване на отговорности.

---

## 9. Spaced Review Plan

| Кога         | Какво да прегледате                                        |
|--------------|------------------------------------------------------------|
| 1 ден        | Основни понятия и примери за модули, пакети и слоеве       |
| 3 дни        | Организация на проект и избягване на чести грешки          |
| 1 седмица    | Приложение в реален мини проект и капсулация               |
| 1 месец      | Преглед на архитектурни решения и оптимизация на структурата|