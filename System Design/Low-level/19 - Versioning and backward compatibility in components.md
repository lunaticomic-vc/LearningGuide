# 19 - Versioning and backward compatibility in components

## 1. Activate Prior Knowledge

- Какво се случва, когато една библиотека или компонент, от които зависи вашият проект, бъде обновен? Какви рискове крие това?
- Можете ли да си спомните случай, когато промяна в API е довела до счупване на съществуващ код?
- Как мислите, че големи системи като облачни услуги или AI платформи управляват различните версии на своите компоненти?

## 2. Overview

Versioning и backward compatibility са критични аспекти при разработката на софтуерни компоненти, особено в мащабни или дългосрочни проекти. Когато компонентите се развиват, те често се променят – добавят се нови функционалности, коригират се бъгове или се оптимизират процеси. Тези промени могат да повлияят на други части от системата, които зависят от тях.

Versioning (версиониране) позволява ясно проследяване на различните състояния на един компонент във времето. Това е особено важно при споделяне на компоненти между екипи или при публични библиотеки. Backward compatibility (обратна съвместимост) гарантира, че новите версии на компонентите не нарушават работата на съществуващите потребители.

В контекста на AI системи или сложни софтуерни архитектури, правилното управление на версиите и обратната съвместимост е от съществено значение за стабилността, сигурността и възможността за бързо развитие.

## 3. Key Concepts

- Versioning (Версиониране) – Система за обозначаване на различните състояния на един компонент чрез номера (напр. 1.0.0). Мислете за това като за етикети върху бутилки вино от различни реколти.
- Semantic Versioning (Семантично версиониране) – Стандартизиран начин за номериране на версии (MAJOR.MINOR.PATCH), който показва съвместимостта на промените.
- Backward Compatibility (Обратна съвместимост) – Способността на нова версия на компонент да работи с код, написан за по-стара версия.
- Breaking Change (Счупваща промяна) – Промяна, която нарушава съвместимостта и изисква адаптация на потребителския код.
- Deprecation (Остаряване) – Процес на обявяване на функционалност за неизползваема, но все още поддържана за известно време, за да се даде време на потребителите да мигрират.

## 4. Step-by-step Learning Path

1. **Разберете нуждата от versioning**
   - Фокус: Защо е важно да се управляват версиите на компонентите.
   - Задача: Намерете пример за проект с множество версии на една библиотека.
   - Въпроси: Какво би се случило без versioning? Как се проследяват промените?

2. **Научете семантичното версиониране**
   - Фокус: Как работи MAJOR.MINOR.PATCH и кога се увеличава всяко число.
   - Задача: Анализирайте changelog на популярен проект (например TensorFlow) и определете какви промени са довели до нова major, minor или patch версия.
   - Въпроси: Какво означава промяна на major версия? Как се комуникират breaking changes?

3. **Изследвайте обратната съвместимост**
   - Фокус: Как се гарантира, че новите версии не чупят старите клиенти.
   - Задача: Напишете функция, която добавя нов параметър с default стойност, без да нарушава съществуващия код.
   - Въпроси: Какви са начините за запазване на backward compatibility? Кога е допустимо да се наруши?

4. **Работа с deprecation**
   - Фокус: Как се обявяват и управляват остарели функционалности.
   - Задача: Добавете warning за deprecated функция във ваш код.
   - Въпроси: Защо е важно да се обявява deprecation? Какво се случва, ако не се комуникира ясно?

5. **Планиране на breaking changes**
   - Фокус: Кога и как да се въвеждат счупващи промени.
   - Задача: Опишете стратегия за миграция при breaking change във ваш проект.
   - Въпроси: Как да минимизирате риска за потребителите? Как да документирате breaking changes?

## 5. Examples

### Пример 1: Семантично версиониране в Python пакет

```python
# Версия 1.0.0
def add(a, b):
    return a + b

# Версия 1.1.0 (добавен нов параметър с default стойност)
def add(a, b, verbose=False):
    if verbose:
        print(f"Adding {a} and {b}")
    return a + b
```
Тук новият параметър не нарушава съвместимостта.

### Пример 2: Breaking change

```python
# Версия 2.0.0 (променен ред на параметрите)
def add(b, a):
    return a + b
```
Тази промяна ще счупи съществуващия код, който използва старата версия.

### Пример 3: Deprecation warning

```python
import warnings

def old_function():
    warnings.warn("old_function is deprecated, use new_function instead", DeprecationWarning)
    # ... стара логика ...
```

## 6. Common Pitfalls

- Пропускане на ясно versioning – води до объркване и трудно откриване на проблеми.
- Въвеждане на breaking changes без предупреждение – може да счупи продукционни системи.
- Липса на документация за промените – потребителите не знаят какво се е променило и как да мигрират.
- Прекалено дълго задържане на остарели (deprecated) функции – затруднява поддръжката и увеличава техническия дълг.

## 7. Short Retrieval Quiz

1. Какво означава MAJOR.MINOR.PATCH в семантичното версиониране?
2. Как се дефинира "backward compatibility"?
3. Какво е "breaking change" и кога е допустимо?
4. Какво е deprecation и защо се използва?
5. Дайте пример за промяна, която не нарушава обратната съвместимост.
6. Какви са рисковете при липса на versioning?
7. Как да комуникирате breaking changes към потребителите?

## 8. Quick Recap

- Versioning позволява проследяване и управление на промените в компонентите.
- Semantic versioning стандартизира комуникацията за съвместимостта на промените.
- Backward compatibility е ключова за стабилността на системите.
- Breaking changes трябва да се въвеждат внимателно и с ясна комуникация.
- Deprecation дава време на потребителите да мигрират към нови решения.
- Липсата на добра стратегия за versioning и съвместимост води до рискове за цялата система.
- Документацията и комуникацията са съществена част от процеса.

## 9. Spaced Review Plan

| Review Time | Prompt                                                                 |
|-------------|-----------------------------------------------------------------------|
| 1 day       | Обяснете разликата между breaking change и backward compatible change.|
| 3 days      | Дайте пример за deprecation и как бихте го комуникирали.              |
| 1 week      | Опишете процеса на семантично версиониране и кога се сменя major версия.|
| 1 month     | Как бихте планирали и документирали breaking change в реален проект?  |