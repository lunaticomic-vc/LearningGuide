# 20 - Time-series and graph databases

## 1. Activate Prior Knowledge

- Какви типове бази данни познавате и какви са техните основни предимства и недостатъци?
- Можете ли да дадете пример за проблем, при който е важно да се проследява как се променят данните във времето?
- Кога бихте използвали графова структура за представяне на данни в софтуерна система или AI приложение?

## 2. Overview

Time-series и графовите бази данни са специализирани решения за съхранение и обработка на специфични типове данни, които класическите релационни бази данни не обслужват ефективно. Time-series базите са оптимизирани за данни, които се записват и анализират във времеви ред, като например температурни сензори, финансови котировки или логове от IoT устройства. Те позволяват бързо записване, агрегиране и извличане на данни по време.

Графовите бази данни са създадени за работа с данни, които са силно свързани – например социални мрежи, препоръчителни системи или анализ на пътища в транспортни мрежи. Те представят информацията като възли (nodes) и връзки (edges), което позволява ефективно търсене на връзки, пътища и модели в сложни мрежи.

В контекста на AI и софтуерното инженерство, тези бази данни позволяват по-естествено моделиране на реални процеси и по-ефективна обработка на големи обеми от специализирани данни. Изборът на подходящ тип база данни може значително да ускори разработката и анализа на сложни системи.

## 3. Key Concepts

- Time-series database – База данни, оптимизирана за съхранение и анализ на последователности от данни, подредени по време. Мислете за нея като за дневник, в който всяко събитие има точно време.
- Timestamp – Маркер за време, който определя кога е записано дадено наблюдение или събитие.
- Aggregation – Процес на обобщаване на данни (напр. средна стойност, максимум) за определен времеви интервал.
- Graph database – База данни, която представя информацията като възли (nodes) и връзки (edges) между тях. Подобно на карта на град с улици и кръстовища.
- Node – Елемент (обект) в графовата база, например човек в социална мрежа.
- Edge – Връзка между два възела, например приятелство между двама души.
- Traversal – Процес на преминаване през възли и връзки в графа с цел намиране на пътища или модели.

## 4. Step-by-step Learning Path

1. **Разберете времевите редове**
   - Фокус: Какво представляват time-series данните и кога се използват.
   - Задача: Намерете публичен time-series dataset (напр. температури по дни) и визуализирайте го с графика.
   - Въпроси: Как се различават time-series данните от табличните? Защо е важно да имаме timestamp?

2. **Работа с time-series база данни**
   - Фокус: Основни операции – запис, извличане, агрегация.
   - Задача: Инсталирайте InfluxDB или TimescaleDB, създайте база и запишете 10 измервания с различни timestamps.
   - Въпроси: Какви заявки са типични за time-series база? Как се прави агрегация по време?

3. **Въведение в графовите бази данни**
   - Фокус: Как се моделират данни като граф.
   - Задача: Нарисувайте малка социална мрежа като граф (5 човека, 7 връзки).
   - Въпроси: Какво е възел? Какво е връзка? Какви типове връзки може да има?

4. **Работа с графова база данни**
   - Фокус: Основни операции – създаване на възли и връзки, търсене на пътища.
   - Задача: Инсталирайте Neo4j, създайте граф с 5 възела и 7 връзки, направете заявка за намиране на всички приятели на даден човек.
   - Въпроси: Как се създава връзка? Как се търси път между два възела?

5. **Сравнение и избор на база данни**
   - Фокус: Кога да използваме time-series, кога графова, кога релационна база.
   - Задача: Даден е проблем (напр. IoT мониторинг или препоръчителна система) – изберете подходяща база и обосновете избора си.
   - Въпроси: Какви са предимствата на time-series спрямо релационните бази? Кога графовата база е по-добра?

## 5. Examples

### Пример 1: Time-series база за IoT сензори

```sql
-- В TimescaleDB
CREATE TABLE sensor_data (
    time        TIMESTAMPTZ NOT NULL,
    sensor_id   INT NOT NULL,
    temperature DOUBLE PRECISION,
    humidity    DOUBLE PRECISION
);

SELECT time, AVG(temperature)
FROM sensor_data
WHERE sensor_id = 1
  AND time > NOW() - INTERVAL '7 days'
GROUP BY time::date;
```

### Пример 2: Графова база за социална мрежа

```cypher
// В Neo4j
CREATE (Alice:Person {name: 'Alice'})
CREATE (Bob:Person {name: 'Bob'})
CREATE (Carol:Person {name: 'Carol'})
CREATE (Alice)-[:FRIEND]->(Bob)
CREATE (Bob)-[:FRIEND]->(Carol)
CREATE (Alice)-[:FRIEND]->(Carol);

// Намери всички приятели на Alice
MATCH (a:Person {name: 'Alice'})-[:FRIEND]->(friends)
RETURN friends.name;
```

### Пример 3: Анализ на пътища в транспортна мрежа

```cypher
// Най-кратък път между две спирки
MATCH p = shortestPath((a:Station {name: 'A'})-[:CONNECTS_TO*]-(b:Station {name: 'D'}))
RETURN p;
```

## 6. Common Pitfalls

- **Използване на релационна база за time-series или графови данни** – Води до лоша производителност и сложни заявки. Използвайте специализиран тип база.
- **Липса на индекси по време или връзки** – Забавя заявките. Винаги индексирайте по timestamp (time-series) или по връзки (graph).
- **Неправилно моделиране на връзки** – В графовите бази е важно да дефинирате ясно типа и посоката на връзките.
- **Прекомерна агрегация в реално време** – Може да натовари time-series базата. Използвайте предварителна агрегация, когато е възможно.
- **Пренебрегване на ограниченията на ACID** – Някои time-series и graph бази не поддържат пълна ACID съвместимост. Внимавайте при критични транзакции.

## 7. Short Retrieval Quiz

1. Какво е time-series база данни и за какви данни е подходяща?
2. Какво е възел и какво е връзка в графова база данни?
3. Каква е основната разлика между time-series и релационна база данни?
4. Какви типове заявки са характерни за графовите бази?
5. Защо е важно да се индексира по време в time-series база?
6. Дайте пример за приложение, което изисква графова база данни.
7. Как се прави агрегация на данни по време?

## 8. Quick Recap

- Time-series базите са оптимизирани за данни, които се записват и анализират по време.
- Графовите бази представят информацията като възли и връзки, подходящи за силно свързани данни.
- Изборът на база зависи от структурата и нуждите на данните.
- Индексирането по време или връзки е критично за производителността.
- Time-series базите често се използват за IoT, мониторинг и финансови данни.
- Графовите бази са незаменими при анализ на социални мрежи, препоръчителни системи и маршрути.
- Правилното моделиране и избор на база улеснява анализа и развитието на системата.

## 9. Spaced Review Plan

| Review Time | Prompt                                                                 |
|-------------|------------------------------------------------------------------------|
| 1 day       | Опишете разликите между time-series и графова база данни.              |
| 3 days      | Дайте пример за реален проблем, решим с time-series база.              |
| 1 week      | Обяснете как се моделира социална мрежа в графова база.                |
| 1 month     | Избройте типични грешки при използване на time-series и graph бази.     |