# 08 - Data modeling principles and schema design

## 1. Activate Prior Knowledge

- Какви са основните разлики между релационни и нерелационни бази данни, които сте срещали досега?
- Можете ли да си спомните случай, когато лошо проектирана схема е довела до проблеми с производителността или сложността на дадена система?
- Как според вас доброто моделиране на данни влияе върху развитието и поддръжката на AI системи или мащабируеми софтуерни приложения?

---

## 2. Overview

Data modeling and schema design са фундаментални етапи при изграждането на всяка информационна система. Те определят как ще се структурират, съхраняват и достъпват данните, което директно влияе върху ефективността, мащабируемостта и надеждността на системата. В контекста на AI системи, добре проектираният модел на данни улеснява обработката, анализа и интеграцията на големи обеми от разнообразни данни.

Data modeling включва създаването на абстракции, които описват реалния свят чрез обекти, връзки и ограничения. Schema design е конкретната реализация на тези модели в дадена база данни – определя таблиците, полетата, типовете данни и връзките между тях.

В съвременния софтуерен инженеринг, правилното моделиране на данни е критично за избягване на дублиране, осигуряване на консистентност и оптимизиране на заявки. Това е особено важно при системи, които трябва да се мащабират или да се адаптират към нови изисквания.

---

## 3. Key Concepts

- Entity – Представлява обект или концепция от реалния свят, напр. „Потребител“ или „Поръчка“. Може да се мисли като съществително в изречение.
- Attribute – Характеристика или свойство на дадена entity, напр. „име“, „дата на раждане“. Аналогия: колоните в таблица.
- Relationship – Връзка между две или повече entities, напр. „Потребител прави Поръчка“. Може да се сравни с глагол в изречение.
- Primary Key – Уникален идентификатор за всеки запис в таблица. Мислете за него като за ЕГН на човек.
- Foreign Key – Поле, което сочи към primary key в друга таблица, реализирайки връзки между таблици.
- Normalization – Процес на организиране на данни за минимизиране на дублирането и осигуряване на целостта им.
- Denormalization – Умишлено въвеждане на дублиране за оптимизация на производителността при четене.
- Schema – Формалното описание на структурата на данните в база данни.
- ER Diagram (Entity-Relationship Diagram) – Графично представяне на entities, attributes и relationships.

---

## 4. Step-by-step Learning Path

1. **Разберете бизнес изискванията**
   - Фокус: Изяснете какви данни ще се съхраняват и какви операции ще се извършват.
   - Задача: Опишете с думи основните обекти и връзки в примерна система (напр. онлайн магазин).
   - Retrieval: Какви са основните entities в системата? Какви действия ще се извършват с тях?

2. **Създайте ER диаграма**
   - Фокус: Идентифицирайте entities, attributes и relationships.
   - Задача: Начертайте ER диаграма за избраната система.
   - Retrieval: Как се различават entities от attributes? Как се обозначават връзките?

3. **Определете ключовете и ограниченията**
   - Фокус: Изберете primary и foreign keys, дефинирайте уникалност и задължителност.
   - Задача: Определете primary key за всяка entity и връзките между тях.
   - Retrieval: Как се избира подходящ primary key? Какво е foreign key?

4. **Нормализирайте схемата**
   - Фокус: Приложете нормализационни форми (1NF, 2NF, 3NF).
   - Задача: Анализирайте схемата за дублиране и аномалии, коригирайте при нужда.
   - Retrieval: Какво е нормализация? Какви са ползите и недостатъците ѝ?

5. **Имплементирайте схемата в СУБД**
   - Фокус: Преведете ER диаграмата в SQL или друг език за дефиниция на данни.
   - Задача: Създайте таблици и връзки в избрана база данни.
   - Retrieval: Как се дефинира foreign key constraint в SQL? Как се създава таблица?

6. **Тествайте и оптимизирайте**
   - Фокус: Изпълнете примерни заявки, анализирайте производителността.
   - Задача: Вмъкнете тестови данни, изпълнете JOIN заявки, измерете време за изпълнение.
   - Retrieval: Какви са признаците за нужда от денормализация? Как се откриват „тесни места“?

---

## 5. Examples

### Пример 1: ER диаграма за онлайн магазин

- Entities: User, Product, Order
- Relationships: User places Order, Order contains Product

```
User (user_id, name, email)
Product (product_id, name, price)
Order (order_id, user_id, order_date)
OrderProduct (order_id, product_id, quantity)
```

### Пример 2: SQL схема

```sql
CREATE TABLE User (
    user_id INT PRIMARY KEY,
    name VARCHAR(100),
    email VARCHAR(100) UNIQUE
);

CREATE TABLE Product (
    product_id INT PRIMARY KEY,
    name VARCHAR(100),
    price DECIMAL(10,2)
);

CREATE TABLE Order (
    order_id INT PRIMARY KEY,
    user_id INT,
    order_date DATE,
    FOREIGN KEY (user_id) REFERENCES User(user_id)
);

CREATE TABLE OrderProduct (
    order_id INT,
    product_id INT,
    quantity INT,
    PRIMARY KEY (order_id, product_id),
    FOREIGN KEY (order_id) REFERENCES Order(order_id),
    FOREIGN KEY (product_id) REFERENCES Product(product_id)
);
```

### Пример 3: Нормализация

- Ако в таблица Order има поле „user_email“, това води до дублиране. Вместо това, използвайте foreign key към User.

---

## 6. Common Pitfalls

- **Дублиране на данни** – Води до несъответствия и затруднява поддръжката. Използвайте нормализация.
- **Липса на ключове или неправилно избрани ключове** – Може да доведе до невъзможност за уникална идентификация на записи.
- **Прекалена нормализация** – Може да забави заявки при големи обеми данни. Балансирайте между нормализация и производителност.
- **Неясни или липсващи връзки** – Пропускането на foreign keys затруднява осигуряването на целостта на данните.
- **Твърде сложни схеми** – Прекалено много таблици и връзки могат да направят системата трудна за разбиране и поддръжка.

---

## 7. Short Retrieval Quiz

1. Каква е разликата между entity и attribute?
2. Какво е primary key и защо е важен?
3. Какво представлява foreign key?
4. Какво цели нормализацията на данни?
5. Кога може да се наложи денормализация?
6. Какво е ER диаграма и за какво се използва?
7. Какви са основните предимства на доброто моделиране на данни?

---

## 8. Quick Recap

- Data modeling описва логическата структура на данните в системата.
- Schema design е конкретната реализация на този модел в база данни.
- Основни елементи са entities, attributes, relationships, primary и foreign keys.
- Нормализацията намалява дублирането и осигурява целостта на данните.
- Балансът между нормализация и производителност е ключов.
- ER диаграмите помагат за визуализация и планиране на схемата.
- Добре проектираната схема улеснява развитието, поддръжката и мащабирането на системата.

---

## 9. Spaced Review Plan

| Review Time | Review Prompt                                      |
|-------------|----------------------------------------------------|
| 1 day       | Опишете с примери разликата между entity и attribute. |
| 3 days      | Начертайте ER диаграма за нова система по избор.     |
| 1 week      | Обяснете кога и защо бихте използвали денормализация.|
| 1 month     | Преразгледайте стъпките за създаване на схема и идентифицирайте потенциални подобрения. |