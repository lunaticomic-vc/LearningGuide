# 23 - Observability practices and incident response workflows

## 1. Activate Prior Knowledge

- Какви инструменти или подходи сте използвали досега за мониторинг или диагностика на софтуерни системи?
- Можете ли да опишете ситуация, в която е възникнал инцидент в информационна система? Как беше открит и разрешен?
- Как мислите, че наблюдаемостта (observability) се различава от традиционния мониторинг, особено при сложни AI системи?

## 2. Overview

Observability практиките и инцидентните работни потоци са критични за поддържане на надеждността, сигурността и ефективността на съвременните софтуерни и AI системи. Observability позволява на инженерите да разберат вътрешното състояние на системата чрез външни сигнали като логове, метрики и трасиране. Това е особено важно при разпределени или сложни системи, където директното наблюдение е невъзможно.

Инцидентният отговор (incident response) е структуриран процес за откриване, анализ и разрешаване на проблеми, които нарушават нормалната работа на системата. Ефективните работни потоци за инциденти минимизират времето за възстановяване и ограничават въздействието върху потребителите и бизнеса.

В контекста на AI системи, observability и инцидентният отговор са още по-важни, тъй като поведението на моделите може да се променя динамично, а причините за проблеми често са неочевидни. Добре изградена наблюдаемост и ясни процеси за реакция позволяват бързо откриване и коригиране на аномалии, деградация на моделите или неочаквани резултати.

## 3. Key Concepts

- Observability – Способността да се разбере вътрешното състояние на система чрез анализ на външни сигнали. Мислете за това като за "рентген" на вашата инфраструктура.
- Monitoring – Процесът на събиране и анализ на предварително определени метрики или събития. Подобно на аларма, която се включва при определени условия.
- Logs – Текстови записи на събития, грешки или действия в системата. Представете си ги като дневник на случващото се.
- Metrics – Числови стойности, които се събират периодично (напр. CPU usage, latency). Аналогия: здравни показатели като пулс или температура.
- Traces – Данни за пътя на дадена заявка през различни компоненти на системата. Може да се сравни с GPS трак на пътуване.
- Incident – Неочаквано събитие, което нарушава нормалната работа на системата или услугата.
- Incident Response Workflow – Стъпки и роли за откриване, анализ, комуникация и разрешаване на инциденти.

## 4. Step-by-step Learning Path

1. **Разберете разликата между monitoring и observability**
   - Фокус: Прочетете документация за monitoring vs observability.
   - Практическа задача: Сравнете две популярни платформи (напр. Prometheus и Grafana) и идентифицирайте кои функции са за monitoring и кои за observability.
   - Въпроси: Какво е основното ограничение на monitoring? Кога observability е необходима?

2. **Настройте базова observability среда**
   - Фокус: Инсталирайте инструмент за логове, метрики и трасиране.
   - Практическа задача: Настройте прост Node.js или Python app с логиране и метрики (например с Prometheus и Grafana).
   - Въпроси: Какви данни събирате? Как бихте открили аномалия?

3. **Симулирайте инцидент и проследете реакцията**
   - Фокус: Разберете какво е инцидентен отговор и как се документира.
   - Практическа задача: Предизвикайте грешка в приложението и документирайте стъпките за откриване, анализ и разрешаване.
   - Въпроси: Какви роли са включени? Каква информация е критична по време на инцидент?

4. **Анализирайте реален инцидентен доклад**
   - Фокус: Прочетете публичен post-mortem (напр. от GitHub или Google).
   - Практическа задача: Идентифицирайте как observability е помогнала за разрешаване на инцидента.
   - Въпроси: Какви подобрения са предложени? Какво бихте направили различно?

5. **Интегрирайте observability в AI система**
   - Фокус: Обърнете внимание на специфичните предизвикателства при AI/ML модели.
   - Практическа задача: Добавете логове и метрики за мониторинг на inference latency и model drift.
   - Въпроси: Как observability помага при деградация на модела? Какви сигнали са най-важни?

## 5. Examples

### Пример 1: Мониторинг на latency в уеб услуга

```python
from prometheus_client import start_http_server, Summary

REQUEST_TIME = Summary('request_processing_seconds', 'Time spent processing request')

@REQUEST_TIME.time()
def process_request():
    # обработка на заявка
    pass
```
Този код добавя метрика за време на обработка, която може да се наблюдава в Grafana.

### Пример 2: Инцидентен workflow при паднал AI inference service

1. Аларма от monitoring система сигнализира за повишен error rate.
2. On-call инженер проверява логовете и вижда out-of-memory грешки.
3. Екипът скалира ресурсите и рестартира услугата.
4. След инцидента се провежда post-mortem анализ и се добавя автоматично скалиране.

### Пример 3: Trace на заявка през микросървисна архитектура

```yaml
trace:
  - service: frontend
    duration_ms: 10
  - service: api-gateway
    duration_ms: 15
  - service: recommendation-engine
    duration_ms: 120
```
Този trace показва къде се забавя обработката на заявката.

## 6. Common Pitfalls

- **Фокус само върху метрики, без логове или трасиране** – Това ограничава възможността за диагностика. Използвайте всички три сигнала.
- **Липса на автоматизация при инцидентен отговор** – Ръчните процеси забавят реакцията. Използвайте runbooks и автоматизирани аларми.
- **Недостатъчно обучение на екипа** – Ако хората не знаят как да използват observability инструментите, те са безполезни. Провеждайте редовни тренировки.
- **Прекалено много аларми (alert fatigue)** – Настройте алармите така, че да са смислени и да не се игнорират.
- **Пренебрегване на специфичните нужди на AI системите** – Например, липса на мониторинг за model drift или data skew.

## 7. Short Retrieval Quiz

1. Каква е разликата между monitoring и observability?
2. Кои са трите основни типа сигнали за наблюдаемост?
3. Какво е trace и защо е полезно?
4. Какви са основните стъпки в incident response workflow?
5. Как observability подпомага реакцията при инциденти?
6. Какви са рисковете при прекалено много аларми?
7. Защо е важно да се наблюдава model drift при AI системи?

## 8. Quick Recap

- Observability позволява дълбоко разбиране на системата чрез логове, метрики и трасиране.
- Monitoring е частен случай на observability с фокус върху предварително дефинирани аларми.
- Инцидентният отговор изисква ясни процеси и роли за бърза реакция.
- Инструментите за observability са критични при сложни и AI-базирани системи.
- Добре настроените аларми и автоматизацията ускоряват разрешаването на инциденти.
- Анализът след инцидент (post-mortem) води до устойчиви подобрения.
- Обучението на екипа и редовните тренировки са ключови за успех.

## 9. Spaced Review Plan

| Време      | Преговори/Въпроси                                               |
|------------|-----------------------------------------------------------------|
| 1 ден      | Опишете разликата между observability и monitoring.              |
| 3 дни      | Избройте трите основни типа сигнали и дайте пример за всеки.     |
| 1 седмица  | Разкажете стъпките при инцидентен отговор и ролите в екипа.      |
| 1 месец    | Анализирайте реален инцидент и как observability помогна.        |