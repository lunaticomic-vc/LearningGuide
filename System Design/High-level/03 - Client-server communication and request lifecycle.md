# 03 - Client-server communication and request lifecycle

## 1. Activate Prior Knowledge

- Какво разбирате под "клиент" и "сървър" в контекста на софтуерните системи?
- Можете ли да опишете как един уеб браузър взаимодейства с уеб сайт?
- Какви стъпки според вас са необходими, за да може едно AI приложение да получи отговор от отдалечен сървър?

---

## 2. Overview

Комуникацията между клиент и сървър е фундаментален принцип в съвременните софтуерни системи, особено при изграждането на уеб приложения и AI услуги. Клиентът (например браузър, мобилно приложение или AI агент) изпраща заявки към сървър, който обработва тези заявки и връща отговори. Този модел позволява разделяне на отговорностите, мащабируемост и централизирано управление на данни и логика.

Жизненият цикъл на една заявка (request lifecycle) описва всички етапи, през които преминава дадена заявка – от инициирането ѝ от клиента, през обработката ѝ на сървъра, до връщането на отговор. Разбирането на този процес е ключово за диагностика на проблеми, оптимизация на производителността и сигурността на системите.

В контекста на AI системи, клиент-сървър комуникацията често се използва за изпращане на данни към модели за обработка или получаване на резултати от inference процеси. Ефективното управление на този процес е критично за бързодействието и надеждността на интелигентните приложения.

---

## 3. Key Concepts

- **Client (Клиент)** – Софтуер или устройство, което инициира заявка към сървър. Може да бъде браузър, мобилно приложение или друг процес.
- **Server (Сървър)** – Система, която приема, обработва заявки и връща отговори. Мислете за него като ресторант, който приема поръчки и сервира храна.
- **Request (Заявка)** – Съобщение, изпратено от клиента към сървъра, съдържащо инструкции или данни.
- **Response (Отговор)** – Съобщение, изпратено от сървъра към клиента, съдържащо резултатите от обработката.
- **Protocol (Протокол)** – Набор от правила за комуникация между клиент и сървър (напр. HTTP, gRPC).
- **Request Lifecycle (Жизнен цикъл на заявка)** – Последователността от стъпки, през които преминава една заявка от изпращането ѝ до получаването на отговор.
- **Statelessness (Безсъстояние)** – Принцип, според който всяка заявка се обработва независимо, без сървърът да пази информация за предишни заявки.
- **API (Програмируем интерфейс)** – Начинът, по който клиентът и сървърът комуникират чрез стандартизирани заявки и отговори.

---

## 4. Step-by-step Learning Path

1. **Разберете ролите на клиент и сървър**
   - Фокус: Какво прави всеки компонент.
   - Задача: Нарисувайте схема на проста клиент-сървър архитектура.
   - Въпроси: Каква е основната роля на клиента? Какво прави сървърът?

2. **Изучете основните протоколи (напр. HTTP)**
   - Фокус: Как се структурират заявките и отговорите.
   - Задача: Използвайте инструмент като Postman или curl, за да изпратите GET заявка към публичен API.
   - Въпроси: Какво съдържа една HTTP заявка? Какъв е отговорът?

3. **Проследете жизнения цикъл на заявката**
   - Фокус: Какво се случва от изпращането до получаването на отговор.
   - Задача: Опишете стъпките на едно пътуване на заявка от браузър до сървър и обратно.
   - Въпроси: Кои са основните етапи на жизнения цикъл? Какво се случва при грешка?

4. **Работете с API-та**
   - Фокус: Как клиентът и сървърът обменят данни чрез API.
   - Задача: Извикайте публичен REST API и обработете отговора в малък скрипт (напр. Python).
   - Въпроси: Какво е REST? Как се различават GET и POST заявките?

5. **Анализирайте проблеми и оптимизации**
   - Фокус: Откриване на забавяния, грешки и начини за подобрение.
   - Задача: Използвайте developer tools в браузъра, за да анализирате времето за зареждане на даден ресурс.
   - Въпроси: Какви са чести причини за бавни заявки? Как може да се оптимизира комуникацията?

---

## 5. Examples

### Пример 1: HTTP заявка с curl

```bash
curl -X GET https://api.github.com/users/octocat
```
Тази команда изпраща GET заявка до GitHub API и получава информация за потребителя "octocat".

---

### Пример 2: Жизнен цикъл на заявка в уеб приложение

1. Потребителят въвежда адрес в браузъра.
2. Браузърът изпраща HTTP заявка към сървъра.
3. Сървърът обработва заявката (напр. извлича данни от база).
4. Сървърът връща HTTP отговор с HTML страница.
5. Браузърът визуализира страницата на потребителя.

---

### Пример 3: AI inference чрез API

```python
import requests

data = {"input": "Какво е клиент-сървър комуникация?"}
response = requests.post("https://ai.example.com/inference", json=data)
print(response.json())
```
Тук Python скрипт изпраща POST заявка към AI сървър и получава отговор с генериран текст.

---

## 6. Common Pitfalls

- **Пренебрегване на грешки в комуникацията** – Не всички заявки ще са успешни; винаги обработвайте грешки и изключения.
- **Липса на сигурност** – Използвайте HTTPS и валидация на входа, за да предотвратите атаки.
- **Неправилно използване на HTTP методи** – GET не трябва да променя данни, POST се използва за създаване/промяна.
- **Игнориране на latency и timeout-и** – Задавайте подходящи таймаути и оптимизирайте за бързодействие.
- **Държане на състояние в сървъра при stateless протоколи** – Избягвайте съхраняване на сесии, освен ако не е абсолютно необходимо.

---

## 7. Short Retrieval Quiz

1. Каква е основната разлика между клиент и сървър?
2. Какво представлява жизненият цикъл на заявка?
3. Какво е HTTP и защо е важен за уеб комуникацията?
4. Какво означава "stateless" в контекста на клиент-сървър комуникацията?
5. Какви са основните етапи при обработка на заявка?
6. Как се различават GET и POST заявките?
7. Защо е важно да се обработват грешки при заявки?

---

## 8. Quick Recap

- Клиентът и сървърът комуникират чрез заявки и отговори, обикновено по стандартизиран протокол.
- Жизненият цикъл на заявка включва иницииране, обработка и връщане на отговор.
- HTTP е най-често използваният протокол за уеб комуникация.
- Statelessness означава, че всяка заявка се обработва независимо.
- API-тата улесняват обмена на данни между различни системи.
- Грешките и латентността са чести предизвикателства, които трябва да се управляват.
- Сигурността и правилната употреба на протоколите са критични за надеждността на системите.

---

## 9. Spaced Review Plan

| Review Time | Prompt                                                                 |
|-------------|------------------------------------------------------------------------|
| 1 day       | Опишете жизнения цикъл на една HTTP заявка стъпка по стъпка.           |
| 3 days      | Дайте пример за клиент-сървър комуникация в AI система.                |
| 1 week      | Избройте основните грешки при клиент-сървър комуникация и как да ги избегнете. |
| 1 month     | Обяснете защо statelessness е важен принцип при изграждане на мащабируеми системи. |