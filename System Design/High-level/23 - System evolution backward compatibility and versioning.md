# 23 - System evolution backward compatibility and versioning

## 1. Activate Prior Knowledge

- Кога за последно сте обновявали даден софтуер или библиотека и срещнахте ли проблеми със съвместимостта?
- Как мислите, че големи платформи като Google или Facebook обновяват системите си, без да прекъсват работата на милиони потребители?
- Какви рискове биха възникнали, ако един AI модел или API се промени без да се спазва обратна съвместимост?

## 2. Overview

Системната еволюция е неизбежна част от жизнения цикъл на всеки софтуерен продукт или AI система. Когато системите се развиват – добавят се нови функционалности, коригират се грешки или се оптимизира производителността – възниква въпросът как тези промени ще повлияят на съществуващите потребители и интеграции.

Обратната съвместимост (backward compatibility) гарантира, че по-старите клиенти или компоненти могат да работят с новите версии на системата без прекъсване. Версионирането (versioning) е формален механизъм за управление на тези промени, така че различните версии да могат да съществуват паралелно или да се мигрират контролирано.

Тези концепции са особено критични при разработката на публични API, големи разпределени системи и AI платформи, където множество клиенти и услуги зависят от стабилността на интерфейсите. Липсата на добра стратегия за съвместимост и версиониране може да доведе до сривове, загуба на данни или доверие.

## 3. Key Concepts

- **Backward Compatibility (Обратна съвместимост)** – Способността на нова версия на система да работи с данни, клиенти или компоненти, създадени за по-стари версии. Представете си го като ново зарядно, което все още може да зарежда стария ви телефон.
- **Forward Compatibility (Напред съвместимост)** – Способността на система да работи с данни или компоненти, създадени за бъдещи версии. По-рядко срещано, но полезно при планиране на дългосрочна еволюция.
- **Versioning (Версиониране)** – Система за означаване и управление на различните издания на софтуер или API (напр. v1, v2, v2.1). Аналогия: различни издания на учебник по математика.
- **Semantic Versioning (Семантично версиониране)** – Конвенция за означаване на версии (MAJOR.MINOR.PATCH), която указва дали промяната е съвместима или не.
- **Deprecation (Остаряване)** – Процес на официално обявяване, че дадена функционалност ще бъде премахната в бъдеща версия, за да се даде време на потребителите да се адаптират.

## 4. Step-by-step Learning Path

1. **Разберете нуждата от съвместимост**
   - Фокус: Какви са последствията от липса на съвместимост?
   - Задача: Намерете реален пример за срив, причинен от несъвместима промяна (напр. API breaking change).
   - Въпроси: Какво се случва, ако премахнем поле от публичен API? Какви са последствията за клиентите?

2. **Изучете видовете съвместимост**
   - Фокус: Разлика между backward и forward compatibility.
   - Задача: Направете таблица с примери за двата типа съвместимост.
   - Въпроси: Кога е по-важна обратната съвместимост? Може ли да има само forward compatibility?

3. **Практикувайте версиониране**
   - Фокус: Как се обозначават и управляват версии.
   - Задача: Версионирайте малък REST API (напр. /api/v1/users).
   - Въпроси: Какво означава смяна от v1 към v2? Кога е подходящо да се увеличи major версията?

4. **Работете с остаряване (deprecation)**
   - Фокус: Как да обявите и управлявате премахването на функционалност.
   - Задача: Добавете deprecation notice към endpoint във вашия API.
   - Въпроси: Защо е важно да има период на остаряване? Как да информирате потребителите?

5. **Тествайте съвместимост**
   - Фокус: Как да валидирате, че новата версия не чупи старите клиенти.
   - Задача: Напишете тест, който проверява backward compatibility между две версии на API.
   - Въпроси: Какви типове тестове са нужни за гарантиране на съвместимост? Какво би се случило без такива тестове?

## 5. Examples

### Пример 1: Версиониране на REST API

```http
GET /api/v1/users
GET /api/v2/users
```
Във v2 може да се добави ново поле или да се промени структурата на отговора, без да се нарушава работата на клиентите, които ползват v1.

### Пример 2: Deprecation Warning в Python библиотека

```python
import warnings

def old_function():
    warnings.warn(
        "old_function() е остаряла и ще бъде премахната в бъдеща версия.",
        DeprecationWarning
    )
```

### Пример 3: Semantic Versioning

- Версия 2.1.0: Добавена е нова съвместима функционалност.
- Версия 3.0.0: Премахната е стара функционалност – breaking change.

## 6. Common Pitfalls

- **Прекъсване на съвместимостта без предупреждение** – Винаги обявете breaking changes и осигурете период на остаряване.
- **Липса на тестове за съвместимост** – Автоматизирайте тестовете за backward compatibility.
- **Прекомерно натрупване на legacy код** – Балансирайте между поддръжка на стари версии и технически дълг.
- **Непоследователно версиониране** – Следвайте стандартизирана схема (напр. Semantic Versioning).
- **Липса на комуникация с потребителите** – Информирайте навреме за промени и остаряване.

## 7. Short Retrieval Quiz

1. Какво означава backward compatibility?
2. Как се обозначава breaking change при семантично версиониране?
3. Каква е разликата между backward и forward compatibility?
4. Защо е важно да има deprecation период?
5. Какво може да се случи, ако премахнете поле от публичен API без предупреждение?
6. Как се обозначава нова, но съвместима функционалност при Semantic Versioning?
7. Какви тестове са нужни при еволюция на системата?

## 8. Quick Recap

- Системната еволюция изисква внимателно управление на съвместимостта и версиите.
- Backward compatibility гарантира, че старите клиенти работят с новите версии.
- Semantic Versioning помага да се комуникират типа и риска на промените.
- Deprecation позволява плавно премахване на остарели функционалности.
- Версионирането на API и библиотеките е критично за стабилността на екосистемата.
- Автоматизираните тестове за съвместимост са задължителни.
- Добрата комуникация с потребителите намалява риска от сривове и недоволство.

## 9. Spaced Review Plan

| Review Time | Prompt                                                                 |
|-------------|------------------------------------------------------------------------|
| 1 day       | Обяснете разликата между backward и forward compatibility.              |
| 3 days      | Дайте пример за breaking change и как се управлява чрез версиониране.   |
| 1 week      | Опишете процеса на deprecation и защо е важен.                         |
| 1 month     | Избройте стъпките за осигуряване на съвместимост при еволюция на API.  |