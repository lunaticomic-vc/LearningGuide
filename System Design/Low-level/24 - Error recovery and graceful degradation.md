# 24 - Error recovery and graceful degradation

## 1. Activate Prior Knowledge

- Какво се случва, когато дадено софтуерно приложение срещне неочаквана грешка по време на работа? Как реагира системата?
- Можете ли да си спомните случай, в който дадена услуга или приложение е продължило да функционира, макар и с намалена функционалност, след възникване на проблем?
- Какви са потенциалните рискове, ако една AI система не е проектирана да се възстановява от грешки или да деградира грациозно?

## 2. Overview

Error recovery и graceful degradation са фундаментални концепции в проектирането на надеждни софтуерни и AI системи. Те се отнасят до способността на системата да се справя с неочаквани грешки, като минимизира негативното въздействие върху потребителя и цялостната функционалност.

В един идеален свят системите работят безотказно, но в реалността хардуерни повреди, софтуерни бъгове, мрежови прекъсвания и неочаквани входни данни са неизбежни. Затова е критично важно системите да могат да се възстановяват от грешки (error recovery) и, когато това не е възможно, да продължат да работят с намалена, но все пак полезна функционалност (graceful degradation).

Тези подходи са особено важни в AI системи и критични инфраструктури, където пълният отказ може да доведе до сериозни последствия. Чрез правилно внедряване на error recovery и graceful degradation се повишава устойчивостта, сигурността и доверието в системата.

## 3. Key Concepts

- **Error recovery** – Процесът, чрез който системата открива, обработва и, ако е възможно, автоматично коригира възникнали грешки. Може да се сравни с това, когато GPS приложението ви преизчислява маршрут след пропуснат завой.
- **Graceful degradation** – Способността на системата да продължи да функционира частично, когато някои нейни компоненти се повредят или не са достъпни. Представете си, че видео стрийминг услугата намалява качеството на видеото при слаб интернет, вместо да спре напълно.
- **Fault tolerance** – Дизайн подход, при който системата е способна да продължи работа дори при наличие на дефекти или откази на части от нея.
- **Fallback mechanisms** – Алтернативни процеси или компоненти, които се активират при отказ на основната функционалност.
- **Redundancy** – Въвеждане на резервни компоненти или системи, които поемат работата при отказ на основните.
- **Failover** – Автоматично превключване към резервна система или компонент при отказ на основния.
- **User feedback** – Информиране на потребителя за възникнали грешки и наличните алтернативи или ограничения.

## 4. Step-by-step Learning Path

1. **Разберете видовете грешки в системите**
   - Фокус: Класифицирайте грешките (хардуерни, софтуерни, мрежови, потребителски).
   - Практическа задача: Направете списък с възможни грешки във ваше приложение.
   - Въпроси: Какви грешки са най-чести във вашата система? Как ги откривате?

2. **Изучете техники за error detection и logging**
   - Фокус: Как се откриват и записват грешки.
   - Практическа задача: Имплементирайте логване на грешки в малък скрипт.
   - Въпроси: Какво е важно да се записва при грешка? Как логовете помагат за възстановяване?

3. **Внедрете error recovery механизми**
   - Фокус: Автоматично възстановяване, retries, transaction rollbacks.
   - Практическа задача: Добавете retry логика при неуспешна мрежова заявка.
   - Въпроси: Кога е подходящо да се опитате отново? Как да избегнете безкрайни опити?

4. **Планирайте graceful degradation**
   - Фокус: Определете кои функционалности могат да се жертват при проблем.
   - Практическа задача: Опишете как вашето приложение ще работи при отказ на външна услуга.
   - Въпроси: Кои части на системата са критични? Какво може да се изключи временно?

5. **Тествайте и симулирайте откази**
   - Фокус: Chaos engineering, fault injection.
   - Практическа задача: Симулирайте отказ на компонент и наблюдавайте поведението.
   - Въпроси: Как реагира системата? Получава ли потребителят смислена обратна връзка?

## 5. Examples

### Пример 1: Web API с retry и fallback

```python
import requests
from time import sleep

def fetch_data():
    for attempt in range(3):
        try:
            response = requests.get("https://api.example.com/data")
            response.raise_for_status()
            return response.json()
        except Exception as e:
            print(f"Attempt {attempt+1} failed: {e}")
            sleep(1)
    print("Falling back to cached data.")
    return {"data": "cached"}
```

### Пример 2: AI система с graceful degradation

В AI chatbot, ако основният модел не е достъпен, системата преминава към по-опростен, локален модел, който предоставя базови отговори, вместо да прекрати услугата напълно.

### Пример 3: Видео стрийминг

Когато интернет връзката се влоши, видео услугата автоматично намалява резолюцията, вместо да прекъсне възпроизвеждането.

## 6. Common Pitfalls

- **Липса на достатъчно логване** – Без подробни логове е трудно да се анализират и възстановяват грешки. Винаги логвайте контекста на грешката.
- **Безкрайни retry цикли** – Може да доведе до претоварване на системата. Използвайте ограничен брой опити и backoff стратегии.
- **Неинформиране на потребителя** – Ако потребителят не знае, че функционалността е ограничена, може да се обърка или разочарова. Винаги осигурявайте ясна обратна връзка.
- **Прекалено сложни fallback механизми** – Могат да въведат нови бъгове. Дръжте ги прости и добре тествани.
- **Игнориране на частични откази** – Дори малки откази могат да доведат до каскадни проблеми, ако не се обработят правилно.

## 7. Short Retrieval Quiz

1. Каква е разликата между error recovery и graceful degradation?
2. Какво представлява fallback механизъмът?
3. Защо е важно да се информира потребителят при възникване на грешка?
4. Какво е redundancy и как помага при откази?
5. Дайте пример за graceful degradation в уеб приложение.
6. Какви са рисковете при безкрайни retry опити?
7. Какво е важно да се логва при възникване на грешка?

## 8. Quick Recap

- Error recovery и graceful degradation повишават устойчивостта на системите.
- Error recovery цели автоматично възстановяване след грешка.
- Graceful degradation позволява частична функционалност при отказ.
- Критични са добрите логове, информиране на потребителя и прости fallback механизми.
- Тестовете и симулациите на откази са важни за реална устойчивост.
- Прекалената сложност и липсата на лимити при възстановяване могат да доведат до нови проблеми.
- Резервните компоненти и автоматичното превключване (failover) са ключови за надеждността.

## 9. Spaced Review Plan

| Review Time | Prompt                                      |
|-------------|---------------------------------------------|
| 1 day       | Обяснете разликата между error recovery и graceful degradation с пример. |
| 3 days      | Опишете как бихте внедрили fallback механизъм във ваше приложение.       |
| 1 week      | Избройте често срещани грешки при внедряване на error recovery.          |
| 1 month     | Дайте пример за graceful degradation в реална система и анализирайте ползите. |