# 03 - ACID properties

## 1. Activate Prior Knowledge

- Какво се случва, ако две програми се опитват да променят едни и същи данни в база едновременно?
- Можете ли да си спомните случай, когато дадена транзакция в софтуерна система е била прекъсната или е довела до неконсистентни данни?
- Какви са рисковете за AI системи, ако базата данни не гарантира надеждност при записите?

## 2. Overview

ACID е фундаментален принцип в управлението на транзакции в релационните бази данни и други системи за управление на данни. Съкращението означава Atomicity (атомарност), Consistency (консистентност), Isolation (изолация) и Durability (устойчивост). Тези свойства гарантират, че всяка транзакция се обработва надеждно, дори при сривове, конкуриращи се заявки или хардуерни проблеми.

В контекста на софтуерното инженерство и AI системите, ACID свойствата са критични за предотвратяване на загуба или корупция на данни. Например, когато AI модел се обучава върху големи обеми данни, е важно да се гарантира, че тези данни са точни и непротиворечиви.

ACID свойствата са в основата на транзакционните системи – от банкови приложения до системи за резервации и критични инфраструктури. Те осигуряват доверие, че данните ще останат в коректно състояние, независимо от външни фактори.

## 3. Key Concepts

- Transaction (Транзакция) – Последователност от операции, която се третира като едно цяло. Може да се сравни с банков превод: или целият превод се извършва, или нищо не се случва.
- Atomicity (Атомарност) – Гарантира, че транзакцията се изпълнява изцяло или изобщо не се изпълнява. Представете си го като прекъсвач: няма междинно състояние.
- Consistency (Консистентност) – Данните преминават от едно валидно състояние в друго, спазвайки всички дефинирани правила и ограничения.
- Isolation (Изолация) – Паралелните транзакции не си влияят взаимно; резултатът е същият, все едно са изпълнени последователно.
- Durability (Устойчивост) – След като транзакцията е потвърдена (committed), промените са постоянни, дори при срив на системата.

## 4. Step-by-step Learning Path

1. **Фокус: Разбиране на транзакциите**
   - Задача: Опишете с думи какво е транзакция и дайте пример от ежедневието.
   - Въпроси: Какво отличава транзакцията от обикновена операция? Защо е важно да се групират операции?

2. **Фокус: Дефиниране на всяко ACID свойство**
   - Задача: За всяко свойство (A, C, I, D) напишете по едно изречение с пример.
   - Въпроси: Какво би се случило, ако липсва атомарност? Какви са последствията от липса на изолация?

3. **Фокус: Практическо прилагане**
   - Задача: Използвайте SQL база данни (например SQLite или PostgreSQL), за да изпълните транзакция с INSERT и UPDATE. Прекъснете я нарочно и наблюдавайте резултата.
   - Въпроси: Как системата реагира при неуспешна транзакция? Как се гарантира устойчивостта?

4. **Фокус: ACID в контекста на AI/ML**
   - Задача: Опишете сценарий, в който нарушаване на ACID свойствата би довело до проблеми при обучение на AI модел.
   - Въпроси: Какви грешки може да възникнат при неконсистентни данни? Как изолацията влияе на паралелното обучение?

## 5. Examples

### Пример 1: Банкова транзакция

```sql
BEGIN;
UPDATE accounts SET balance = balance - 100 WHERE id = 1;
UPDATE accounts SET balance = balance + 100 WHERE id = 2;
COMMIT;
```
Ако някоя от операциите се провали, цялата транзакция се отменя (ROLLBACK), гарантирайки атомарност и консистентност.

### Пример 2: Регистрация на потребител

```python
try:
    db.begin_transaction()
    db.insert('users', new_user)
    db.insert('profiles', user_profile)
    db.commit()
except Exception:
    db.rollback()
```
Тук се гарантира, че и двата записа ще се появят заедно или изобщо няма да се появят.

### Пример 3: AI система за препоръки

Ако множество процеси едновременно актуализират таблица с потребителски действия, изолацията гарантира, че всеки запис е коректен и не се губят данни при конкуренция.

## 6. Common Pitfalls

- **Пренебрегване на изолацията:** Паралелни транзакции могат да доведат до "dirty reads" или "lost updates". Използвайте подходящи нива на изолация.
- **Неправилно управление на грешки:** Ако не се използва ROLLBACK при грешка, частични промени могат да останат в базата.
- **Липса на устойчивост:** Ако транзакцията не е потвърдена, но се смята за успешна, при срив на системата се губят данни.
- **Непълна консистентност:** Пропускане на проверки за ограничения (constraints) може да доведе до некоректни данни.

## 7. Short Retrieval Quiz

1. Какво означава всяка буква в ACID?
2. Защо атомарността е важна при банкови операции?
3. Какво би станало, ако липсва изолация между транзакциите?
4. Как се гарантира устойчивостта на транзакциите?
5. Дайте пример за консистентност в база данни.
6. Какво е транзакция?
7. Какви са рисковете за AI системи при нарушаване на ACID свойствата?

## 8. Quick Recap

- ACID е съвкупност от четири ключови свойства за надеждни транзакции.
- Атомарността гарантира, че транзакциите са "всичко или нищо".
- Консистентността поддържа валидността на данните.
- Изолацията предотвратява взаимно влияние между паралелни транзакции.
- Устойчивостта осигурява запазване на данните след потвърждение.
- ACID е критично важен за финансови, AI и други чувствителни системи.
- Пренебрегването на някое от свойствата може да доведе до сериозни грешки и загуба на данни.

## 9. Spaced Review Plan

| Review Time | Prompt |
|-------------|--------|
| 1 day       | Опишете с примери всяко ACID свойство. |
| 3 days      | Обяснете какво би се случило при липса на изолация в паралелни транзакции. |
| 1 week      | Дайте пример за реален проблем, породен от нарушаване на ACID. |
| 1 month     | Обобщете защо ACID е важен за AI системи и как го прилагате на практика. |