# 19 - Global system design and multi-region deployments

## 1. Activate Prior Knowledge

- Какви са основните предизвикателства при изграждането на големи, мащабируеми софтуерни системи?
- Какво означава „latency“ (закъснение) и как влияе на потребителското изживяване при глобални приложения?
- Какви подходи познавате за осигуряване на надеждност и непрекъсната работа на системи, които обслужват потребители от различни географски региони?

## 2. Overview

Глобалният дизайн на системи и мултирегионалните внедрявания са ключови за съвременните облачни и AI-базирани приложения, които трябва да обслужват потребители по целия свят. Основната цел е да се осигури висока наличност, ниско закъснение и устойчивост на откази, независимо от местоположението на потребителите или възникването на локални проблеми в инфраструктурата.

Вместо да разчитаме на един-единствен дата център, мултирегионалният подход разпределя компонентите на системата в няколко географски разположени центрове за данни. Това позволява по-бърз достъп до услугите, по-добра защита срещу природни бедствия или технически сривове и по-лесно спазване на регулаторни изисквания.

Този подход е особено важен за AI системи, които често обработват големи обеми от данни и трябва да реагират бързо на заявки от различни части на света. Глобалният дизайн изисква внимателно планиране на репликацията на данни, синхронизацията, балансирането на натоварването и управлението на капацитета.

## 3. Key Concepts

- Region – Географски определена зона (например Европа, Азия), в която облачен доставчик разполага с един или повече дата центрове.
- Availability Zone (AZ) – Независим дата център в рамките на един регион, осигуряващ по-висока устойчивост чрез физическа и електрическа изолация.
- Latency – Времето, което е необходимо на данните да преминат от източника до местоназначението; като пощенска картичка, която пътува от един континент до друг.
- Replication – Копиране на данни между различни региони или зони, за да се осигури надеждност и достъпност.
- Failover – Автоматично пренасочване на трафика към работещ регион или зона при възникване на проблем.
- Data Sovereignty – Изисквания данните да се съхраняват и обработват в определена държава или регион.
- Global Load Balancing – Разпределяне на входящия трафик между различни региони, подобно на разпределяне на клиенти между няколко офиса на една компания.

## 4. Step-by-step Learning Path

1. **Разберете регионите и зоните**
   - Фокус: Какво представляват регионите и зоните в облачните платформи.
   - Задача: Намерете и опишете регионите и зоните, които предлага избран облачен доставчик (например AWS, Azure или GCP).
   - Въпроси: Каква е разликата между регион и зона? Защо са важни?

2. **Изследвайте репликацията на данни**
   - Фокус: Как се осъществява синхронизацията на данни между региони.
   - Задача: Конфигурирайте проста репликация на база данни между два региона (може да е с помощта на облачна услуга).
   - Въпроси: Какви са предимствата и недостатъците на синхронната и асинхронната репликация?

3. **Настройте глобално балансиране на натоварването**
   - Фокус: Как се разпределя трафикът между различни региони.
   - Задача: Създайте демо с глобален load balancer, който насочва заявки към най-близкия регион.
   - Въпроси: Как load balancer-ът определя кой регион да избере? Какво се случва при отказ на регион?

4. **Планирайте failover стратегии**
   - Фокус: Как да осигурим непрекъсната работа при срив в регион.
   - Задача: Опишете сценарий за автоматичен failover и какво трябва да се случи с трафика и данните.
   - Въпроси: Какви са предизвикателствата при failover между региони? Как се възстановява нормалната работа?

5. **Оценете latency и разходи**
   - Фокус: Как latency и цената влияят на избора на архитектура.
   - Задача: Използвайте инструмент за измерване на latency между различни региони и анализирайте резултатите.
   - Въпроси: Как latency влияе на потребителското изживяване? Какви компромиси между цена и производителност трябва да се направят?

## 5. Examples

### Пример 1: Глобално разпределена уеб услуга

Уеб приложение, използващо AWS с инстанции в Европа и Азия, използва Route 53 (DNS load balancer), за да насочва потребителите към най-близкия регион. Данните се репликират асинхронно между регионите чрез DynamoDB Global Tables.

### Пример 2: AI inference в няколко региона

AI модел за разпознаване на изображения се деплойва в няколко Google Cloud региони. Когато потребител качи снимка, заявката се обработва в най-близкия регион, намалявайки latency и разходи за трансфер.

```python
# Примерен псевдокод за избор на регион на база геолокация
def choose_region(user_location):
    regions = {'eu-west': 'Ireland', 'asia-east': 'Taiwan'}
    closest = min(regions, key=lambda r: distance(user_location, regions[r]))
    return closest
```

### Пример 3: Failover при срив

Банкова система използва Azure Traffic Manager за автоматично пренасочване на трафика към резервен регион при недостъпност на основния.

## 6. Common Pitfalls

- **Недостатъчна репликация на данни** – Ако данните не се синхронизират правилно между регионите, може да се загуби информация или да възникнат несъответствия.
- **Пренебрегване на latency** – Изборът на региони без анализ на закъснението може да доведе до бавно зареждане и лошо потребителско изживяване.
- **Липса на автоматичен failover** – Ако failover-ът не е автоматизиран, възстановяването при срив ще е бавно и ръчно.
- **Неспазване на регулаторни изисквания** – Неправилно съхранение на данни в региони, където това е забранено, може да доведе до юридически проблеми.
- **Подценяване на разходите** – Глобалните внедрявания могат да увеличат значително разходите, ако не се планират внимателно.

## 7. Short Retrieval Quiz

1. Каква е основната разлика между регион и зона за наличност?
2. Какво е latency и защо е важно при глобални системи?
3. Какви са предимствата на мултирегионалното внедряване?
4. Какво представлява failover и кога се използва?
5. Какви са рисковете при асинхронна репликация на данни?
6. Как load balancer-ът избира към кой регион да насочи трафика?
7. Какви регулаторни изисквания трябва да се вземат предвид при глобални системи?

## 8. Quick Recap

- Глобалният дизайн и мултирегионалните внедрявания осигуряват висока наличност, ниско закъснение и устойчивост.
- Регионите и зоните са основни градивни елементи на облачната инфраструктура.
- Репликацията на данни и автоматичният failover са критични за надеждността.
- Глобалното балансиране на натоварването оптимизира достъпа на потребителите.
- Latency и разходите трябва да се анализират внимателно при избора на архитектура.
- Регулаторните изисквания за съхранение на данни не бива да се подценяват.
- Честите грешки включват липса на автоматизация, лоша репликация и подценяване на разходите.

## 9. Spaced Review Plan

| Time      | Review Prompt                                                                 |
|-----------|------------------------------------------------------------------------------|
| 1 day     | Обяснете разликата между регион и зона. Дайте пример за глобално внедряване.  |
| 3 days    | Опишете как работи failover между региони и какви са предизвикателствата.     |
| 1 week    | Избройте основните предимства и недостатъци на мултирегионалните системи.     |
| 1 month   | Анализирайте реален случай на глобална система и идентифицирайте рисковете.   |