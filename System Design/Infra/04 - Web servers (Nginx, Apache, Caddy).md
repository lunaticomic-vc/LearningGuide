# 04 - Web servers (Nginx, Apache, Caddy)

## 1. Activate Prior Knowledge

- Какво е ролята на уеб сървъра в една типична AI или софтуерна система?
- Кога последно сте настройвали или използвали уеб сървър? Какви предизвикателства срещнахте?
- Можете ли да предвидите как изборът на уеб сървър влияе върху производителността и сигурността на дадено приложение?

## 2. Overview

Уеб сървърите са основният мост между клиентите (браузъри, API клиенти) и бекенд приложенията. Те приемат HTTP(S) заявки, обработват ги и връщат отговори – често като статични файлове или препращайки заявките към други услуги (напр. AI inference сървъри).

В по-широкия контекст на софтуерното инженерство, уеб сървърите като Nginx, Apache и Caddy са критични за мащабируемост, сигурност и надеждност на системите. Те позволяват баланс на натоварването, SSL терминaция, кеширане и други оптимизации.

Изборът на подходящ уеб сървър и правилната му конфигурация са ключови за постигане на висока производителност и сигурност, особено при AI приложения, които често работят с голям обем данни и множество паралелни заявки.

## 3. Key Concepts

- **Web server** – Софтуер, който приема HTTP(S) заявки и връща отговори. Може да доставя статични файлове или да препраща заявки към други процеси. Представете си го като рецепционист, който насочва посетителите към правилната стая.
- **Reverse proxy** – Уеб сървър, който приема заявки и ги препраща към един или повече бекенд сървъри. Аналогия: като пощальон, който разпределя писмата до различни отдели.
- **Static content** – Файлове, които не се променят динамично (HTML, CSS, JS, изображения).
- **Load balancing** – Разпределяне на входящите заявки между няколко бекенд сървъра за по-добра производителност и устойчивост.
- **SSL/TLS termination** – Процесът на декриптиране на HTTPS трафика на уеб сървъра, преди да бъде препратен към вътрешните услуги.
- **Configuration file** – Файл, в който се описват правилата и поведението на уеб сървъра (например `nginx.conf`, `.htaccess`, `Caddyfile`).

## 4. Step-by-step Learning Path

1. **Разберете основната роля на уеб сървърите**
   - Фокус: Какво прави един уеб сървър и защо е нужен.
   - Практическа задача: Намерете и прегледайте логовете на работещ уеб сървър.
   - Въпроси: Какви типове заявки обработва уеб сървърът? Какво се случва при грешка?

2. **Инсталирайте и стартирайте Nginx, Apache или Caddy**
   - Фокус: Основна инсталация и стартиране на сървър.
   - Практическа задача: Инсталирайте избран уеб сървър и достъпете началната му страница локално.
   - Въпроси: Как стартирате/спирате сървъра? Къде се намира конфигурационният файл?

3. **Конфигурирайте статично съдържание**
   - Фокус: Настройване на уеб сървъра да обслужва HTML/CSS/JS файлове.
   - Практическа задача: Създайте директория със статични файлове и ги сервирайте през уеб сървъра.
   - Въпроси: Как се указва пътя до статичните файлове? Какво се случва при липсващ файл?

4. **Настройте reverse proxy към бекенд услуга**
   - Фокус: Препращане на заявки към вътрешен API или AI inference сървър.
   - Практическа задача: Настройте reverse proxy към локално работещо приложение (например Flask, Node.js).
   - Въпроси: Как се дефинира upstream сървър? Какво се случва при недостъпен бекенд?

5. **Добавете SSL/TLS сертификат**
   - Фокус: Сигурност на комуникацията.
   - Практическа задача: Инсталирайте самоподписан или Let's Encrypt сертификат.
   - Въпроси: Какво е разликата между HTTP и HTTPS? Как се обновява сертификатът?

6. **Използвайте логове и мониторинг**
   - Фокус: Следене на трафика и грешките.
   - Практическа задача: Анализирайте логовете за грешки и достъп.
   - Въпроси: Какви типове грешки се срещат най-често? Как може да се автоматизира мониторингът?

## 5. Examples

### Пример 1: Reverse proxy с Nginx

```nginx
server {
    listen 80;
    server_name example.com;

    location / {
        proxy_pass http://localhost:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### Пример 2: Статичен сайт с Apache

```apache
<VirtualHost *:80>
    DocumentRoot "/var/www/html"
    ServerName mysite.local
    <Directory "/var/www/html">
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>
```

### Пример 3: Автоматичен HTTPS с Caddy

```caddyfile
example.com {
    reverse_proxy localhost:8000
}
```
*(Caddy автоматично издава и обновява SSL сертификати)*

## 6. Common Pitfalls

- **Грешни права на файловете** – Ако уеб сървърът няма достъп до файловете, ще връща грешки 403 или 404. Проверявайте правата и собствеността.
- **Липса на SSL/TLS** – Излагането на чувствителни данни през HTTP е сериозен риск. Винаги използвайте HTTPS в продукция.
- **Неправилно конфигуриран reverse proxy** – Може да доведе до неработещи приложения или изтичане на вътрешна информация. Винаги валидирайте настройките.
- **Претоварване на сървъра** – Липса на лимити или кеширане може да доведе до срив при много заявки.
- **Забравени обновления** – Остарели версии на сървърите са уязвими. Поддържайте ги актуални.

## 7. Short Retrieval Quiz

1. Каква е основната функция на уеб сървъра?
2. Какво представлява reverse proxy?
3. Как се различават Nginx, Apache и Caddy по отношение на конфигурация и автоматизация?
4. Как се добавя SSL сертификат към уеб сървър?
5. Какви са типичните грешки при обслужване на статични файлове?
6. Защо е важно да се анализират логовете на уеб сървъра?
7. Какво е load balancing и кога се използва?

## 8. Quick Recap

- Уеб сървърите са критични за комуникацията между клиенти и бекенд услуги.
- Nginx, Apache и Caddy са най-популярните решения с различни силни страни.
- Reverse proxy позволява интеграция с вътрешни приложения и баланс на натоварването.
- SSL/TLS е задължителен за сигурна комуникация.
- Конфигурационните файлове управляват поведението на сървъра.
- Анализът на логове помага за диагностика и оптимизация.
- Правилната настройка предотвратява чести грешки и уязвимости.

## 9. Spaced Review Plan

| Review Time | Prompt                                                                 |
|-------------|------------------------------------------------------------------------|
| 1 day       | Обяснете разликата между Nginx, Apache и Caddy.                        |
| 3 days      | Настройте reverse proxy и SSL за тестово приложение.                   |
| 1 week      | Идентифицирайте и коригирайте честа грешка в конфигурацията.           |
| 1 month     | Опишете как бихте избрали уеб сървър за нов AI проект и защо.          |