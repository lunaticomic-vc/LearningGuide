# 09 - CI|CD pipelines and deployment automation

## 1. Activate Prior Knowledge

- Какви стъпки предприемате, когато искате да внедрите нова версия на софтуерна система в продукционна среда?
- Какви проблеми могат да възникнат при ръчното внедряване на софтуер, особено при сложни AI системи?
- Какви инструменти или практики познавате за автоматизиране на процеса по тестване и внедряване на код?

## 2. Overview

CI/CD (Continuous Integration/Continuous Deployment) е съвкупност от практики и инструменти, които автоматизират процеса на интеграция на нов код, тестване и внедряване в продукционна среда. Това позволява на екипите да доставят софтуер по-бързо, по-надеждно и с по-малко човешка намеса.

В контекста на AI системи, където често се работи с големи обеми данни и сложни зависимости, автоматизацията на внедряването е критична за поддържане на качество и бърза реакция при промени. CI/CD осигурява проследимост, възможност за бързо връщане назад и минимизира риска от човешки грешки.

CI/CD pipeline-ите са като поточна линия във фабрика: всеки етап автоматично проверява, тества и подготвя продукта (кода) за следващата фаза, докато не стигне до крайния потребител.

## 3. Key Concepts

- Continuous Integration (CI) – Автоматично обединяване и тестване на нов код в основното хранилище. Представете си го като автоматична проверка на всяка нова част, която добавяте към машина.
- Continuous Deployment (CD) – Автоматично внедряване на успешно тестван код в продукционна или тестова среда. Подобно е на автоматичното изпращане на готов продукт към клиента.
- Pipeline – Последователност от автоматизирани стъпки (build, test, deploy), които се изпълняват при всяка промяна в кода.
- Build – Процесът на компилиране/сглобяване на приложението, за да е готово за тестване и внедряване.
- Test automation – Автоматизирано изпълнение на тестове за проверка на качеството на кода.
- Deployment automation – Скриптове или инструменти, които автоматизират внедряването на приложението в различни среди.
- Rollback – Възможност за автоматично връщане към предишна стабилна версия при проблем.

## 4. Step-by-step Learning Path

1. **Разберете основите на CI/CD**
   - Фокус: Какво представляват CI и CD, и защо са важни.
   - Практическа задача: Намерете и прочетете документация за CI/CD в избрана платформа (например GitHub Actions, GitLab CI).
   - Retrieval questions: Каква е разликата между CI и CD? Какви са основните ползи от автоматизацията?

2. **Създайте прост pipeline**
   - Фокус: Основни стъпки – build, test, deploy.
   - Практическа задача: Настройте елементарен pipeline за малък проект (например Python скрипт) с автоматично тестване.
   - Retrieval questions: Какви стъпки включва вашият pipeline? Как се задейства pipeline-ът?

3. **Добавете автоматизирани тестове**
   - Фокус: Значението на тестовете и тяхната интеграция в pipeline-а.
   - Практическа задача: Добавете unit тестове и ги интегрирайте в CI стъпката.
   - Retrieval questions: Какво се случва, ако тестовете не минат? Защо е важно тестовете да са част от pipeline-а?

4. **Автоматизирайте внедряването**
   - Фокус: Deployment automation – скриптове, инструменти, среди.
   - Практическа задача: Настройте автоматично внедряване към тестова среда (например с Docker или cloud платформа).
   - Retrieval questions: Какви са предимствата на автоматизираното внедряване? Какво е rollback и кога се използва?

5. **Следете и подобрявайте pipeline-а**
   - Фокус: Мониторинг, логове, оптимизация.
   - Практическа задача: Добавете известия (например по email или Slack) при неуспех на pipeline-а.
   - Retrieval questions: Как разбирате, че нещо се е объркало в pipeline-а? Как бихте подобрили скоростта или надеждността?

## 5. Examples

### Пример 1: GitHub Actions за Python проект

```yaml
name: CI Pipeline

on: [push]

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - name: Install dependencies
        run: pip install -r requirements.txt
      - name: Run tests
        run: pytest
```

### Пример 2: Автоматично внедряване с Docker и GitLab CI

```yaml
stages:
  - build
  - deploy

build:
  stage: build
  script:
    - docker build -t myapp:latest .

deploy:
  stage: deploy
  script:
    - docker run -d -p 80:80 myapp:latest
  only:
    - main
```

### Пример 3: Rollback при неуспешно внедряване

- Ако автоматизираният deploy pipeline засече грешка (например неуспешен health check), автоматично се изпълнява скрипт, който връща предишната стабилна версия на приложението.

## 6. Common Pitfalls

- Пропускане на автоматизирани тестове – води до внедряване на бъгове в продукция. Винаги интегрирайте тестове в pipeline-а.
- Липса на rollback механизъм – при проблеми внедряването може да спре системата. Осигурете автоматично връщане към стабилна версия.
- Твърде сложни или бавни pipeline-и – забавят разработката. Оптимизирайте и разделяйте pipeline-а на малки, бързи стъпки.
- Лоша документация на pipeline-а – затруднява поддръжката. Документирайте всяка стъпка и условие.
- Недостатъчен мониторинг – проблемите остават незабелязани. Настройте известия и логове.

## 7. Short Retrieval Quiz

1. Какво означават CI и CD?
2. Какви са основните стъпки в един CI/CD pipeline?
3. Защо е важно да има автоматизирани тестове в pipeline-а?
4. Какво представлява rollback и кога се използва?
5. Какви инструменти за CI/CD познавате?
6. Какви са рисковете при ръчно внедряване на софтуер?
7. Как може да се разбере, че pipeline-ът е неуспешен?

## 8. Quick Recap

- CI/CD автоматизира интеграцията, тестването и внедряването на софтуер.
- Pipeline-ите са последователности от автоматизирани стъпки.
- Автоматизираните тестове са критични за качеството на кода.
- Deployment automation намалява риска от човешки грешки и ускорява доставката.
- Rollback механизмите осигуряват бързо възстановяване при проблеми.
- Инструменти като GitHub Actions, GitLab CI и Jenkins са широко използвани.
- Добрата документация и мониторинг са ключови за поддръжката.

## 9. Spaced Review Plan

| Review Time | Prompt                                                         |
|-------------|---------------------------------------------------------------|
| 1 day       | Опишете основните етапи на един CI/CD pipeline.               |
| 3 days      | Дайте пример за автоматизирано внедряване и rollback.         |
| 1 week      | Кои са типичните грешки при внедряване на CI/CD?              |
| 1 month     | Как бихте внедрили CI/CD pipeline за AI проект?               |