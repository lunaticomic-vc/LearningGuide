# 15 - Data versioning and conflict resolution

## 1. Activate Prior Knowledge

- Какво се случва, когато няколко души работят едновременно върху един и същ документ или база данни?
- Срещали ли сте ситуации, в които различни версии на един и същ файл или данни се разминават? Как ги разрешихте?
- Какви техники за управление на промени познавате от софтуерното инженерство или системите за контрол на версиите?

## 2. Overview

Data versioning и conflict resolution са критични теми в съвременните системи за управление на данни, особено когато множество потребители или процеси имат достъп до едни и същи ресурси. Data versioning позволява проследяване, съхраняване и възстановяване на различни състояния на данните във времето. Това е особено важно при колаборативна работа, автоматизация и машинно обучение, където експериментите и резултатите трябва да бъдат възпроизводими.

Conflict resolution се занимава с решаването на несъответствия, които възникват, когато паралелни промени по едни и същи данни се опитват да бъдат обединени. Без ефективни стратегии за разрешаване на конфликти, данните могат да станат неконсистентни или дори да се загубят важни промени.

Тези концепции са в основата на системи като Git, разпределени бази данни (напр. Cassandra, DynamoDB), инструменти за управление на експерименти в AI и други. Разбирането им е ключово за изграждане на надеждни, мащабируеми и колаборативни софтуерни решения.

## 3. Key Concepts

- Data versioning – Процесът на създаване и съхраняване на различни версии на данни, така че всяка промяна да може да бъде проследена и възстановена при нужда. Аналогия: като историята на редакции в Google Docs.
- Conflict resolution – Механизмите и стратегиите за разрешаване на противоречия, когато две или повече промени по едни и същи данни се сблъскат. Може да е автоматично (merge) или ръчно (manual intervention).
- Merge – Процесът на комбиниране на различни версии на данни в една финална версия, като се опитва да се запази максимално информацията.
- Optimistic concurrency control – Техника, при която се допуска паралелна работа и се проверява за конфликти при запис, вместо да се заключват данните предварително.
- Snapshot – Снимка на състоянието на данните в даден момент, често използвана за възстановяване или сравнение на версии.
- Lineage – Историята на промените по дадени данни – кой, кога и какво е променил.
- Three-way merge – Алгоритъм, който сравнява две версии спрямо общ предшественик, за да определи как да ги обедини.

## 4. Step-by-step Learning Path

1. **Разберете нуждата от data versioning**
   - Фокус: Защо е важно да проследяваме версии на данните.
   - Задача: Опишете ситуация, в която липсата на версиониране е довела до проблем.
   - Въпроси: Какво може да се обърка без versioning? Къде се използва versioning в ежедневието ви?

2. **Запознайте се с основни техники за versioning**
   - Фокус: Snapshot-и, commit-и, hash-ове.
   - Задача: Създайте няколко версии на текстов файл с Git и разгледайте историята.
   - Въпроси: Как Git идентифицира различните версии? Какво е commit hash?

3. **Изучете причините за възникване на конфликти**
   - Фокус: Паралелна работа, race conditions, latency.
   - Задача: Опитайте да направите едновременни промени в един и същ файл с двама души в Git.
   - Въпроси: Какво се случи при опит за сливане? Как се сигнализира конфликт?

4. **Практикувайте conflict resolution**
   - Фокус: Merge, rebase, ръчно разрешаване на конфликти.
   - Задача: Разрешете merge conflict в Git и документирайте стъпките.
   - Въпроси: Как разпознахте конфликтните части? Как избрахте коя версия да запазите?

5. **Приложете versioning и conflict resolution в контекста на AI/ML**
   - Фокус: Версиониране на датасети, модели, експерименти.
   - Задача: Използвайте инструмент като DVC или MLflow, за да версионирате датасет и модел.
   - Въпроси: Как се проследяват промените? Какво се случва при конфликт между експерименти?

## 5. Examples

### Пример 1: Версиониране с Git

```bash
git init
echo "Първа версия" > data.txt
git add data.txt
git commit -m "Добавена първа версия"
echo "Втора версия" > data.txt
git commit -am "Обновена версия"
git log
```
Тук всяка промяна по `data.txt` се съхранява като отделна версия.

### Пример 2: Merge conflict в Git

Двама потребители променят един и същ ред в `data.txt` на различни клонове. При опит за сливане Git сигнализира конфликт, който трябва да бъде разрешен ръчно.

### Пример 3: Версиониране на ML експерименти с DVC

```bash
dvc init
dvc add data.csv
git add data.csv.dvc .gitignore
git commit -m "Добавен датасет с DVC"
```
Това позволява проследяване на различни версии на датасета, използван в експериментите.

## 6. Common Pitfalls

- **Игнориране на versioning** – Води до загуба на данни или невъзможност за възстановяване на предишни състояния.
- **Неправилно разрешаване на конфликти** – Може да се загубят важни промени или да се създадат неконсистентни данни.
- **Липса на автоматизация** – Ръчното проследяване на версии е податливо на грешки.
- **Пренебрегване на lineage** – Без история на промените е трудно да се проследят причините за дадено състояние на данните.

## 7. Short Retrieval Quiz

1. Какво е data versioning и защо е важно?
2. Какво представлява conflict resolution?
3. Как Git сигнализира за конфликт при сливане?
4. Какво е snapshot в контекста на данни?
5. Какво е three-way merge?
6. Какви са рисковете при липса на versioning?
7. Дайте пример за инструмент за versioning в AI/ML.

## 8. Quick Recap

- Data versioning позволява проследяване и възстановяване на различни състояния на данните.
- Conflict resolution е процесът на разрешаване на противоречия при паралелни промени.
- Merge и three-way merge са основни техники за обединяване на версии.
- Инструменти като Git и DVC автоматизират versioning и conflict resolution.
- Липсата на versioning и неправилно разрешаване на конфликти водят до загуба на данни.
- Lineage е ключов за проследяване на историята на данните.
- Практическото приложение включва колаборативна работа, ML експерименти и разпределени системи.

## 9. Spaced Review Plan

| Review Time | Prompt                                                                 |
|-------------|------------------------------------------------------------------------|
| 1 day       | Обяснете с примери какво е data versioning и защо се използва.         |
| 3 days      | Опишете стъпките за разрешаване на merge conflict в Git.               |
| 1 week      | Дайте пример за conflict resolution в разпределена база данни.         |
| 1 month     | Обсъдете предимствата и рисковете на различни стратегии за versioning. |