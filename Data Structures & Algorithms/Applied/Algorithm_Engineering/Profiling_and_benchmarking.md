# Profiling_and_benchmarking

## 1. Activate Prior Knowledge
- Какво представлява изпълнението на софтуер и защо е важно да го измерваме?
- Какви са основните предизвикателства при оптимизирането на AI системи по отношение на производителността?
- Как бихте сравнили две различни реализации на един и същи алгоритъм по отношение на ефективност?

## 2. Overview
Профилирането и бенчмаркингът са ключови техники за анализ и оптимизация на софтуерни системи, включително AI приложения. Профилирането се фокусира върху събирането на данни за изпълнението на програмата – като време за изпълнение, използване на памет и други ресурси – с цел идентифициране на „тесни места“ (bottlenecks). Бенчмаркингът, от своя страна, служи за систематично сравнение на производителността между различни реализации, алгоритми или хардуерни конфигурации.

Тези процеси са критични при разработката на сложни системи, където оптималната производителност може да доведе до значително подобрение в скоростта, мащабируемостта и ефективността на ресурсите. В контекста на AI, където обработката на големи обеми данни и сложни модели е норма, профилирането и бенчмаркингът помагат да се гарантира, че системата работи максимално ефективно и отговаря на изискванията за време и ресурси.

## 3. Key Concepts
- **Профилиране (Profiling)** – процес на измерване и анализ на времето и ресурсите, използвани от различни части на софтуерна програма. Може да се сравни с медицински преглед, който открива къде тялото има проблеми.
- **Бенчмаркинг (Benchmarking)** – систематично тестване и сравняване на производителността на различни системи или алгоритми чрез стандартизирани тестове, подобно на състезание между автомобили по определена писта.
- **Тесно място (Bottleneck)** – част от кода или системата, която ограничава цялостната производителност, като най-тясната част на бутилка, която ограничава потока.
- **Време за изпълнение (Execution Time)** – времето, необходимо за изпълнение на дадена задача или програма.
- **Паметна консумация (Memory Usage)** – количеството оперативна памет, използвана от програмата по време на изпълнение.
- **Инструменти за профилиране (Profilers)** – софтуерни средства, които автоматично събират и визуализират данни за изпълнението на програмата, например gprof, Valgrind, или профайлъри в IDE-та.
- **Микробенчмаркове (Microbenchmarks)** – кратки тестове, измерващи производителността на отделни функции или операции, като измерване на скоростта на конкретна математика или I/O операция.

## 4. Step-by-step Learning Path
1. **Запознаване с основите на профилирането**
   - Фокус: Разберете какво измерва профилирането и защо.
   - Задача: Използвайте базов профайлър (например Python cProfile) върху прост скрипт.
   - Въпроси: Какво е времето за изпълнение? Как профилирането помага да се открие тесно място?

2. **Изучаване на различни видове профилиране**
   - Фокус: Научете разликата между CPU профилиране, паметно профилиране и I/O профилиране.
   - Задача: Профилирайте програма, която използва много памет, и анализирайте резултатите.
   - Въпроси: Как паметното профилиране се различава от CPU профилирането?

3. **Въвеждане в бенчмаркинга**
   - Фокус: Разберете как да създавате и изпълнявате бенчмаркове.
   - Задача: Напишете микробенчмарк за функция, която сортира списък.
   - Въпроси: Какво е микробенчмарк? Защо е важно да имаме стандартизирани тестове?

4. **Интерпретиране на резултати и оптимизация**
   - Фокус: Научете как да използвате данните от профилирането и бенчмаркинга за подобрение.
   - Задача: Оптимизирайте функцията от предишната стъпка и сравнете резултатите.
   - Въпроси: Как разпознавате дали оптимизацията е успешна? Какво е trade-off между време и памет?

5. **Профилиране и бенчмаркинг в AI системи**
   - Фокус: Разгледайте специфични инструменти и техники за AI (например TensorBoard, NVIDIA Nsight).
   - Задача: Профилирайте обучение на прост невронен модел и анализирайте времето за различни етапи.
   - Въпроси: Кои части на AI pipeline са най-често тесни места? Какво е значението на хардуерната оптимизация?

## 5. Examples
### Пример 1: Профилиране на Python функция с cProfile
```python
import cProfile

def compute():
    total = 0
    for i in range(100000):
        total += i*i
    return total

cProfile.run('compute()')
```
Този код показва базово CPU профилиране, което измерва колко време отнема функцията `compute`.

### Пример 2: Микробенчмарк на сортиране с timeit
```python
import timeit

setup = "from random import randint; data = [randint(1, 1000) for _ in range(1000)]"
stmt = "sorted(data)"

print(timeit.timeit(stmt, setup=setup, number=100))
```
Тук измерваме колко време отнема сортирането на списък с 1000 елемента, изпълнено 100 пъти.

### Пример 3: Профилиране на TensorFlow модел с TensorBoard
```python
import tensorflow as tf
from tensorflow.keras import layers

model = tf.keras.Sequential([
    layers.Dense(128, activation='relu'),
    layers.Dense(10)
])

model.compile(optimizer='adam', loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True))

log_dir = "logs/profile"
tensorboard_callback = tf.keras.callbacks.TensorBoard(log_dir=log_dir, profile_batch='5,10')

# Трениране с профилиране
model.fit(x_train, y_train, epochs=3, callbacks=[tensorboard_callback])
```
Този пример показва как да използваме TensorBoard за профилиране на тренировъчния процес.

## 6. Common Pitfalls
- **Игнориране на реални условия при бенчмаркинг** – тестовете трябва да отразяват реални сценарии, а не само синтетични.
- **Профилиране без повторения** – еднократни измервания могат да бъдат подвеждащи поради системни колебания.
- **Оптимизация на грешното място** – без правилен профил, може да се фокусирате върху части от кода, които не са тесни места.
- **Прекомерно профилиране** – профилирането може да забави програмата и да повлияе на резултатите, затова трябва да се използва разумно.
- **Неправилна интерпретация на данните** – важно е да се разбере какво точно измерва инструментът и как да се анализират резултатите.

## 7. Short Retrieval Quiz
1. Каква е основната цел на профилирането?
2. Какво представлява тесно място (bottleneck) в софтуерна система?
3. Как се различава бенчмаркингът от профилирането?
4. Кога е полезно да използваме микробенчмаркове?
5. Какви са основните видове ресурси, които се измерват при профилиране?
6. Защо е важно да се изпълняват бенчмаркове в реални условия?
7. Какви инструменти бихте използвали за профилиране на AI модели?

## 8. Quick Recap
- Профилирането измерва изпълнението на софтуер, за да открие тесни места.
- Бенчмаркингът сравнява производителността на различни реализации чрез стандартизирани тестове.
- Тесните места ограничават цялостната ефективност и трябва да се идентифицират чрез профилиране.
- Микробенчмарковете са полезни за измерване на отделни функции или операции.
- В AI системите профилирането помага да се оптимизират сложни модели и хардуерна употреба.
- Правилното интерпретиране на резултатите е ключово за успешна оптимизация.
- Избягвайте често срещани грешки като профилиране без повторения и оптимизация без данни.

## 9. Spaced Review Plan

| Време след учене | Промпт за преглед                                      |
|-------------------|-------------------------------------------------------|
| 1 ден             | Какво е профилиране и как помага за оптимизацията?   |
| 3 дни             | Обяснете разликата между профилиране и бенчмаркинг.  |
| 1 седмица         | Опишете процеса за идентифициране на тесно място.    |
| 1 месец           | Дайте пример за използване на профилиране в AI система. |