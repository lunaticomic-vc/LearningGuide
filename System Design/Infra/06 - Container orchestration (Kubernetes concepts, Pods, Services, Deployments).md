# 06 - Container orchestration (Kubernetes concepts, Pods, Services, Deployments)

## 1. Activate Prior Knowledge

- Кога и защо бихте използвали контейнери вместо виртуални машини при разработка или внедряване на софтуерни системи?
- Какви предизвикателства възникват при управлението на множество контейнери в големи AI или уеб приложения?
- Можете ли да си представите какво би се случило, ако един контейнер спре да работи в продукционна среда? Как бихте го управлявали автоматично?

---

## 2. Overview

Контейнерната оркестрация е ключова технология за автоматизирано управление на големи количества контейнери в съвременните софтуерни системи. Kubernetes е водещата платформа, която позволява автоматично разполагане, скалиране и управление на контейнеризирани приложения. Тя решава проблеми като автоматично възстановяване при грешки, баланс на натоварването и лесно обновяване на приложенията.

В контекста на AI системи и мащабни уеб услуги, Kubernetes позволява надеждно и ефективно използване на изчислителните ресурси, като гарантира, че приложенията са винаги достъпни и могат да се разширяват според нуждите. Чрез абстракции като Pods, Services и Deployments, Kubernetes улеснява живота на инженерите, като автоматизира рутинните задачи и осигурява стабилна инфраструктура.

Контейнерната оркестрация не е само за големи компании – тя е приложима навсякъде, където има нужда от надеждност, автоматизация и лесно управление на софтуерни услуги. Разбирането на тези концепции е фундаментално за всеки модерен софтуерен инженер.

---

## 3. Key Concepts

- **Kubernetes** – Платформа с отворен код за автоматизация на разполагането, скалирането и управлението на контейнеризирани приложения. Мислете за него като за „операционна система“ за клъстери от сървъри.
- **Pod** – Най-малката единица за разполагане в Kubernetes; представлява един или повече контейнера, които споделят мрежа и сторидж. Представете си Pod като „кутия“, в която работят един или повече тясно свързани контейнера.
- **Service** – Абстракция, която осигурява стабилен мрежов адрес и достъп до един или повече Pods, независимо от техните динамични IP адреси. Подобно на телефонен номер, който винаги ви свързва с правилния човек, дори ако той смени телефона си.
- **Deployment** – Декларативен начин за управление на множество идентични Pods, включително автоматично обновяване и възстановяване. Мислете за него като за „мениджър“, който следи винаги да има точно определен брой работещи копия на вашето приложение.
- **Cluster** – Група от машини (nodes), които работят заедно под управлението на Kubernetes.
- **Node** – Една физическа или виртуална машина в Kubernetes клъстера, на която се изпълняват Pods.
- **ReplicaSet** – Компонент, който гарантира, че определен брой идентични Pods са винаги налични.

---

## 4. Step-by-step Learning Path

1. **Разберете основите на контейнерите и Kubernetes**
   - Фокус: Какво е контейнер? Какво прави Kubernetes?
   - Практическа задача: Стартирайте един контейнер с Docker на вашата машина.
   - Retrieval: Каква е разликата между контейнер и виртуална машина? Каква е основната роля на Kubernetes?

2. **Създайте и управлявайте Pod**
   - Фокус: Какво представлява Pod и как се описва с YAML?
   - Практическа задача: Напишете и приложете прост Pod манифест с `kubectl apply -f`.
   - Retrieval: Какво съдържа Pod? Може ли Pod да съдържа повече от един контейнер?

3. **Използвайте Service за достъп до Pod**
   - Фокус: Как работи Service и защо е необходим?
   - Практическа задача: Създайте Service, който експонира вашия Pod.
   - Retrieval: Как Service намира Pods? Какво се случва, ако Pod умре и се създаде нов?

4. **Автоматизирайте управлението с Deployment**
   - Фокус: Какво е Deployment и как автоматизира обновяването и скалирането?
   - Практическа задача: Дефинирайте Deployment, който управлява няколко реплики на вашия Pod.
   - Retrieval: Как Deployment се различава от Pod? Как се прави rolling update?

5. **Наблюдавайте и скалирайте**
   - Фокус: Как да следите състоянието и да скалирате приложенията?
   - Практическа задача: Използвайте `kubectl get`, `kubectl scale` и `kubectl describe` за наблюдение и скалиране.
   - Retrieval: Как да видите логовете на Pod? Как да увеличите броя на репликите?

---

## 5. Examples

### Пример 1: Създаване на Pod

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: hello-world-pod
spec:
  containers:
    - name: hello
      image: busybox
      command: ['echo', 'Hello, Kubernetes!']
```

### Пример 2: Service за достъп до Pod

```yaml
apiVersion: v1
kind: Service
metadata:
  name: hello-service
spec:
  selector:
    app: hello
  ports:
    - protocol: TCP
      port: 80
      targetPort: 8080
```

### Пример 3: Deployment с 3 реплики

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: hello-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      app: hello
  template:
    metadata:
      labels:
        app: hello
    spec:
      containers:
        - name: hello
          image: busybox
          command: ['echo', 'Hello from Deployment!']
```

---

## 6. Common Pitfalls

- **Забравяне на selector в Service** – Ако selector-ът не съвпада с labels на Pods, Service няма да работи.
- **Редактиране на Pod директно** – Промените няма да се запазят при рестартиране; използвайте Deployment за трайно управление.
- **Неяснота относно rolling updates** – Обновяването на контейнерен имидж директно в Pod не води до автоматично обновяване на всички копия; използвайте Deployment.
- **Пренебрегване на ресурсни лимити** – Липсата на resource requests/limits може да доведе до претоварване на Node.
- **Неправилно мащабиране** – Ръчното създаване на множество Pods без Deployment затруднява управлението и обновяването.

---

## 7. Short Retrieval Quiz

1. Какво е Pod и каква е неговата роля в Kubernetes?
2. Защо е необходим Service и какво осигурява?
3. Каква е разликата между Deployment и Pod?
4. Какво се случва, ако Pod спре да работи в рамките на Deployment?
5. Как се осъществява достъп до приложение, работещо в Pod, от външния свят?
6. Какво е rolling update и как се реализира в Kubernetes?
7. Каква е ролята на ReplicaSet?

---

## 8. Quick Recap

- Kubernetes автоматизира управлението на множество контейнери в клъстери.
- Pod е основната единица за разполагане и съдържа един или повече контейнера.
- Service осигурява стабилен достъп до Pods, независимо от техните IP адреси.
- Deployment управлява множество Pods, позволява скалиране и автоматично обновяване.
- ReplicaSet гарантира, че винаги има определен брой идентични Pods.
- YAML манифестите описват ресурсите в Kubernetes по декларативен начин.
- Правилното използване на тези абстракции улеснява надеждното и мащабируемо внедряване на приложения.

---

## 9. Spaced Review Plan

| Време      | Преговори/Въпроси                                  |
|------------|----------------------------------------------------|
| 1 ден      | Опишете разликата между Pod, Service и Deployment. |
| 3 дни      | Създайте Deployment и Service за тестово приложение.|
| 1 седмица  | Обяснете rolling update и как се наблюдава статусът на Pods. |
| 1 месец    | Дискутирайте как Kubernetes решава проблеми с надеждността и скалирането. |
