# 20 - Testing strategies unit integration mock-based property-based

## 1. Activate Prior Knowledge

- Какви видове тестове сте използвали досега при разработката на софтуер или AI системи? Можете ли да дадете примери?
- Как бихте обяснили разликата между unit тест и integration тест на колега?
- Кога според вас е полезно да използваме моки (mock objects) или property-based testing?

## 2. Overview

Тестването е фундаментален процес в разработката на надежден софтуер, особено при сложни системи като тези, използвани в изкуствения интелект. Различните стратегии за тестване — unit, integration, mock-based и property-based — имат различни цели и обхват, като всяка допринася за гарантиране на коректността и устойчивостта на системата.

Unit тестването се фокусира върху отделни компоненти или функции, като ги изолира от останалата част на системата. Integration тестването проверява как тези компоненти работят заедно. Mock-based тестването използва заместители на реални обекти, за да се изолират зависимости и да се симулират различни сценарии. Property-based тестването проверява дали системата удовлетворява определени свойства за широк набор от входни данни, вместо да се тества само с конкретни примери.

Тези подходи са критични за откриване на грешки рано, за предотвратяване на регресии и за осигуряване на устойчивост при промени в кода. В AI системите, където поведението може да е сложно и непредсказуемо, правилната комбинация от тези стратегии е особено важна.

## 3. Key Concepts

- Unit Test – Тест, който проверява малка, изолирана част от кода (например функция или клас). Мислете за това като за проверка на отделна тухла преди да построите цяла стена.
- Integration Test – Тест, който проверява взаимодействието между няколко компонента или модула. Това е като да проверите дали тухлите са добре подредени и стената е стабилна.
- Mock (Mock Object) – Фалшив обект, който имитира поведението на реална зависимост, за да изолирате тествания компонент. Представете си го като актьор, който играе роля, за да видите как реагира главният герой.
- Property-based Testing – Стратегия, при която се дефинират свойства (инварианти), които трябва да са верни за всички валидни входни данни. Вместо да пишете конкретни тестови случаи, описвате какво винаги трябва да е вярно.
- Test Isolation – Принцип, според който всеки тест трябва да бъде независим от останалите, за да се гарантира надеждност и лесна диагностика на проблеми.
- Test Coverage – Мярка за това каква част от кода се изпълнява по време на тестовете. По-високото покритие обикновено означава по-малък шанс за скрити грешки.

## 4. Step-by-step Learning Path

1. **Разберете разликата между unit и integration тестове**
   - Фокус: Прочетете документация или статия по темата.
   - Практическа задача: Идентифицирайте в текущ проект кои тестове са unit и кои – integration.
   - Въпроси: Какво е основното предимство на unit тестовете? Кога integration тестовете са по-подходящи?

2. **Създайте unit тест за проста функция**
   - Фокус: Изберете функция с ясни входове и изходи.
   - Практическа задача: Напишете unit тест, който проверява няколко гранични случая.
   - Въпроси: Какво би се случило, ако функцията има странични ефекти? Как бихте ги изолирали?

3. **Използвайте mock обекти за изолиране на зависимости**
   - Фокус: Научете как да създавате и използвате mock обекти с избрана библиотека (например unittest.mock в Python).
   - Практическа задача: Заменете реална зависимост с mock във ваш unit тест.
   - Въпроси: Какво печелите от използването на mock? Какви рискове крие прекомерната употреба?

4. **Създайте integration тест между два компонента**
   - Фокус: Изберете два или повече взаимодействащи модула.
   - Практическа задача: Напишете integration тест, който проверява реалната им комуникация.
   - Въпроси: Какви грешки могат да се открият само с integration тестове? Какви са предизвикателствата при поддръжката им?

5. **Изследвайте property-based testing**
   - Фокус: Запознайте се с библиотека като Hypothesis (Python) или fast-check (JavaScript).
   - Практическа задача: Дефинирайте свойство за функция и напишете property-based тест.
   - Въпроси: Как property-based тестовете откриват неочаквани грешки? За кои типове функции са най-полезни?

## 5. Examples

### Пример 1: Unit тест с Python

```python
def add(a, b):
    return a + b

def test_add():
    assert add(2, 3) == 5
    assert add(-1, 1) == 0
```

### Пример 2: Mock-based тест

```python
from unittest.mock import Mock

def fetch_data(api_client):
    return api_client.get_data()

def test_fetch_data():
    mock_client = Mock()
    mock_client.get_data.return_value = {'result': 42}
    assert fetch_data(mock_client) == {'result': 42}
```

### Пример 3: Property-based тест с Hypothesis

```python
from hypothesis import given
import hypothesis.strategies as st

def reverse_twice(s):
    return s[::-1][::-1]

@given(st.text())
def test_reverse_twice(s):
    assert reverse_twice(s) == s
```

## 6. Common Pitfalls

- Смесване на unit и integration тестове, което затруднява диагностицирането на грешки.
- Прекомерна употреба на mock обекти, което може да доведе до тестове, които не отразяват реалното поведение на системата.
- Липса на тестова изолация – тестове, които зависят от състоянието, оставено от други тестове.
- Недостатъчно property-based тестове за функции с широк диапазон от входни данни – така се пропускат гранични случаи.
- Пренебрегване на поддръжката на тестовете – остарели тестове могат да създадат фалшиво усещане за сигурност.

## 7. Short Retrieval Quiz

1. Каква е основната разлика между unit и integration тест?
2. Защо използваме mock обекти при тестване?
3. Какво е property-based testing и кога е особено полезно?
4. Какво означава test isolation и защо е важно?
5. Какво измерва test coverage?
6. Какви грешки могат да се открият само с integration тестове?
7. Дайте пример за свойство, което може да се тества с property-based testing.

## 8. Quick Recap

- Unit тестовете изолират и проверяват отделни компоненти.
- Integration тестовете валидират взаимодействието между модули.
- Mock обектите позволяват изолиране на зависимости и симулация на сценарии.
- Property-based тестовете проверяват инварианти за широк набор от входове.
- Test isolation гарантира надеждност и лесна диагностика.
- Високото test coverage намалява риска от скрити грешки.
- Комбинирането на различни стратегии осигурява по-устойчива и надеждна система.

## 9. Spaced Review Plan

| Време     | Преговори/Въпроси                                          |
|-----------|------------------------------------------------------------|
| 1 ден     | Опишете разликата между unit и integration тест.            |
| 3 дни     | Дайте пример за mock-based тест и property-based тест.      |
| 1 седмица | Обяснете защо test isolation е важен и как се постига.      |
| 1 месец   | Анализирайте често срещани грешки при тестване и решения.   |