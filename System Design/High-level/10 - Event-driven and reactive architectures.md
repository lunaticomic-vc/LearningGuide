# 10 - Event-driven and reactive architectures

## 1. Activate Prior Knowledge

- Какви са основните разлики между синхронна и асинхронна обработка на събития в софтуерните системи?
- Можете ли да дадете пример от реалния живот, където системата реагира на събития, вместо да работи по предварително зададен ред?
- Какви предизвикателства възникват при мащабиране на традиционни монолитни приложения и как мислите, че събитийно-ориентираните архитектури могат да помогнат?

## 2. Overview

Event-driven и reactive архитектурите са подходи за проектиране на софтуерни системи, които се фокусират върху реакция на събития в реално време, вместо на последователно изпълнение на команди. В тези архитектури компонентите комуникират чрез изпращане и получаване на съобщения или събития, което позволява по-гъвкаво, мащабируемо и устойчиво поведение.

Този подход е особено ценен при изграждане на сложни, разпределени системи, като микросервизни архитектури, IoT платформи или AI системи, които трябва да обработват голям обем от входящи данни или заявки. Event-driven архитектурите позволяват отделните компоненти да бъдат слабо свързани и лесно заменяеми, което улеснява поддръжката и развитието на системата.

Reactive архитектурите надграждат този модел, като поставят акцент върху реактивност, устойчивост, еластичност и съобщителност. Те са проектирани така, че да се адаптират към променящи се натоварвания и да продължат да функционират дори при частични откази.

В контекста на AI системи, тези архитектури позволяват обработка на потоци от данни, реакция на събития в реално време (напр. обработка на сензорни данни или потребителски действия) и лесно интегриране на нови функционалности.

## 3. Key Concepts

- Event – Събитие е всяко значимо действие или промяна в системата (напр. нова заявка, промяна в база данни, пристигане на съобщение). Може да се мисли като "сигнал", който казва: "Нещо се случи!"
- Event Producer – Компонент, който създава и изпраща събития. Например, уеб приложение, което изпраща събитие при нова поръчка.
- Event Consumer – Компонент, който получава и обработва събития. Например, услуга, която изпраща имейл при нова регистрация.
- Message Broker – Система, която посредничи между producer-и и consumer-и, като съхранява и разпределя събития (напр. Apache Kafka, RabbitMQ).
- Reactive Manifesto – Документ, който дефинира принципите на реактивните системи: responsive, resilient, elastic, message-driven.
- Backpressure – Механизъм за контрол на натоварването, при който системата сигнализира, че не може да обработва повече събития в момента.
- Loose Coupling – Слаба свързаност между компонентите, което ги прави по-лесни за подмяна и развитие. Може да се сравни с хора, които комуникират чрез бележки, вместо с постоянен разговор.

## 4. Step-by-step Learning Path

1. **Разберете основите на събитийно-ориентираните системи**
   - Фокус: Какво е събитие и как се използва в софтуерните архитектури.
   - Задача: Опишете с думи или диаграма какво се случва, когато потребител прави поръчка в онлайн магазин, използващ event-driven архитектура.
   - Въпроси: Какво е събитие? Какви роли имат producer и consumer?

2. **Изследвайте message broker-и**
   - Фокус: Как работят системи като Kafka или RabbitMQ.
   - Задача: Инсталирайте локално RabbitMQ и изпратете тестово съобщение от един producer към един consumer.
   - Въпроси: Каква е ролята на message broker-а? Какви са предимствата му?

3. **Запознайте се с реактивните принципи**
   - Фокус: Принципите на Reactive Manifesto.
   - Задача: Прочетете и обобщете с 2 изречения всяка от четирите основни характеристики (responsive, resilient, elastic, message-driven).
   - Въпроси: Какво означава една система да е resilient? Как се постига elastic behavior?

4. **Създайте малко event-driven приложение**
   - Фокус: Практическа реализация на event-driven архитектура.
   - Задача: Напишете малко приложение (например на Python), което реагира на нови събития (напр. нови файлове в директория).
   - Въпроси: Какви са предимствата на този подход? Какво би се случило при отказ на един от компонентите?

5. **Анализирайте реални сценарии и оптимизирайте**
   - Фокус: Идентифициране на потенциални проблеми (backpressure, загуба на събития).
   - Задача: Симулирайте ситуация, в която consumer не може да обработва всички събития и приложете backpressure.
   - Въпроси: Как се справяте с претоварване? Какви са рисковете при загуба на събития?

## 5. Examples

### Пример 1: Обработка на поръчки в онлайн магазин

Когато клиент направи поръчка, системата изпраща "OrderPlaced" събитие към message broker. Различни услуги (inventory, billing, notification) получават това събитие и реагират независимо.

### Пример 2: Реактивен стрийминг на данни

```python
import rx

def print_event(x):
    print(f"Получено събитие: {x}")

source = rx.from_iterable([1, 2, 3, 4])
source.subscribe(print_event)
```

### Пример 3: IoT сензори

Сензорите изпращат събития за температура към централен сървър. Сървърът обработва само тези, които надвишават определен праг, и изпраща аларма.

## 6. Common Pitfalls

- **Липса на гаранция за доставка на събития** – Ако не се използва подходящ message broker или не се конфигурира правилно, събития може да се загубят.
- **Твърде силна свързаност между компонентите** – Ако consumer-ите зависят от конкретни producer-и, системата губи гъвкавост.
- **Пренебрегване на backpressure** – Ако не се управлява натоварването, някои компоненти може да се претоварят и да спрат да работят.
- **Недостатъчно логване и мониторинг** – Трудно е да се откриват проблеми без добра видимост върху потока на събитията.

## 7. Short Retrieval Quiz

1. Какво е event-driven архитектура?
2. Каква е ролята на message broker-а?
3. Какво означава "backpressure" и защо е важен?
4. Какви са четирите основни принципа на реактивните системи?
5. Какви са предимствата на loose coupling?
6. Дайте пример за реален случай, където event-driven архитектура е подходяща.
7. Какви рискове има при загуба на събития?

## 8. Quick Recap

- Event-driven архитектурите позволяват реакция на събития в реално време чрез слабо свързани компоненти.
- Message broker-ите посредничат между producer-и и consumer-и, осигурявайки надеждна доставка на събития.
- Reactive архитектурите надграждат event-driven подхода с фокус върху устойчивост, еластичност и реактивност.
- Backpressure е ключов механизъм за управление на натоварването и предотвратяване на претоварване.
- Loose coupling улеснява поддръжката и развитието на системата.
- Типични приложения включват онлайн магазини, IoT платформи и AI системи за обработка на потоци от данни.
- Основните рискове са загуба на събития, претоварване и трудна диагностика без добър мониторинг.

## 9. Spaced Review Plan

| Кога    | Преговори с фокус върху:                                   |
|---------|------------------------------------------------------------|
| 1 ден   | Основни понятия и примери за event-driven архитектури      |
| 3 дни   | Принципи на реактивните системи и реални сценарии          |
| 1 седмица | Практически задачи и анализ на често срещани грешки      |
| 1 месец | Свързване с други архитектурни модели и дълбоко разбиране  |