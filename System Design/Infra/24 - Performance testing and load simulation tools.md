# 24 - Performance testing and load simulation tools

## 1. Activate Prior Knowledge

- Как бихте определили разликата между функционално и нефункционално тестване в контекста на софтуерните системи?
- Кога за последно сте използвали или чували за инструменти като JMeter, Locust или Gatling? Каква беше тяхната цел?
- Защо е важно да се симулира реалистично натоварване върху AI системи или уеб приложения преди пускане в продукция?

## 2. Overview

Performance testing и load simulation tools са критични компоненти в процеса на разработка и поддръжка на софтуерни системи, особено когато става дума за мащабируеми уеб приложения или AI системи. Тези инструменти позволяват на инженерите да измерят как дадена система реагира на различни нива на натоварване, като симулират множество едновременни потребители или заявки.

Основната цел е да се идентифицират потенциални "тесни места" (bottlenecks), да се провери стабилността и надеждността на системата при високо натоварване и да се гарантира, че тя може да отговори на очакваните изисквания за производителност. Това е особено важно при AI системи, където латентността и капацитетът за обработка могат да повлияят директно на крайния потребител.

Performance testing се вписва в по-широката рамка на нефункционалното тестване, заедно със сигурността, използваемостта и други аспекти, които не са свързани с конкретна функционалност, а с качеството на услугата. Без адекватно тестване под натоварване, дори най-добре проектираните системи могат да се провалят при реална употреба.

## 3. Key Concepts

- **Performance testing** – Процесът на измерване на скоростта, отзивчивостта и стабилността на дадена система при различни условия на натоварване.
- **Load simulation** – Симулация на множество едновременни потребители или заявки, за да се провери как системата се държи при реалистични или екстремни условия.
- **Throughput (пропускателна способност)** – Количеството обработени заявки или данни за единица време; мислете за това като за "широчината на магистрала".
- **Latency (латентност)** – Времето, което е необходимо за обработка на една заявка; аналогично на времето за доставка на писмо.
- **Scalability (мащабируемост)** – Способността на системата да поддържа или увеличава производителността си при увеличаване на натоварването.
- **Bottleneck (тясно място)** – Компонент или процес, който ограничава цялостната производителност, подобно на стеснение на пътя.
- **Stress testing** – Тестване на системата при екстремни или наднормени натоварвания, за да се види къде и как ще откаже.
- **Soak testing** – Продължително натоварване на системата, за да се открият проблеми, които се проявяват само след дълга работа (например memory leaks).

## 4. Step-by-step Learning Path

1. **Разберете целите на performance testing**
   - Фокус: Различни видове performance testing (load, stress, soak).
   - Практическа задача: Направете кратко резюме на разликите между тях.
   - Въпроси: Каква е разликата между load и stress testing? Кога бихте използвали soak testing?

2. **Запознайте се с популярни инструменти**
   - Фокус: JMeter, Locust, Gatling, k6.
   - Практическа задача: Инсталирайте един от инструментите и стартирайте примерен тест.
   - Въпроси: Какви са предимствата на JMeter спрямо Locust? Какъв език се използва за скриптове в Gatling?

3. **Създайте прост тест за натоварване**
   - Фокус: Дефиниране на сценарии и симулиране на потребители.
   - Практическа задача: Създайте тест, който изпраща 100 едновременни заявки към тестов сървър.
   - Въпроси: Как се дефинира броят на виртуалните потребители? Какви метрики се събират по време на теста?

4. **Анализирайте резултатите**
   - Фокус: Интерпретиране на метрики като latency, throughput, error rate.
   - Практическа задача: Извлечете и визуализирайте резултатите от теста.
   - Въпроси: Какво означава висока латентност? Как се откриват bottlenecks?

5. **Оптимизирайте и повторете**
   - Фокус: Идентифициране и отстраняване на проблеми, повторно тестване.
   - Практическа задача: Направете промяна в системата (например увеличете броя на нишките) и повторете теста.
   - Въпроси: Какви подобрения наблюдавате? Как се валидира ефективността на оптимизацията?

## 5. Examples

### Пример 1: JMeter тест за REST API

```xml
<ThreadGroup>
  <num_threads>50</num_threads>
  <ramp_time>10</ramp_time>
  <HTTPSamplerProxy>
    <domain>api.example.com</domain>
    <path>/v1/resource</path>
    <method>GET</method>
  </HTTPSamplerProxy>
</ThreadGroup>
```
*Този тест симулира 50 едновременни потребителя, които изпращат заявки към API.*

### Пример 2: Locust скрипт за уеб приложение

```python
from locust import HttpUser, task

class WebsiteUser(HttpUser):
    @task
    def index(self):
        self.client.get("/")
```
*Този скрипт дефинира виртуален потребител, който посещава началната страница.*

### Пример 3: Анализ на резултати

След тест с 200 виртуални потребителя, метриките показват:
- Средна латентност: 350ms
- Throughput: 1200 заявки/секунда
- Error rate: 0.5%

*Извод: Системата се справя добре, но латентността може да се подобри.*

## 6. Common Pitfalls

- **Недостатъчно реалистични сценарии** – Симулирането на нереалистично поведение води до подвеждащи резултати. Използвайте реални user journeys.
- **Пренебрегване на анализ на резултатите** – Не е достатъчно само да стартирате теста; анализирайте метриките и логовете.
- **Липса на мониторинг на инфраструктурата** – Без наблюдение на CPU, памет и мрежа може да пропуснете критични bottlenecks.
- **Тестване само на една компонента** – Тествайте цялостната система, включително бази данни и външни услуги.
- **Прекалено кратки тестове** – Кратките тестове не откриват проблеми, които се проявяват при продължителна работа (memory leaks, resource exhaustion).

## 7. Short Retrieval Quiz

1. Каква е основната цел на performance testing?
2. Какво измерва latency и защо е важно?
3. Каква е разликата между load и stress testing?
4. Кой инструмент използва Python за дефиниране на тестови сценарии?
5. Какво е bottleneck и как влияе на системата?
6. Защо е важно да се тестват реалистични сценарии?
7. Какви метрики са ключови при анализ на резултатите от натоварване?

## 8. Quick Recap

- Performance testing оценява скоростта, стабилността и капацитета на софтуерни системи.
- Load simulation tools като JMeter, Locust и Gatling симулират едновременни потребители.
- Ключови метрики са latency, throughput, error rate.
- Bottlenecks ограничават производителността и трябва да се идентифицират и отстраняват.
- Реалистичните сценарии и анализът на резултатите са критични за успеха на теста.
- Инструментите позволяват автоматизация и повторяемост на тестовете.
- Performance testing е част от цялостното качество на софтуера.

## 9. Spaced Review Plan

| Време     | Преговори/Фокусирани въпроси                                      |
|-----------|-------------------------------------------------------------------|
| 1 ден     | Опишете разликата между load и stress testing.                    |
| 3 дни     | Какви са основните метрики при performance testing?               |
| 1 седмица | Дайте пример за анализ на резултати от натоварващ тест.           |
| 1 месец   | Как бихте интегрирали performance testing в CI/CD процес?         |