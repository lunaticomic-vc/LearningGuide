# 27 - Database observability and monitoring tools

## 1. Activate Prior Knowledge

- Какви проблеми могат да възникнат, ако една база данни работи бавно или непредсказуемо в AI система?
- Какви инструменти или подходи сте използвали досега за мониторинг на софтуерни приложения?
- Можете ли да си представите какво би означавало “наблюдаемост” (observability) за база данни и защо е важна?

## 2. Overview

Database observability и monitoring tools са ключови за поддържането на надеждни, бързи и сигурни бази данни, особено в сложни AI системи или мащабни софтуерни решения. Докато мониторингът проследява основни метрики като натоварване, използване на ресурси и грешки, наблюдаемостта предоставя по-дълбоко разбиране за вътрешното състояние на системата чрез събиране и анализ на логове, метрики и трасета.

Тези инструменти позволяват на инженерите да откриват, диагностицират и разрешават проблеми проактивно, често преди те да засегнат крайния потребител. В контекста на AI системи, където данните са критични, добрата наблюдаемост гарантира, че моделите работят върху коректни и актуални данни.

В по-широк план, наблюдаемостта и мониторингът са част от DevOps и SRE практиките, които целят да осигурят висока наличност, производителност и сигурност на инфраструктурата.

## 3. Key Concepts

- Observability (Наблюдаемост) – Способността да се разбере вътрешното състояние на системата само чрез външни изходи (метрики, логове, трасета). Мислете за това като за “рентген” на вашата база данни.
- Monitoring (Мониторинг) – Процесът на непрекъснато събиране и анализ на данни за състоянието и производителността на системата. Подобно на таблото на автомобил, което показва скорост, гориво и температура.
- Metrics (Метрики) – Квантитативни измервания като брой заявки в секунда, време за отговор, използване на CPU и RAM.
- Logs (Логове) – Текстови записи на събития, грешки и операции, които се случват в базата данни.
- Traces (Трасета) – Данни, които проследяват изпълнението на заявки или транзакции през различни компоненти на системата.
- Alerting (Известяване) – Автоматично уведомяване при настъпване на определени събития или аномалии.
- Dashboards (Табла за управление) – Визуални интерфейси за наблюдение на метрики и състояние в реално време.

## 4. Step-by-step Learning Path

1. **Разберете основните метрики на базата данни**
   - Фокус: Какви са най-важните метрики за вашата база данни (напр. latency, throughput, errors)?
   - Задача: Избройте 5 ключови метрики за база данни по ваш избор.
   - Въпроси: Какво означава “latency” при заявка? Защо е важно да следим броя на грешките?

2. **Настройте базов мониторинг**
   - Фокус: Инсталиране и конфигуриране на инструмент като Prometheus или Zabbix.
   - Задача: Инсталирайте Prometheus и съберете първите си метрики от тестова база данни.
   - Въпроси: Как се добавя нов източник на метрики в Prometheus? Как се визуализира метрика?

3. **Анализирайте логове и трасета**
   - Фокус: Събиране и анализ на логове с помощта на инструменти като ELK stack или Grafana Loki.
   - Задача: Настройте събиране на логове от база данни и открийте поне една аномалия или грешка.
   - Въпроси: Каква е разликата между лог и метрика? Какво може да научите от трасетата?

4. **Конфигурирайте alerting**
   - Фокус: Създаване на автоматични известия при определени условия.
   - Задача: Настройте alert за високо време за отговор или недостиг на дисково пространство.
   - Въпроси: Какви са рисковете при липса на alerting? Как да избегнете “alert fatigue”?

5. **Изградете dashboard за наблюдение**
   - Фокус: Визуализация на ключови метрики и състояния.
   - Задача: Създайте dashboard в Grafana, което показва latency, throughput и броя на грешките.
   - Въпроси: Кои визуализации са най-полезни за бърза диагностика? Какво бихте добавили към dashboard-а?

## 5. Examples

### Пример 1: Мониторинг на PostgreSQL с Prometheus и Grafana

```yaml
# prometheus.yml
scrape_configs:
  - job_name: 'postgres'
    static_configs:
      - targets: ['localhost:9187']
```
- Инсталирате PostgreSQL exporter, настройвате Prometheus да събира метрики и ги визуализирате в Grafana.

### Пример 2: Известяване при високо време за отговор

```yaml
# Alert rule в Prometheus
- alert: HighQueryLatency
  expr: avg_over_time(pg_stat_activity_query_duration_seconds[5m]) > 1
  for: 5m
  labels:
    severity: warning
  annotations:
    summary: "Високо време за отговор на заявки към базата данни"
```

### Пример 3: Анализ на логове с ELK Stack

- Събирате логове от MySQL, изпращате ги към Logstash, индексирате в Elasticsearch и визуализирате в Kibana, за да откриете неуспешни заявки или аномалии.

## 6. Common Pitfalls

- **Пренебрегване на наблюдаемостта** – Често се разчита само на мониторинг, без да се анализират логове и трасета, което затруднява диагностицирането на сложни проблеми.
- **Твърде много или твърде малко alert-и** – Липсата на alerts води до пропуснати инциденти, а прекалено много – до “alert fatigue” и игнориране на важни сигнали.
- **Неоптимизирани dashboards** – Претрупани или лошо структурирани табла затрудняват бързата реакция.
- **Липса на исторически данни** – Без достатъчно история е трудно да се анализират тенденции или да се откриват бавни деградации.

## 7. Short Retrieval Quiz

1. Каква е разликата между monitoring и observability?
2. Избройте три ключови метрики за база данни.
3. Какво е трасета (traces) и кога са полезни?
4. Защо е важно да се настройват alerts?
5. Какво може да научите от логовете на базата данни?
6. Какви са рисковете при липса на исторически данни?
7. Какво представлява dashboard в контекста на наблюдение?

## 8. Quick Recap

- Observability включва метрики, логове и трасета за дълбоко разбиране на системата.
- Monitoring проследява основни показатели и състояния на базата данни.
- Метриките дават количествена оценка на производителността и здравето.
- Логовете и трасетата помагат за диагностика на сложни проблеми.
- Alerting позволява проактивна реакция при инциденти.
- Dashboards визуализират данните за бърз анализ.
- Добрата наблюдаемост е критична за надеждността на AI и софтуерни системи.

## 9. Spaced Review Plan

| Review Time | Prompt                                                                 |
|-------------|------------------------------------------------------------------------|
| 1 day       | Обяснете разликата между monitoring и observability с пример.          |
| 3 days      | Избройте основните метрики и как бихте ги визуализирали.               |
| 1 week      | Опишете процеса на настройка на alert и дайте пример за полезен alert. |
| 1 month     | Анализирайте случай, в който липсата на наблюдаемост е довела до проблем. |