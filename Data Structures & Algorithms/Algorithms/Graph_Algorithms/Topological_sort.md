# Topological_sort

## 1. Activate Prior Knowledge
- Какво представлява насочен ацикличен граф (DAG) и къде може да се срещне в софтуерните системи?
- Как бихте организирали задачи с взаимни зависимости, например при изграждане на софтуерен проект или планиране на процеси?
- Защо е важно да имаме последователност на изпълнение, която да уважава зависимостите между отделните елементи?

## 2. Overview
Топологичният сортиране е алгоритъм, който подрежда върховете на насочен ацикличен граф (DAG) в линейна последователност, така че за всяко ребро от връх A към връх B, A да се появява преди B в реда. Това е фундаментален инструмент при моделиране и решаване на проблеми с зависимости, като например планиране на задачи, компилация на код или анализ на работни потоци.

В контекста на изкуствения интелект и софтуерното инженерство, топологичното сортиране помага да се гарантира, че всички предпоставки на дадена операция са изпълнени преди самата операция, което е критично за коректното функциониране на сложни системи. Без правилен ред на изпълнение, системите могат да се сблъскат с грешки или неефективност.

Топологичното сортиране е приложимо само върху графи без цикли (DAG), защото цикълът означава взаимна зависимост, която не може да бъде разрешена в линейна последователност. Затова откриването на цикли често е част от процеса при прилагане на този алгоритъм.

## 3. Key Concepts
- **Directed Acyclic Graph (DAG)** – граф с насочени ребра, който не съдържа цикли. Представете си го като структура от задачи, където всяка задача зависи само от предишни, но няма циклични зависимости.
- **Topological Order** – линейна подредба на върховете на DAG, която уважава посоката на ребрата. Аналогично на подреждането на глави в книга, където всяка глава трябва да се прочете след предишните, от които зависи.
- **In-degree** – броят на ребрата, влизащи в даден връх. Може да се мисли като броя на предпоставките, които трябва да бъдат изпълнени преди дадена задача.
- **Cycle Detection** – процес за откриване на цикли в графа, който е необходим, защото топологичното сортиране не е възможно при цикли.
- **Kahn’s Algorithm** – алгоритъм за топологично сортиране, който използва in-degree и опашка, за да подреди върховете.
- **Depth-First Search (DFS) based Topological Sort** – друг подход, който използва дълбочинно обхождане и стек за изграждане на топологичния ред.

## 4. Step-by-step Learning Path
1. **Разберете структурата на DAG**
   - Фокус: Изучете какво е DAG и защо цикли не са позволени.
   - Задача: Нарисувайте примерен DAG с поне 6 върха и 7 ребра.
   - Въпроси: Какво се случва, ако добавите ребро, което създава цикъл? Защо цикълът пречи на топологичното сортиране?

2. **Запознайте се с in-degree и неговото значение**
   - Фокус: Научете как се изчислява in-degree за всеки връх.
   - Задача: Изчислете in-degree на всеки връх във вашия примерен DAG.
   - Въпроси: Какво означава връх с in-degree 0? Защо е важен?

3. **Разучете Kahn’s Algorithm**
   - Фокус: Разберете стъпките на алгоритъма и как се използва опашка.
   - Задача: Ръчно приложете Kahn’s Algorithm върху вашия DAG.
   - Въпроси: Какво се случва, ако опашката стане празна преди да са обходени всички върхове?

4. **Изучете DFS-базираното топологично сортиране**
   - Фокус: Разберете как дълбочинното обхождане може да създаде топологичен ред.
   - Задача: Имплементирайте DFS топологично сортиране на псевдокод.
   - Въпроси: Как стекът помага за изграждане на топологичния ред?

5. **Практическа имплементация и приложение**
   - Фокус: Имплементирайте топологично сортиране на реален език за програмиране.
   - Задача: Напишете функция, която приема DAG и връща топологичен ред.
   - Въпроси: Как бихте използвали топологично сортиране при управление на зависимости в софтуерен проект?

## 5. Examples

### Пример 1: Планиране на задачи
Имаме задачи A, B, C, D, E с зависимости: A → C, B → C, C → D, D → E.

```python
from collections import deque

graph = {
    'A': ['C'],
    'B': ['C'],
    'C': ['D'],
    'D': ['E'],
    'E': []
}

in_degree = {u: 0 for u in graph}
for u in graph:
    for v in graph[u]:
        in_degree[v] += 1

queue = deque([u for u in in_degree if in_degree[u] == 0])
top_order = []

while queue:
    u = queue.popleft()
    top_order.append(u)
    for v in graph[u]:
        in_degree[v] -= 1
        if in_degree[v] == 0:
            queue.append(v)

print("Topological order:", top_order)
```

Изход: `Topological order: ['A', 'B', 'C', 'D', 'E']`

### Пример 2: Компилация на програмен код
Файлове с зависимости, където един файл трябва да се компилира преди друг.

### Пример 3: Обработка на данни в AI pipeline
Етапите на обработка на данни трябва да се изпълнят в определен ред, например: събиране → почистване → трансформация → обучение.

## 6. Common Pitfalls
- **Опит за сортиране на граф с цикли** – алгоритъмът няма да успее, трябва първо да се открият и премахнат цикли.
- **Игнориране на върхове с in-degree 0** – ако не се започне от тях, топологичният ред няма да е коректен.
- **Неправилно обновяване на in-degree** – грешка, която води до зацикляне или пропускане на върхове.
- **Смесване на топологично сортиране с обикновено сортиране** – топологичното сортиране не подрежда по стойност, а по зависимости.
- **Пропускане на върхове без изходящи ребра** – те също трябва да се включат в реда.

## 7. Short Retrieval Quiz
1. Какво е DAG и защо е важно за топологичното сортиране?
2. Какво означава in-degree на връх?
3. Кой алгоритъм използва опашка за топологично сортиране?
4. Защо топологично сортиране не може да се приложи върху граф с цикли?
5. Как DFS помага за изграждане на топологичен ред?
6. Какво се случва, ако има върхове с in-degree > 0, но опашката е празна?
7. В какви ситуации в софтуерното инженерство е полезно топологичното сортиране?

## 8. Quick Recap
- Топологичното сортиране подрежда върховете на DAG така, че зависимостите да се спазват.
- Работи само върху насочени ациклични графи.
- In-degree показва броя на входящите ребра към връх и помага за намиране на стартови върхове.
- Kahn’s Algorithm и DFS са два основни подхода за топологично сортиране.
- Топологичното сортиране е ключово за управление на зависимости в софтуер и AI системи.
- Циклите в графа правят топологичното сортиране невъзможно.
- Внимателното обновяване на in-degree и правилното управление на опашката или стека са критични за коректна имплементация.

## 9. Spaced Review Plan

| Време след изучаване | Промпт за преговор                                      |
|----------------------|---------------------------------------------------------|
| 1 ден                | Обяснете какво е топологично сортиране и защо е важно. |
| 3 дни                | Опишете стъпките на Kahn’s Algorithm с пример.          |
| 1 седмица            | Имплементирайте топологично сортиране на псевдокод.     |
| 1 месец              | Приложете топологично сортиране в реален проект или задача с зависимости. |