# 14 - Logging metrics and debugging practices in components

## 1. Activate Prior Knowledge

- Как сте използвали логове или метрики, за да разберете или подобрите работата на даден софтуерен компонент?
- Кога за последен път сте откривали бъг чрез дебъгване или анализ на логове? Какъв беше процесът?
- Какви предизвикателства сте срещали при мониторинг и диагностика на AI системи или сложни софтуерни приложения?

## 2. Overview

В съвременните софтуерни системи, особено в AI компонентите, логването на метрики и добрите практики за дебъгване са критични за надеждността, производителността и поддръжката. Логовете и метриките осигуряват прозорец към вътрешното състояние на компонентите, което позволява на инженерите да идентифицират проблеми, да анализират поведение и да оптимизират работата.

Тези практики са неразделна част от жизнения цикъл на разработката – от локално тестване до продукционна експлоатация. Те помагат за ранно откриване на аномалии, проследяване на производителността и осигуряване на прозрачност при инциденти.

В контекста на AI системите, където компонентите често са черни кутии, доброто логване и метрики са особено важни за обяснимост, възпроизводимост и непрекъснато подобрение.

## 3. Key Concepts

- Logging – Процесът на записване на събития, състояния или грешки по време на изпълнение на компонент. Може да се сравни с дневник на действията на системата.
- Metrics – Квантитативни измервания (например latency, throughput, error rate), които показват здравето и производителността на компонентите.
- Debugging – Систематичен процес за откриване и отстраняване на дефекти или аномалии в кода. Може да се мисли като детективска работа в софтуера.
- Log Levels – Класификация на важността на лог съобщенията (напр. DEBUG, INFO, WARNING, ERROR, CRITICAL).
- Observability – Способността да се разбира вътрешното състояние на системата чрез външни изходи като логове и метрики.
- Tracing – Проследяване на пътя на заявка или събитие през множество компоненти, често използвано в дистрибутирани системи.

## 4. Step-by-step Learning Path

1. **Разберете основите на логването**
   - Фокус: Какво е логване, какви видове логове има.
   - Задача: Добавете прост лог (например `console.log` или `logging.info`) в малък Python/JavaScript компонент.
   - Въпроси: Какво записва този лог? Кога бихте го използвали?

2. **Работа с метрики**
   - Фокус: Как да дефинирате и събирате метрики (например брой заявки, време за отговор).
   - Задача: Измерете и логнете latency за функция в кода си.
   - Въпроси: Каква е разликата между лог и метрика? Коя метрика е най-важна за вашия компонент?

3. **Използване на log levels**
   - Фокус: Как и кога да използвате различни нива на логване.
   - Задача: Променете логовете си така, че да използвате поне три различни log levels.
   - Въпроси: Кои съобщения трябва да са WARNING, а кои DEBUG? Защо?

4. **Дебъгване на компонент**
   - Фокус: Основни техники за дебъгване (breakpoints, stack traces, анализ на логове).
   - Задача: Симулирайте грешка и използвайте логове и дебъгер, за да я намерите.
   - Въпроси: Какво ви помогна да локализирате проблема? Как бихте подобрили логовете?

5. **Интеграция с observability инструменти**
   - Фокус: Инструменти като Prometheus, Grafana, ELK stack.
   - Задача: Изпратете метрика или лог към външен инструмент и визуализирайте резултата.
   - Въпроси: Какво ново научихте за компонента си чрез тези инструменти?

## 5. Examples

### Пример 1: Логване на грешка в Python

```python
import logging

logging.basicConfig(level=logging.INFO)

def divide(a, b):
    try:
        return a / b
    except ZeroDivisionError:
        logging.error("Attempted division by zero: a=%s, b=%s", a, b)
        return None

divide(5, 0)
```

### Пример 2: Събиране на latency метрика

```python
import time

def process_request():
    start = time.time()
    # ... обработка ...
    time.sleep(0.2)
    latency = time.time() - start
    print(f"Request latency: {latency:.3f} seconds")
```

### Пример 3: Log levels в Node.js

```javascript
const winston = require('winston');
const logger = winston.createLogger({
  level: 'info',
  transports: [new winston.transports.Console()]
});

logger.debug('Debug message');
logger.info('Informational message');
logger.warn('Warning message');
logger.error('Error message');
```

## 6. Common Pitfalls

- **Прекалено много или твърде малко логове** – Прекаленото логване затруднява анализа, а недостатъчното води до липса на информация при инциденти. Използвайте подходящи log levels.
- **Липса на контекст в логовете** – Без информация като user ID, request ID или timestamp, логовете са трудни за анализ. Винаги добавяйте релевантен контекст.
- **Неизмерване на ключови метрики** – Пропускането на важни метрики (напр. error rate, latency) може да скрие проблеми. Определете кои метрики са критични за вашия компонент.
- **Липса на автоматизация при събиране и анализ** – Ръчното преглеждане на логове и метрики не е мащабируемо. Използвайте инструменти за централизация и визуализация.
- **Пренебрегване на сигурността** – Не логвайте чувствителна информация (напр. пароли, лични данни).

## 7. Short Retrieval Quiz

1. Каква е разликата между лог и метрика?
2. Какво е log level и защо е важно?
3. Кои са трите основни техники за дебъгване на компонент?
4. Какво представлява observability?
5. Какви са рисковете при логване на чувствителна информация?
6. Дайте пример за метрика, която бихте следили в AI компонент.
7. Как log context помага при анализ на инциденти?

## 8. Quick Recap

- Логовете и метриките са ключови за мониторинг, диагностика и оптимизация на компоненти.
- Log levels помагат да се филтрира важната информация.
- Дебъгването използва логове, breakpoints и анализ на stack traces.
- Observability инструментите дават цялостен поглед върху системата.
- Важно е да се избягва логване на чувствителни данни.
- Качествените логове съдържат контекст и са структурирани.
- Автоматизацията на събиране и анализ на логове/метрики е критична за мащабируемост.

## 9. Spaced Review Plan

| Time      | Review Prompt                                                         |
|-----------|----------------------------------------------------------------------|
| 1 day     | Обяснете разликата между лог и метрика. Дайте пример за log level.   |
| 3 days    | Опишете процеса на дебъгване с помощта на логове и метрики.          |
| 1 week    | Избройте често срещани грешки при логване и как да ги избегнете.      |
| 1 month   | Как бихте интегрирали observability инструмент във ваш компонент?     |