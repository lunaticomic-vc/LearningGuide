# Pruning_techniques

## 1. Activate Prior Knowledge
- Какво представлява "прореждането" (pruning) в контекста на машинното обучение и защо може да е необходимо?
- Как мислите, че премахването на части от модел или структура може да подобри ефективността му?
- В кои ситуации в софтуерното инженерство сте срещали оптимизации, които включват премахване на излишни елементи?

## 2. Overview
Прореждането (pruning) е техника за оптимизация, която се използва за намаляване на сложността на модели, особено в дълбокото обучение и невронните мрежи. Целта е да се премахнат излишни или слабо значими параметри, като по този начин се подобрява скоростта на изчисленията и се намалява нуждата от памет, без да се жертва значително точността на модела.

В по-широк контекст, прореждането е част от процеса на моделиране и оптимизация, където балансът между производителност и ефективност е критичен. В софтуерното инженерство подобни техники се използват за оптимизиране на код, структури от данни и системни ресурси.

Този подход е особено важен при внедряване на модели в реални приложения, където ресурсите са ограничени, например в мобилни устройства или вградени системи. Разбирането на принципите и методите на прореждане позволява на инженерите да създават по-леки и по-бързи модели, които запазват висока производителност.

## 3. Key Concepts
- **Pruning (Прореждане)** – процес на премахване на ненужни или слабо значими компоненти от модел или структура, за да се подобри ефективността му. Може да се сравни с подрязване на дърво, за да се насочи растежът му в желана посока.
- **Weight Pruning (Прореждане на тегла)** – премахване на връзки в невронна мрежа с малки стойности на теглата, които допринасят малко за изхода.
- **Structured Pruning (Структурирано прореждане)** – премахване на цели групи параметри, като цели неврони, филтри или слоеве, което улеснява ускорението на изчисленията.
- **Unstructured Pruning (Неструктурирано прореждане)** – премахване на отделни параметри без конкретна структура, което води до по-рядка, но не непременно по-бърза мрежа.
- **Fine-tuning (Фина настройка)** – допълнително обучение на модела след прореждане, за да се възстанови или подобри точността.
- **Sparsity (Редкост)** – степента, до която моделът съдържа нулеви или премахнати параметри, което е индикатор за ефективността на прореждането.

## 4. Step-by-step Learning Path
1. **Запознаване с основите на невронните мрежи и параметрите им**  
   - Задача: Прегледайте структурата на проста невронна мрежа и идентифицирайте теглата и връзките.  
   - Въпроси: Какво е тегло в невронна мрежа? Защо някои тегла могат да са по-малко значими?

2. **Разбиране на концепцията за важност на параметрите**  
   - Задача: Изследвайте методи за оценка на важността на теглата (напр. абсолютна стойност, градиенти).  
   - Въпроси: Как можем да определим кои тегла да премахнем? Какво е влиянието на малките тегла?

3. **Прилагане на unstructured pruning върху малка мрежа**  
   - Задача: Използвайте библиотека (например PyTorch) за премахване на 20% от най-малките тегла и измерете промяната в точността.  
   - Въпроси: Как се променя точността след прореждането? Какво означава sparsity?

4. **Изучаване на structured pruning и неговите предимства**  
   - Задача: Приложете премахване на цели филтри в конволюционен слой и наблюдавайте ефекта върху скоростта на изчисленията.  
   - Въпроси: Какво е предимството на структурираното прореждане пред нестуктурираното?

5. **Фина настройка след прореждане**  
   - Задача: Обучете модела допълнително след прореждане и сравнете резултатите.  
   - Въпроси: Защо е необходима фина настройка? Как тя влияе на производителността?

6. **Изследване на автоматизирани и адаптивни методи за прореждане**  
   - Задача: Прегледайте и експериментирайте с автоматизирани техники като Lottery Ticket Hypothesis.  
   - Въпроси: Какво представлява Lottery Ticket Hypothesis? Как автоматизираното прореждане подобрява процеса?

## 5. Examples
### Пример 1: Unstructured pruning в PyTorch
```python
import torch
import torch.nn.utils.prune as prune
import torch.nn as nn

model = nn.Sequential(
    nn.Linear(10, 20),
    nn.ReLU(),
    nn.Linear(20, 1)
)

# Прореждане на 30% от теглата в първия слой
prune.l1_unstructured(model[0], name='weight', amount=0.3)

print(model[0].weight)
```

### Пример 2: Structured pruning на филтри в CNN
```python
import torch.nn.utils.prune as prune

# Прореждане на 20% от филтрите в Conv2d слой
prune.ln_structured(model.conv1, name='weight', amount=0.2, n=2, dim=0)
```

### Пример 3: Фина настройка след прореждане
```python
# След прореждане, продължаваме обучението
optimizer = torch.optim.Adam(model.parameters(), lr=0.001)
for epoch in range(5):
    train(model, optimizer, train_loader)
```

## 6. Common Pitfalls
- **Прекомерно прореждане** – премахване на твърде много параметри, което води до значително влошаване на точността. Избягвайте чрез постепенно прореждане и мониторинг на резултатите.
- **Липса на фина настройка** – пропускане на допълнително обучение след прореждане, което може да доведе до загуба на производителност.
- **Неправилен избор на критерий за важност** – използване на неподходящи метрики за премахване на параметри, което води до премахване на важни връзки.
- **Игнориране на хардуерните ограничения** – нестуктурираното прореждане може да не доведе до ускорение на хардуера, ако не е съобразено с архитектурата.
- **Липса на валидация** – невалидиране на модела след прореждане, което може да скрие проблеми с производителността.

## 7. Short Retrieval Quiz
1. Какво е целта на прореждането в невронните мрежи?  
2. Каква е разликата между structured и unstructured pruning?  
3. Защо е важна фина настройка след прореждане?  
4. Какво означава sparsity в контекста на прореждането?  
5. Кои са рисковете при прекомерно прореждане?  
6. Как може да се определи кои параметри да бъдат премахнати?  
7. Какво е предимството на структурираното прореждане при хардуерна оптимизация?

## 8. Quick Recap
- Прореждането е техника за премахване на излишни параметри с цел оптимизация на моделите.  
- Съществуват два основни типа: structured (цели групи параметри) и unstructured (отделни параметри).  
- Фина настройка след прореждане е задължителна за възстановяване на точността.  
- Правилният избор на критерии за премахване е ключов за успеха.  
- Прореждането подобрява ефективността, но трябва да се прилага внимателно, за да не се загуби производителност.  
- Техниките за прореждане са особено важни при внедряване на модели в ограничени хардуерни среди.  
- Автоматизираните методи като Lottery Ticket Hypothesis предлагат нови възможности за оптимизация.

## 9. Spaced Review Plan

| Време след учене | Промпт за преговор                                      |
|------------------|--------------------------------------------------------|
| 1 ден            | Обяснете разликата между structured и unstructured pruning. |
| 3 дни            | Опишете процеса и целта на фина настройка след прореждане.  |
| 1 седмица        | Дайте пример за практическо приложение на pruning в PyTorch. |
| 1 месец          | Обсъдете предимствата и рисковете при прекомерно прореждане. |