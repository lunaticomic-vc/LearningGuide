# 15 - Configuration management and feature toggles

## 1. Activate Prior Knowledge

- Как се справяте с промени в настройките на дадено софтуерно приложение, без да прекъсвате работата му?
- Срещали ли сте ситуации, в които трябва да активирате или деактивирате определена функционалност за различни групи потребители?
- Какви рискове виждате при внедряване на нови функции в големи AI системи или уеб приложения?

## 2. Overview

Configuration management и feature toggles са критични практики в съвременното софтуерно инженерство, особено при разработката и поддръжката на мащабни системи като AI платформи или облачни услуги. Configuration management позволява на екипите да управляват, проследяват и променят конфигурационните параметри на системите си по структуриран и сигурен начин. Това осигурява последователност, предвидимост и бърза реакция при нужда от промяна.

Feature toggles (или feature flags) дават възможност определени функционалности да бъдат включвани или изключвани динамично, без да се налага повторно внедряване на кода. Това позволява безопасно тестване на нови функции, контролирано пускане към потребителите и бързо връщане назад при проблеми.

В контекста на AI системи, тези практики са особено важни заради нуждата от експериментиране, A/B тестване и бързо адаптиране към нови изисквания или данни. Те минимизират риска от грешки и улесняват поддръжката и развитието на сложни продукти.

## 3. Key Concepts

- **Configuration management** – Процесът на систематично управление и контрол на конфигурационните параметри на софтуерни системи. Може да се сравни с поддържане на рецепта, която винаги може да бъде възпроизведена.
- **Feature toggle (feature flag)** – Механизъм за динамично включване или изключване на определени функционалности в приложението. Представете си го като ключ за осветление, който може да се включва и изключва по всяко време.
- **Environment configuration** – Настройки, които се различават според средата (development, staging, production) и определят поведението на приложението.
- **Rollout** – Постепенно пускане на нова функционалност към определени групи потребители, често чрез feature toggles.
- **Canary release** – Стратегия, при която нова функция първо се пуска на малък брой потребители, за да се наблюдава ефектът, преди да се разшири към всички.
- **A/B testing** – Експериментален подход, при който различни групи потребители виждат различни версии на функционалност, често реализирано чрез feature toggles.

## 4. Step-by-step Learning Path

1. **Разберете основите на configuration management**
   - Фокус: Какво представлява и защо е важен.
   - Практическа задача: Избройте 5 конфигурационни параметъра във ваше приложение.
   - Въпроси: Какво би се случило, ако конфигурациите не се управляват централно? Какви рискове крие това?

2. **Изучете различните видове конфигурационни файлове и формати**
   - Фокус: YAML, JSON, .env файлове и др.
   - Практическа задача: Създайте примерен конфигурационен файл за малко уеб приложение.
   - Въпроси: Кой формат е най-подходящ за чувствителни данни? Как се осигурява сигурност?

3. **Въведете feature toggles във ваш проект**
   - Фокус: Основни типове feature toggles (release, experiment, ops).
   - Практическа задача: Имплементирайте прост feature toggle за нова функция.
   - Въпроси: Какви са предимствата на feature toggles спрямо branch-based development?

4. **Практикувайте управление на feature toggles**
   - Фокус: Как се активират/деактивират, как се документират.
   - Практическа задача: Създайте стратегия за премахване на остарели toggles.
   - Въпроси: Какви са рисковете от оставяне на стари toggles в кода?

5. **Интегрирайте configuration management с CI/CD**
   - Фокус: Как автоматизацията помага за управление на конфигурации и toggles.
   - Практическа задача: Настройте deployment pipeline, който използва различни конфигурации за различни среди.
   - Въпроси: Какви са ползите от автоматизирано управление на конфигурации?

## 5. Examples

### Пример 1: Конфигурационен файл в YAML

```yaml
database:
  host: localhost
  port: 5432
  user: admin
  password: secret
features:
  new_ui: false
  ai_recommendations: true
```

### Пример 2: Feature toggle в Python

```python
FEATURE_FLAGS = {
    "enable_ai_module": True,
    "beta_dashboard": False,
}

if FEATURE_FLAGS["enable_ai_module"]:
    run_ai_module()
else:
    run_basic_module()
```

### Пример 3: Canary release с feature toggle

Въвеждане на нова AI функция само за 10% от потребителите:

```python
import random

def is_feature_enabled(user_id):
    return hash(user_id) % 10 == 0  # 10% от потребителите

if is_feature_enabled(current_user.id):
    show_new_ai_feature()
else:
    show_standard_feature()
```

## 6. Common Pitfalls

- **Твърдо кодирани конфигурации** – Не съхранявайте настройки директно в кода; използвайте конфигурационни файлове или системи.
- **Липса на документация за toggles** – Винаги документирайте целта и срока на всеки feature toggle.
- **Забравени или остарели toggles** – Редовно преглеждайте и премахвайте ненужните toggles, за да избегнете усложнения и технически дълг.
- **Неправилно управление на чувствителни данни** – Никога не съхранявайте пароли или ключове в публични конфигурационни файлове.
- **Сложни зависимости между toggles** – Избягвайте прекомерна взаимозависимост между feature toggles, която може да доведе до неочаквано поведение.

## 7. Short Retrieval Quiz

1. Каква е основната цел на configuration management?
2. Какво представлява feature toggle и кога се използва?
3. Какви са рисковете от оставяне на стари feature toggles в кода?
4. Каква е разликата между rollout и canary release?
5. Кой формат на конфигурационен файл е подходящ за чувствителни данни?
6. Как feature toggles подпомагат A/B тестването?
7. Какви са ползите от интеграция на configuration management с CI/CD процеси?

## 8. Quick Recap

- Configuration management осигурява структурирано управление на настройките на системата.
- Feature toggles позволяват динамично включване/изключване на функционалности без нов deployment.
- Използването на конфигурационни файлове улеснява управлението на среди и сигурността.
- Feature toggles са ключови за безопасно внедряване, експериментиране и A/B тестване.
- Редовната поддръжка и документация на toggles предотвратява технически дълг.
- Интеграцията с CI/CD автоматизира и улеснява управлението на конфигурации.
- Правилното управление на конфигурации и toggles намалява риска от грешки и улеснява развитието на сложни системи.

## 9. Spaced Review Plan

| Време       | Преговорен въпрос                                         |
|-------------|-----------------------------------------------------------|
| 1 ден       | Какво представлява feature toggle и как се използва?      |
| 3 дни       | Какви са основните ползи и рискове при configuration management? |
| 1 седмица   | Как се интегрират configuration management и CI/CD?       |
| 1 месец     | Какви са най-честите грешки при работа с feature toggles? |