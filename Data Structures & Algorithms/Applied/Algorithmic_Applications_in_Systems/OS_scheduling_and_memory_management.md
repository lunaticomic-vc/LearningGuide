# OS_scheduling_and_memory_management

## 1. Activate Prior Knowledge
- Какво представлява управлението на процесите в операционната система и защо е важно за ефективността на софтуерните системи?
- Как мислите, че операционната система разпределя процесорното време между множество задачи, особено в контекста на AI приложения с висока изчислителна тежест?
- Какви предизвикателства могат да възникнат при управлението на паметта в системи с ограничени ресурси и динамично натоварване?

## 2. Overview
Управлението на процесорното време (scheduling) и паметта (memory management) са ключови функции на операционната система (ОС), които осигуряват ефективна и справедлива работа на множество програми едновременно. Scheduling-ът определя кой процес и кога да получи достъп до процесора, а memory management контролира разпределението и защитата на оперативната памет.

В контекста на съвременните софтуерни системи, особено AI приложенията, където има множество паралелни изчисления и динамично натоварване, тези механизми са критични за постигане на висока производителност и стабилност. Те позволяват на системата да използва ресурсите си оптимално, да предотвратява задръствания и да осигурява надеждност.

Разбирането на тези концепции е фундаментално за инженери, които проектират или оптимизират операционни системи, вградени системи, или софтуер, който работи в многозадачна среда. Това знание също така помага при диагностика и подобряване на производителността на сложни системи.

## 3. Key Concepts
- **Process Scheduling** – Механизъм, чрез който ОС определя реда и времето, през което процесите използват процесора. Може да се сравни с разпределение на време за говорене в групова дискусия.
- **Preemptive Scheduling** – Вид планиране, при което ОС може да прекъсне текущия процес, за да даде време на друг, по-висок приоритетен процес.
- **Non-preemptive Scheduling** – Процесът се изпълнява докато завърши или доброволно освободи процесора.
- **Memory Management Unit (MMU)** – Хардуерен компонент, който превежда виртуалните адреси на процесите в физически адреси в паметта.
- **Virtual Memory** – Техника, която позволява на процесите да използват повече памет, отколкото физически наличната, чрез използване на дисково пространство като разширение.
- **Paging** – Разделяне на паметта на фиксирани блокове (страници), което улеснява управлението и защита на паметта.
- **Segmentation** – Разделяне на паметта на логически сегменти, например код, данни, стек.
- **Thrashing** – Състояние, при което системата прекарва повече време в управление на паметта (swap in/out), отколкото в изпълнение на процеси.
- **Context Switch** – Процесът на запазване и възстановяване на състоянието на процеса при смяна на изпълнявания процес.

## 4. Step-by-step Learning Path
1. **Основи на процесите и тяхното изпълнение**
   - Фокус: Разберете какво е процес и как ОС ги управлява.
   - Задача: Напишете кратка програма, която създава няколко нишки и наблюдавайте тяхното изпълнение.
   - Въпроси: Какво е разликата между процес и нишка? Защо ОС трябва да управлява процесите?
   
2. **Механизми на планиране (scheduling algorithms)**
   - Фокус: Изучете основните алгоритми – FCFS, Round Robin, Priority Scheduling.
   - Задача: Симулирайте Round Robin алгоритъм с различни времеви квоти.
   - Въпроси: Какво е времева квота? Как Round Robin осигурява справедливост?
   
3. **Управление на паметта: виртуална памет и страници**
   - Фокус: Разберете концепцията за виртуална памет и страници.
   - Задача: Използвайте инструмент за визуализация на странични прекъсвания (page faults) при изпълнение на програма.
   - Въпроси: Какво е странично прекъсване? Как виртуалната памет подобрява използването на RAM?
   
4. **Контекстна смяна и нейното влияние върху производителността**
   - Фокус: Проучете как се случва context switch и как влияе на системата.
   - Задача: Измерете времето за context switch с помощта на профилиращ инструмент.
   - Въпроси: Какво се случва по време на context switch? Защо прекалено честите context switch-ове са проблем?
   
5. **Оптимизация и проблеми при scheduling и памет**
   - Фокус: Анализирайте проблеми като starvation, deadlock, thrashing.
   - Задача: Напишете кратък доклад с предложения за избягване на thrashing в дадена система.
   - Въпроси: Какво е starvation? Как thrashing влияе на производителността?

## 5. Examples
### Пример 1: Round Robin Scheduling (Python псевдокод)
```python
processes = [("P1", 5), ("P2", 3), ("P3", 8)]  # (име, време за изпълнение)
time_quantum = 2
queue = processes.copy()

while queue:
    process, time_left = queue.pop(0)
    exec_time = min(time_quantum, time_left)
    print(f"Изпълнявам {process} за {exec_time} единици време")
    time_left -= exec_time
    if time_left > 0:
        queue.append((process, time_left))
```

### Пример 2: Демонстрация на странично прекъсване (Page Fault) в C
```c
#include <stdio.h>
#include <stdlib.h>

int main() {
    int *arr = malloc(1000000 * sizeof(int)); // голям масив, вероятно извън кеша
    for (int i = 0; i < 1000000; i++) {
        arr[i] = i;  // достъп до нови страници, предизвикващи page faults
    }
    printf("Достъпът до паметта приключи.\n");
    free(arr);
    return 0;
}
```

### Пример 3: Контекстна смяна в Linux (команда)
```bash
pidstat -w 1 5
```
Тази команда показва статистика за context switch-овете на процесите на всеки 1 секунда за 5 пъти.

## 6. Common Pitfalls
- **Игнориране на приоритетите при scheduling** – може да доведе до starvation на нископриоритетни процеси. Използвайте механизми за приоритетна инверсия.
- **Недостатъчно внимание към размерите на страниците** – твърде малки страници увеличават overhead, твърде големи – водят до загуба на памет.
- **Прекалено чест context switch** – намалява ефективността, защото процесорът прекарва време в превключване, а не в изпълнение.
- **Неправилно управление на виртуалната памет** – може да доведе до thrashing, когато системата прекарва много време в swap операции.
- **Липса на синхронизация при многозадачност** – води до race conditions и нестабилност.

## 7. Short Retrieval Quiz
1. Какво е основната цел на процесното планиране (scheduling)?
2. Какво представлява виртуалната памет?
3. Какво е контекстна смяна и защо е важна?
4. Какво е thrashing и как се проявява?
5. Какво е разликата между preemptive и non-preemptive scheduling?
6. Защо е важно да се използват страници в управлението на паметта?
7. Какво представлява starvation и как може да бъде избегнато?

## 8. Quick Recap
- Scheduling управлява кой процес и кога използва процесора.
- Виртуалната памет позволява на процесите да използват повече памет, отколкото физически е налична.
- Paging разделя паметта на фиксирани блокове, улеснявайки управлението и защитата.
- Контекстната смяна е ключова за многозадачност, но има цена по отношение на производителността.
- Thrashing възниква при прекалено чести swap операции и намалява ефективността на системата.
- Приоритетите и справедливостта са критични за избягване на starvation.
- Добрата синхронизация и правилното управление на ресурсите са основа за стабилна и бърза ОС.

## 9. Spaced Review Plan

| Време след изучаване | Промпт за преглед                                    |
|----------------------|-----------------------------------------------------|
| 1 ден                | Обяснете с прости думи какво е процесно планиране. |
| 3 дни                | Опишете разликите между виртуална памет и физическа.|
| 1 седмица            | Дайте примери за preemptive и non-preemptive scheduling.|
| 1 месец              | Анализирайте как thrashing влияе на производителността и как да го избегнем.|