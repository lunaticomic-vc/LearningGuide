# 26 - Database security and access control

## 1. Activate Prior Knowledge

- Какви рискове съществуват, ако не се защитят данните в една база данни, особено при системи с изкуствен интелект или чувствителна информация?
- Какви методи за удостоверяване и контрол на достъпа познавате от други софтуерни системи?
- Можете ли да дадете пример за последствията от неправилно конфигуриран достъп до база данни в реална организация?

## 2. Overview

Database security and access control са фундаментални аспекти на дизайна и експлоатацията на съвременните информационни системи. Те гарантират, че само оторизирани потребители и приложения имат достъп до данните, и че този достъп е ограничен според нуждите на всяка роля или процес. Това е особено критично при системи, които обработват лични, финансови или чувствителни данни, както и при системи с изкуствен интелект, където изтичането или манипулирането на данни може да доведе до сериозни последствия.

В по-широкия контекст на софтуерното инженерство, защитата на базите данни е неразделна част от цялостната стратегия за сигурност на системата (defense in depth). Тя работи съвместно с други мерки като криптиране, мониторинг и управление на уязвимости.

Липсата на адекватен контрол на достъпа може да доведе до неоторизиран достъп, изтичане на данни, загуба на доверие и дори правни последствия. Затова е важно да се разберат и прилагат най-добрите практики за сигурност на базите данни още от фазата на проектиране.

## 3. Key Concepts

- Authentication (Удостоверяване) – Процесът на проверка на идентичността на потребител или система. Аналогия: като проверка на лична карта на входа на сграда.
- Authorization (Упълномощаване) – Определя какви действия може да извършва даден потребител след удостоверяване. Мислете за това като за различни ключове за различни врати в една сграда.
- Access Control List (ACL) – Списък, който дефинира кой има достъп до какви ресурси и с какви права.
- Role-Based Access Control (RBAC) – Управление на достъпа чрез роли, където правата се асоциират с роли, а не директно с потребители.
- Principle of Least Privilege – Всеки потребител или процес получава минимално необходимите права за изпълнение на задачите си.
- Encryption (Криптиране) – Превръщане на данните във вид, който е нечетим без специален ключ.
- Auditing (Одитиране) – Записване и анализ на действията, свързани с достъпа до базата данни, за откриване на инциденти или злоупотреби.

## 4. Step-by-step Learning Path

1. **Understand Authentication Mechanisms**
   - Фокус: Как се удостоверяват потребителите в базата данни.
   - Task: Конфигурирайте локален потребител с парола в тестова база данни (например PostgreSQL или MySQL).
   - Retrieval: Каква е разликата между удостоверяване и упълномощаване? Какви типове удостоверяване познавате?

2. **Explore Authorization and Privileges**
   - Фокус: Как се определят и управляват правата на потребителите.
   - Task: Дайте на създадения потребител само права за четене върху определена таблица.
   - Retrieval: Какво е RBAC и как се различава от ACL?

3. **Implement Role-Based Access Control**
   - Фокус: Създаване и използване на роли за управление на достъпа.
   - Task: Създайте роля „analyst“ с права само за SELECT и я асоциирайте с потребител.
   - Retrieval: Какви са предимствата на RBAC пред индивидуалното задаване на права?

4. **Apply the Principle of Least Privilege**
   - Фокус: Ограничаване на достъпа до строго необходимото.
   - Task: Прегледайте всички права на потребителите и премахнете ненужните.
   - Retrieval: Какви са рисковете, ако даден потребител има повече права от необходимото?

5. **Enable Auditing and Logging**
   - Фокус: Мониторинг на достъпа и действията в базата данни.
   - Task: Активирайте логване на заявки и достъп в базата данни.
   - Retrieval: Как може одитирането да помогне при разследване на инциденти?

6. **Protect Data with Encryption**
   - Фокус: Криптиране на данни в покой и при пренос.
   - Task: Активирайте TLS връзка към базата данни и/или криптирайте определена колона.
   - Retrieval: Каква е разликата между криптиране на ниво транспорт и на ниво данни?

## 5. Examples

### Пример 1: Създаване на потребител с ограничени права в PostgreSQL

```sql
CREATE USER analyst WITH PASSWORD 'securepass';
GRANT SELECT ON ALL TABLES IN SCHEMA public TO analyst;
```

### Пример 2: Криптиране на връзката към база данни (PostgreSQL)

```bash
psql "host=db.example.com port=5432 dbname=mydb user=analyst sslmode=require"
```

### Пример 3: Одитиране на заявки в MySQL

```sql
-- Включване на общ лог за всички заявки
SET GLOBAL general_log = 'ON';
```

## 6. Common Pitfalls

- Оставяне на default (по подразбиране) акаунти с пълни права – винаги ги изтривайте или променяйте паролите им.
- Даване на прекалено широки права на всички потребители – прилагайте принципа на минималните права.
- Липса на криптиране на чувствителни данни или на връзката към базата данни – винаги използвайте TLS и криптиране на данни при нужда.
- Пренебрегване на одитирането – без логове е трудно да се открият и анализират инциденти.
- Неактуализирани системи – уязвимости често се използват за атаки; поддържайте базите данни обновени.

## 7. Short Retrieval Quiz

1. Каква е разликата между удостоверяване и упълномощаване?
2. Какво представлява RBAC и защо е полезен?
3. Какво означава принципът на минималните права?
4. Как може да се осигури криптиране на данните при пренос?
5. Защо е важно да се поддържат логове и одити в базата данни?
6. Какви рискове крие използването на default акаунти?
7. Как се различава ACL от RBAC?

## 8. Quick Recap

- Database security защитава данните от неоторизиран достъп и злоупотреби.
- Authentication проверява кой е потребителят, а authorization определя какво може да прави.
- RBAC улеснява управлението на права чрез роли.
- Принципът на минималните права минимизира риска от злоупотреби.
- Криптирането защитава данните в покой и при пренос.
- Одитирането помага за откриване и анализ на инциденти.
- Редовното обновяване и премахване на ненужни акаунти са ключови за сигурността.

## 9. Spaced Review Plan

| Review Time | Prompt                                                                 |
|-------------|------------------------------------------------------------------------|
| 1 day       | Обяснете разликата между authentication и authorization.               |
| 3 days      | Дайте пример за RBAC и принципа на минималните права.                  |
| 1 week      | Какви са основните стъпки за осигуряване на сигурност в база данни?    |
| 1 month     | Какви са най-честите грешки при контрол на достъпа и как да ги избегнете? |