# Benchmarking_and_profiling_tools

## 1. Activate Prior Knowledge
- Какво разбирате под термина „производителност на софтуер“ и защо е важна в контекста на AI системи?
- Как бихте измерили колко бързо или ефективно работи дадена програма или алгоритъм?
- Какви инструменти или техники сте използвали досега, за да откриете „тесни места“ (bottlenecks) в изпълнението на софтуер?

## 2. Overview
Benchmarking и profiling са две фундаментални практики за оценка и оптимизация на софтуерната производителност. Benchmarking се фокусира върху измерването на изпълнението на цялата система или на отделни компоненти чрез стандартизирани тестове, докато profiling анализира детайлно поведението на програмата по време на изпълнение, за да открие конкретни участъци с висока консумация на ресурси.

В контекста на AI системи, където обработката на големи обеми данни и сложни модели изисква оптимална ефективност, тези инструменти са незаменими. Те помагат да се идентифицират „тесните места“ в кода, да се сравняват различни реализации и да се гарантира, че системата работи в рамките на зададените времеви и ресурсни ограничения.

Използването на benchmarking и profiling е част от цикъла на разработка и поддръжка на софтуер, като осигурява емпирични данни за вземане на решения относно оптимизации, хардуерни изисквания и архитектурни промени.

## 3. Key Concepts
- **Benchmarking** – процес на систематично измерване на производителността на софтуер или хардуер чрез изпълнение на стандартизирани тестове. Може да се сравняват различни системи или версии на софтуер.
- **Profiling** – детайлен анализ на изпълнението на програмата, който показва кои функции или редове код консумират най-много време или ресурси, подобно на „карта на горещите точки“ в кода.
- **Latency (Забавяне)** – времето, необходимо за изпълнение на дадена операция или задача. В AI системи е критично за отзивчивостта.
- **Throughput (Пропускателна способност)** – броят операции или задачи, които системата може да изпълни за единица време.
- **Bottleneck (Тесно място)** – част от системата, която ограничава общата производителност, подобно на най-тясната част на бутилка, която ограничава потока.
- **Sampling Profiling** – метод за профилиране, при който периодично се записва текущото състояние на изпълнение, за да се направи статистически извод за горещите точки.
- **Instrumentation Profiling** – метод, при който кодът се модифицира, за да записва детайлна информация за всяко извикване на функция или операция.

## 4. Step-by-step Learning Path
1. **Запознаване с основните метрики на производителност**
   - Фокус: Разберете разликата между latency и throughput.
   - Задача: Измерете времето за изпълнение на проста функция в Python с `time` модул.
   - Въпроси: Какво е latency? Как се различава от throughput?

2. **Използване на базов benchmarking инструмент**
   - Фокус: Научете как да използвате `timeit` в Python за сравнение на различни алгоритми.
   - Задача: Напишете два варианта на функция за сортиране и ги сравнете по време на изпълнение.
   - Въпроси: Как benchmarking помага при избора на алгоритъм? Как се интерпретират резултатите?

3. **Въвеждане в profiling**
   - Фокус: Разберете как работи профилирането и какви данни предоставя.
   - Задача: Използвайте `cProfile` в Python, за да профилирате същите функции.
   - Въпроси: Кои функции консумират най-много време? Как да намерите bottlenecks?

4. **Анализ и оптимизация на код**
   - Фокус: Научете как да използвате резултатите от профилирането за оптимизация.
   - Задача: Оптимизирайте най-бавната функция и измерете подобрението.
   - Въпроси: Какви промени доведоха до подобрение? Как benchmarking и profiling работят заедно?

5. **Разширени инструменти и техники**
   - Фокус: Запознайте се с инструменти като `perf` (Linux), VisualVM (Java), TensorBoard (AI profiling).
   - Задача: Профилирайте AI модел с TensorBoard и анализирайте резултатите.
   - Въпроси: Какви специфични метрики са важни за AI модели? Как профилирането подпомага оптимизацията на модели?

## 5. Examples

### Пример 1: Benchmarking с Python `timeit`
```python
import timeit

def bubble_sort(arr):
    n = len(arr)
    for i in range(n):
        for j in range(0, n-i-1):
            if arr[j] > arr[j+1]:
                arr[j], arr[j+1] = arr[j+1], arr[j]

def built_in_sort(arr):
    arr.sort()

arr = [5, 3, 8, 6, 2]
print("Bubble sort:", timeit.timeit(lambda: bubble_sort(arr.copy()), number=1000))
print("Built-in sort:", timeit.timeit(lambda: built_in_sort(arr.copy()), number=1000))
```

### Пример 2: Profiling с `cProfile`
```bash
python -m cProfile my_script.py
```
Изходът показва колко пъти е извикана всяка функция и колко време е изразходвано.

### Пример 3: Профилиране на TensorFlow модел с TensorBoard
```python
import tensorflow as tf

log_dir = "logs/profile"
writer = tf.summary.create_file_writer(log_dir)

tf.profiler.experimental.start(log_dir)
# Тренировъчен цикъл на модела
tf.profiler.experimental.stop()
```
След това стартирайте TensorBoard, за да видите профила.

## 6. Common Pitfalls
- **Използване на неподходящи метрики** – например, измерване само на latency, когато throughput е по-важен.
- **Профилиране в среда, различна от продукционната** – резултатите могат да не отразяват реалната производителност.
- **Прекомерна оптимизация на незначителни части от кода** – фокусирайте се върху истинските bottlenecks.
- **Игнориране на влиянието на външни фактори** – като IO, мрежови забавяния или кеширане.
- **Профилиране без повторения** – заради вариации в изпълнението, винаги правете няколко измервания.

## 7. Short Retrieval Quiz
1. Каква е разликата между benchmarking и profiling?
2. Какво представлява bottleneck в софтуерната производителност?
3. Кой инструмент в Python може да се използва за профилиране?
4. Защо е важно да се използват стандартизирани тестове при benchmarking?
5. Какво е sampling profiling?
6. Как benchmarking и profiling могат да се използват заедно?
7. Какви са основните метрики за измерване на производителност?

## 8. Quick Recap
- Benchmarking измерва цялостната производителност чрез стандартизирани тестове.
- Profiling анализира детайлно изпълнението, за да открие „тесни места“.
- Latency и throughput са ключови метрики за оценка на производителността.
- Инструменти като `timeit`, `cProfile` и TensorBoard са широко използвани.
- Оптимизацията трябва да се фокусира върху реалните bottlenecks.
- Профилирането и benchmarking са взаимодопълващи се техники.
- Винаги извършвайте повторни измервания и анализирайте резултатите в контекст.

## 9. Spaced Review Plan

| Време след учене | Промпт за преглед                                      |
|------------------|-------------------------------------------------------|
| 1 ден            | Опишете разликата между benchmarking и profiling.     |
| 3 дни            | Избройте и обяснете основните метрики за производителност. |
| 1 седмица        | Демонстрирайте с пример как да използвате `cProfile`. |
| 1 месец          | Обяснете как benchmarking и profiling подпомагат оптимизацията на AI система. |